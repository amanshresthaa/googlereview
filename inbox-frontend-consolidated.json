{
  "generatedAt": "2026-02-16T11:18:50.521Z",
  "route": "/inbox",
  "root": "/Users/amankumarshrestha/LapenInns Project/googlereview",
  "entrypoints": [
    "app/layout.tsx",
    "app/(app)/layout.tsx",
    "app/(app)/inbox/page.tsx",
    "app/(app)/inbox/InboxClient.tsx"
  ],
  "notes": [
    "This artifact contains frontend route code and shared frontend modules reachable from inbox entrypoints.",
    "Server API routes and backend-only modules are intentionally excluded."
  ],
  "fileCount": 56,
  "files": [
    {
      "path": "app/(app)/inbox/components/BlitzQuickReply.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/components/BlitzQuickReply.tsx",
      "bytes": 15498,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { toast } from \"sonner\"\n\nimport { Stars } from \"./Stars\"\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport { cn } from \"@/lib/utils\"\nimport { CheckCircle2, Clock, MapPin, RefreshCw, Save, Send, ShieldCheck, Sparkles, Zap } from \"@/components/icons\"\n\nimport type { ReviewRow } from \"@/lib/hooks\"\n\ntype BlitzQuickReplyProps = {\n  pendingRows: ReviewRow[]\n  focusReviewId?: string | null\n  onGenerate: (reviewId: string) => Promise<void>\n  onSave: (reviewId: string, text: string) => Promise<void>\n  onPublish: (reviewId: string, text: string, row: ReviewRow) => Promise<void>\n}\n\ntype BusyState = null | \"generate\" | \"save\" | \"publish\"\n\nfunction getInitials(name: string) {\n  const parts = name.trim().split(/\\s+/).filter(Boolean)\n  const first = parts[0]?.[0] ?? \"?\"\n  const last = parts.length > 1 ? parts[parts.length - 1]?.[0] : \"\"\n  return `${first}${last}`.toUpperCase()\n}\n\nexport function BlitzQuickReply({ pendingRows, focusReviewId, onGenerate, onSave, onPublish }: BlitzQuickReplyProps) {\n  const [dismissedIds, setDismissedIds] = React.useState<string[]>([])\n  const [currentIndex, setCurrentIndex] = React.useState(0)\n  const [draft, setDraft] = React.useState(\"\")\n  const [busy, setBusy] = React.useState<BusyState>(null)\n\n  const queue = React.useMemo(() => {\n    return pendingRows.filter((row) => !dismissedIds.includes(row.id))\n  }, [dismissedIds, pendingRows])\n\n  React.useEffect(() => {\n    if (queue.length === 0) {\n      setCurrentIndex(0)\n      return\n    }\n\n    if (!focusReviewId) {\n      setCurrentIndex((prev) => Math.min(prev, queue.length - 1))\n      return\n    }\n\n    const nextIndex = queue.findIndex((row) => row.id === focusReviewId)\n    if (nextIndex >= 0) {\n      setCurrentIndex(nextIndex)\n      return\n    }\n\n    setCurrentIndex((prev) => Math.min(prev, queue.length - 1))\n  }, [focusReviewId, queue])\n\n  const currentReview = queue[currentIndex] ?? null\n\n  React.useEffect(() => {\n    setDraft(currentReview?.currentDraft?.text ?? \"\")\n  }, [currentReview?.id, currentReview?.currentDraft?.id, currentReview?.currentDraft?.text])\n\n  const totalCount = queue.length + dismissedIds.length\n  const processedCount = dismissedIds.length\n  const progress = totalCount > 0 ? (processedCount / totalCount) * 100 : 100\n\n  const hasDraft = draft.trim().length > 0\n  const isDirty = draft !== (currentReview?.currentDraft?.text ?? \"\")\n\n  const completeCurrent = React.useCallback((reviewId: string) => {\n    setDismissedIds((prev) => (prev.includes(reviewId) ? prev : [...prev, reviewId]))\n    setCurrentIndex((prev) => Math.max(prev - 1, 0))\n  }, [])\n\n  const run = async (action: NonNullable<BusyState>, fn: () => Promise<void>) => {\n    setBusy(action)\n    try {\n      await fn()\n    } catch (error) {\n      toast.error(error instanceof Error ? error.message : \"Action failed\")\n    } finally {\n      setBusy(null)\n    }\n  }\n\n  const handleGenerate = React.useCallback(() => {\n    if (!currentReview) return\n    void run(\"generate\", async () => {\n      await onGenerate(currentReview.id)\n    })\n  }, [currentReview, onGenerate])\n\n  const handleSave = React.useCallback(() => {\n    if (!currentReview || !hasDraft) return\n    void run(\"save\", async () => {\n      await onSave(currentReview.id, draft)\n    })\n  }, [currentReview, hasDraft, onSave, draft])\n\n  const handleSkip = React.useCallback(() => {\n    if (!currentReview) return\n    completeCurrent(currentReview.id)\n  }, [currentReview, completeCurrent])\n\n  const handlePublishNext = React.useCallback(() => {\n    if (!currentReview || !hasDraft) return\n\n    void run(\"publish\", async () => {\n      await onPublish(currentReview.id, draft, currentReview)\n      completeCurrent(currentReview.id)\n    })\n  }, [currentReview, hasDraft, onPublish, draft, completeCurrent])\n\n  // Keyboard shortcuts\n  React.useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.metaKey && e.key === \"Enter\") {\n        e.preventDefault()\n        handlePublishNext()\n      }\n      if (e.metaKey && e.key === \"s\") {\n        e.preventDefault()\n        handleSave()\n      }\n      if (e.key === \"Escape\") {\n        e.preventDefault()\n        handleSkip()\n      }\n    }\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [handlePublishNext, handleSave, handleSkip])\n\n  if (queue.length === 0) {\n    return (\n      <div className=\"flex h-full flex-col bg-background\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.95 }}\n          animate={{ opacity: 1, scale: 1 }}\n          className=\"flex-1 flex flex-col items-center justify-center p-8 text-center\"\n        >\n          <div className=\"relative mb-8\">\n            <motion.div\n              animate={{ opacity: [0.3, 0.6, 0.3] }}\n              transition={{ duration: 2, repeat: Infinity }}\n              className=\"absolute inset-0 rounded-full bg-emerald-500/10 blur-2xl\"\n            />\n            <div className=\"relative h-24 w-24 bg-background shadow-card rounded-[32px] flex items-center justify-center border border-emerald-500/20 text-emerald-600 transition-transform duration-500 hover:rotate-12\">\n              <CheckCircle2 className=\"h-12 w-12\" />\n            </div>\n          </div>\n          <h2 className=\"text-3xl font-black tracking-tight text-foreground\">Session Complete</h2>\n          <p className=\"mt-2 text-sm font-medium text-muted-foreground max-w-xs leading-relaxed\">\n            All reviews in this queue have been processed. Great job staying on top of your customer feedback.\n          </p>\n          <Button onClick={() => window.location.reload()} className=\"mt-10 h-12 rounded-2xl px-10 font-black shadow-glow-primary\">\n            Back to Inbox\n          </Button>\n        </motion.div>\n      </div>\n    )\n  }\n\n  if (!currentReview) return null\n\n  const reviewerName = currentReview.reviewer.displayName || \"Anonymous\"\n\n  return (\n    <div className=\"flex h-full flex-col bg-background\">\n      <header className=\"border-b border-border/50 bg-background/80 glass-sm px-6 py-4\">\n        <div className=\"max-w-4xl mx-auto flex items-center justify-between gap-6\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"flex h-10 w-10 items-center justify-center rounded-xl bg-primary text-primary-foreground shadow-glow-primary\">\n              <Zap className=\"h-5 w-5\" />\n            </div>\n            <div>\n              <h1 className=\"text-base font-black tracking-tight uppercase tracking-[0.1em]\">Blitz Mode</h1>\n              <div className=\"flex items-center gap-3\">\n                <div className=\"h-1.5 w-32 rounded-full bg-muted overflow-hidden\">\n                  <motion.div\n                    className=\"h-full bg-primary\"\n                    animate={{ width: `${progress}%` }}\n                    transition={{ type: \"spring\", stiffness: 50, damping: 20 }}\n                  />\n                </div>\n                <span className=\"text-[10px] font-black tabular-nums text-muted-foreground\">{Math.round(progress)}% COMPLETE</span>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <Badge variant=\"outline\" className=\"rounded-full border-border/50 bg-muted/30 px-4 py-1.5 text-[10px] font-black uppercase tracking-widest tabular-nums\">\n              Review {processedCount + 1} of {totalCount}\n            </Badge>\n          </div>\n        </div>\n      </header>\n\n      <ScrollArea className=\"flex-1\">\n        <div className=\"max-w-4xl mx-auto p-6 md:p-10 space-y-10\">\n          <div className=\"flex items-start gap-6\">\n            <Avatar className=\"h-16 w-16 border-2 border-primary/5 shadow-sm shrink-0\">\n              <AvatarFallback className=\"bg-primary/5 text-xl font-bold text-primary\">\n                {getInitials(reviewerName)}\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"min-w-0 flex-1\">\n              <div className=\"flex items-center justify-between gap-4\">\n                <h2 className=\"text-2xl font-black tracking-tight text-foreground truncate\">{reviewerName}</h2>\n                <Stars rating={currentReview.starRating} size=\"md\" />\n              </div>\n              <div className=\"flex items-center gap-4 mt-1 text-[11px] font-black text-muted-foreground uppercase tracking-widest\">\n                <div className=\"flex items-center gap-1.5\">\n                  <MapPin className=\"h-3.5 w-3.5\" />\n                  {currentReview.location.displayName}\n                </div>\n                <div className=\"h-1 w-1 rounded-full bg-muted-foreground/30\" />\n                <div className=\"flex items-center gap-1.5\">\n                  <Clock className=\"h-3.5 w-3.5\" />\n                  Pending Response\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-10\">\n            <div className=\"relative p-10 rounded-[40px] bg-muted/20 border border-border/50 shadow-inner group\">\n              <div className=\"absolute -left-3 top-12 h-20 w-1 rounded-full bg-primary/20 transition-all group-hover:bg-primary/40\" />\n              <p className=\"text-2xl md:text-3xl leading-relaxed text-foreground font-medium italic\">\n                &ldquo;{currentReview.comment || \"No review text provided.\"}&rdquo;\n              </p>\n            </div>\n\n            <div className=\"space-y-5\">\n              <div className=\"flex items-center justify-between px-1\">\n                <h3 className=\"text-[10px] font-black uppercase tracking-[0.3em] text-muted-foreground/60\">Response Dashboard</h3>\n                <div className=\"flex items-center gap-4\">\n                  <span className=\"text-[10px] font-black text-muted-foreground/30 uppercase tracking-widest hidden sm:inline\">\n                    âŒ˜ + Enter to Publish\n                  </span>\n                  <Button\n                    type=\"button\"\n                    size=\"sm\"\n                    variant=\"ghost\"\n                    className=\"h-8 rounded-lg text-[10px] font-black uppercase tracking-widest text-primary hover:bg-primary/5\"\n                    onClick={handleGenerate}\n                    disabled={busy !== null}\n                  >\n                    {busy === \"generate\" ? (\n                      <motion.div animate={{ rotate: 360 }} transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}>\n                        <RefreshCw className=\"mr-1.5 h-3.5 w-3.5\" />\n                      </motion.div>\n                    ) : (\n                      <Sparkles className=\"mr-1.5 h-3.5 w-3.5\" />\n                    )}\n                    {hasDraft ? \"Regenerate\" : \"Start AI Draft\"}\n                  </Button>\n                </div>\n              </div>\n\n              <div className=\"relative group\">\n                <Textarea\n                  value={draft}\n                  onChange={(event) => setDraft(event.target.value)}\n                  placeholder=\"Draft your response here...\"\n                  className={cn(\n                    \"min-h-[280px] rounded-[32px] border-border/50 bg-background p-10 text-xl leading-relaxed shadow-sm transition-all focus:ring-8 focus:ring-primary/5\",\n                    busy === \"generate\" && \"opacity-50 pointer-events-none\",\n                  )}\n                />\n                <AnimatePresence>\n                  {busy === \"generate\" && (\n                    <motion.div\n                      initial={{ opacity: 0 }}\n                      animate={{ opacity: 1 }}\n                      exit={{ opacity: 0 }}\n                      className=\"absolute inset-0 z-10 rounded-[32px] bg-background/60 backdrop-blur-md flex items-center justify-center\"\n                    >\n                      <motion.div\n                        animate={{ opacity: [0.4, 1, 0.4] }}\n                        transition={{ duration: 1.5, repeat: Infinity }}\n                        className=\"flex flex-col items-center gap-4 text-primary\"\n                      >\n                        <motion.div\n                          animate={{ rotate: 360 }}\n                          transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n                        >\n                          <RefreshCw className=\"h-10 w-10\" />\n                        </motion.div>\n                        <p className=\"text-xs font-black uppercase tracking-[0.2em]\">Analyzing Feedback</p>\n                      </motion.div>\n                    </motion.div>\n                  )}\n                </AnimatePresence>\n                {currentReview.draftStatus === \"READY\" && (\n                  <div className=\"absolute top-6 right-6\">\n                    <div className=\"flex items-center gap-2 px-4 py-1.5 rounded-full bg-emerald-500/10 text-emerald-600 text-[10px] font-black uppercase tracking-widest shadow-sm border border-emerald-500/10\">\n                      <ShieldCheck className=\"h-4 w-4\" /> AI Verified\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      </ScrollArea>\n\n      <footer className=\"border-t border-border/50 bg-background/80 glass-sm p-6 md:p-8\">\n        <div className=\"max-w-4xl mx-auto flex items-center justify-between gap-6\">\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            className=\"h-14 px-8 rounded-2xl font-black text-muted-foreground/60 hover:bg-muted transition-all uppercase tracking-widest text-[11px]\"\n            onClick={handleSkip}\n          >\n            Skip (Esc)\n          </Button>\n\n          <div className=\"flex items-center gap-4\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              className=\"h-14 px-10 rounded-2xl font-black border-border/50 bg-background shadow-sm hover:bg-muted/50 transition-all uppercase tracking-widest text-[11px] hidden sm:flex\"\n              onClick={handleSave}\n              disabled={!hasDraft || !isDirty || busy !== null}\n            >\n              {busy === \"save\" ? (\n                <motion.div animate={{ rotate: 360 }} transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}>\n                  <RefreshCw className=\"h-5 w-5 mr-3\" />\n                </motion.div>\n              ) : (\n                <Save className=\"h-5 w-5 mr-3\" />\n              )}\n              Save Draft\n            </Button>\n\n            <Button\n              type=\"button\"\n              className=\"h-14 px-12 rounded-2xl bg-primary font-black shadow-glow-primary transition-all hover:bg-primary/90 hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 uppercase tracking-[0.15em] text-[11px]\"\n              onClick={handlePublishNext}\n              disabled={!hasDraft || busy !== null}\n            >\n              {busy === \"publish\" ? (\n                <motion.div animate={{ rotate: 360 }} transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}>\n                  <RefreshCw className=\"mr-3 h-5 w-5\" />\n                </motion.div>\n              ) : (\n                <Send className=\"mr-3 h-5 w-5\" />\n              )}\n              Post & Continue\n            </Button>\n          </div>\n        </div>\n      </footer>\n    </div>\n  )\n}\n"
    },
    {
      "path": "app/(app)/inbox/components/DetailPanel.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/components/DetailPanel.tsx",
      "bytes": 15893,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { toast } from \"sonner\"\n\nimport { initials } from \"../model\"\nimport { Stars } from \"./Stars\"\nimport { formatAge } from \"@/lib/hooks\"\nimport { cn } from \"@/lib/utils\"\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\"\nimport { CheckCircle2, Clock, Copy, Edit, MapPin, RefreshCw, Save, Send, ShieldCheck, Sparkles, X } from \"@/components/icons\"\n\nimport type { ReviewRow } from \"@/lib/hooks\"\n\ntype DetailPanelProps = {\n  row: ReviewRow\n  onGenerate: (reviewId: string) => Promise<void>\n  onSave: (reviewId: string, text: string) => Promise<void>\n  onVerify: (reviewId: string) => Promise<void>\n  onPublish: (reviewId: string, text: string, row: ReviewRow) => Promise<void>\n}\n\nexport function DetailPanel({ row, onGenerate, onSave, onVerify, onPublish }: DetailPanelProps) {\n  const [text, setText] = React.useState(row.currentDraft?.text ?? \"\")\n  const [busy, setBusy] = React.useState<null | \"generate\" | \"save\" | \"verify\" | \"publish\">(null)\n\n  React.useEffect(() => {\n    setText(row.currentDraft?.text ?? \"\")\n  }, [row.id, row.currentDraft?.id, row.currentDraft?.text])\n\n  const hasText = text.trim().length > 0\n  const isDirty = text !== (row.currentDraft?.text ?? \"\")\n  const wordCount = text.trim().split(/\\s+/).filter(Boolean).length\n  const characterCount = text.length\n\n  const run = async (action: NonNullable<typeof busy>, fn: () => Promise<void>) => {\n    setBusy(action)\n    try {\n      await fn()\n    } catch (error) {\n      toast.error(error instanceof Error ? error.message : \"Action failed\")\n    } finally {\n      setBusy(null)\n    }\n  }\n\n  const copyToClipboard = async () => {\n    try {\n      await navigator.clipboard.writeText(text)\n      toast.success(\"Copied to clipboard\")\n    } catch {\n      toast.error(\"Failed to copy\")\n    }\n  }\n\n  const isReplied = row.status === \"replied\"\n  const isVerified = row.draftStatus === \"READY\"\n\n  return (\n    <motion.div \n      layout\n      className=\"flex h-full flex-col bg-background\"\n    >\n      <ScrollArea className=\"flex-1\">\n        <div className=\"p-6 md:p-10 space-y-10 max-w-4xl mx-auto\">\n          {/* Header Area */}\n          <div className=\"flex items-start justify-between gap-6\">\n            <div className=\"flex items-center gap-5 min-w-0\">\n              <Avatar className=\"h-16 w-16 border-2 border-primary/5 shadow-sm shrink-0\">\n                <AvatarFallback className=\"bg-primary/5 text-xl font-bold text-primary\">\n                  {initials(row.reviewer.displayName ?? \"Anonymous\")}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"min-w-0 space-y-1\">\n                <h2 className=\"text-2xl font-black tracking-tight text-foreground truncate\">\n                  {row.reviewer.displayName || \"Anonymous\"}\n                </h2>\n                <div className=\"flex items-center gap-4\">\n                  <Stars rating={row.starRating} size=\"sm\" />\n                  <div className=\"flex items-center gap-1.5 text-[11px] font-black text-muted-foreground/60 uppercase tracking-[0.15em]\">\n                    <Clock className=\"h-3.5 w-3.5\" />\n                    {formatAge(row.createTimeIso)} ago\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex flex-col items-end gap-2.5 shrink-0\">\n              <AnimatePresence mode=\"wait\">\n                <motion.div\n                  key={isReplied ? \"replied\" : isVerified ? \"verified\" : \"pending\"}\n                  initial={{ opacity: 0, scale: 0.9, y: -5 }}\n                  animate={{ opacity: 1, scale: 1, y: 0 }}\n                  exit={{ opacity: 0, scale: 0.9, y: 5 }}\n                  transition={{ type: \"spring\", damping: 20, stiffness: 300 }}\n                >\n                  {isReplied ? (\n                    <Badge className=\"rounded-full bg-emerald-500/10 text-emerald-600 border-none px-4 py-1.5 font-black text-[10px] uppercase tracking-widest shadow-sm\">\n                      <CheckCircle2 className=\"mr-2 h-3.5 w-3.5\" />\n                      Published Live\n                    </Badge>\n                  ) : isVerified ? (\n                    <Badge className=\"rounded-full bg-primary/10 text-primary border-none px-4 py-1.5 font-black text-[10px] uppercase tracking-widest shadow-sm\">\n                      <ShieldCheck className=\"mr-2 h-3.5 w-3.5\" />\n                      AI Verified\n                    </Badge>\n                  ) : (\n                    <Badge className=\"rounded-full bg-muted text-muted-foreground border-none px-4 py-1.5 font-black text-[10px] uppercase tracking-widest\">\n                      Response Required\n                    </Badge>\n                  )}\n                </motion.div>\n              </AnimatePresence>\n              <div className=\"flex items-center gap-1.5 text-[10px] font-bold text-muted-foreground/40 uppercase tracking-widest\">\n                <MapPin className=\"h-3.5 w-3.5\" />\n                {row.location.displayName}\n              </div>\n            </div>\n          </div>\n\n          {/* Content Section */}\n          <div className=\"space-y-8\">\n            <div className=\"relative p-8 rounded-[32px] bg-muted/20 border border-border/50 shadow-inner group\">\n              <div className=\"absolute -left-3 top-10 h-16 w-1 rounded-full bg-primary/20 transition-all group-hover:h-20 group-hover:bg-primary/40\" />\n              <p className=\"text-xl md:text-2xl leading-relaxed text-foreground font-medium italic\">\n                &ldquo;{row.comment || \"No written comment provided.\"}&rdquo;\n              </p>\n              {row.mentions.length > 0 && (\n                <div className=\"mt-6 flex flex-wrap gap-2\">\n                  {row.mentions.map((mention) => (\n                    <span key={mention} className=\"text-[10px] font-black uppercase tracking-widest text-primary/60 bg-primary/5 px-3 py-1 rounded-full border border-primary/10\">\n                      #{mention}\n                    </span>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            <div className=\"space-y-5\">\n              <div className=\"flex items-center justify-between px-1\">\n                <h3 className=\"text-[10px] font-black uppercase tracking-[0.3em] text-muted-foreground/40\">\n                  {isReplied ? \"Official Response\" : \"Business Response Console\"}\n                </h3>\n                {!isReplied && (\n                  <div className=\"flex items-center gap-4 text-[10px] font-black text-muted-foreground/30 uppercase tracking-widest\">\n                    <span>{wordCount} Words</span>\n                    <div className=\"h-1 w-1 rounded-full bg-muted-foreground/20\" />\n                    <span>{characterCount} Chars</span>\n                  </div>\n                )}\n              </div>\n\n              {isReplied ? (\n                <div className=\"rounded-[32px] bg-emerald-500/[0.02] border border-emerald-500/10 p-8 shadow-inner transition-all hover:bg-emerald-500/[0.04]\">\n                  <p className=\"text-lg leading-relaxed text-foreground font-medium\">\n                    {row.reply.comment}\n                  </p>\n                </div>\n              ) : (\n                <div className=\"relative group\">\n                  <Textarea\n                    value={text}\n                    onChange={(event) => setText(event.target.value)}\n                    placeholder=\"Draft your professional response...\"\n                    className={cn(\n                      \"min-h-[360px] rounded-[32px] border-border/50 bg-background p-8 text-lg font-medium leading-relaxed shadow-sm transition-all focus:border-primary/30 focus:ring-8 focus:ring-primary/5\",\n                      busy === \"generate\" && \"opacity-50 pointer-events-none\",\n                    )}\n                  />\n                  <AnimatePresence>\n                    {busy === \"generate\" && (\n                      <motion.div\n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        exit={{ opacity: 0 }}\n                        className=\"absolute inset-0 z-10 rounded-[32px] bg-background/60 backdrop-blur-md flex items-center justify-center\"\n                      >\n                        <motion.div\n                          animate={{ opacity: [0.4, 1, 0.4] }}\n                          transition={{ duration: 1.5, repeat: Infinity }}\n                          className=\"flex flex-col items-center gap-4 text-primary\"\n                        >\n                          <motion.div\n                            animate={{ rotate: 360 }}\n                            transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n                          >\n                            <RefreshCw className=\"h-10 w-10\" />\n                          </motion.div>\n                          <p className=\"text-xs font-black uppercase tracking-[0.2em]\">Crafting Intelligence</p>\n                        </motion.div>\n                      </motion.div>\n                    )}\n                  </AnimatePresence>\n                  {!hasText && !busy && (\n                    <div className=\"pointer-events-none absolute inset-0 flex flex-col items-center justify-center gap-4 text-muted-foreground/20\">\n                      <Edit className=\"h-12 w-12\" />\n                      <p className=\"text-sm font-black uppercase tracking-[0.2em]\">Start Typing or Use AI</p>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      </ScrollArea>\n\n      {!isReplied && (\n        <div className=\"border-t border-border/50 bg-background/80 glass-sm p-6 md:p-8\">\n          <div className=\"mx-auto flex w-full max-w-4xl flex-col sm:flex-row items-center gap-4\">\n            <div className=\"flex w-full sm:flex-1 items-center gap-3\">\n              <Button\n                type=\"button\"\n                className=\"h-14 flex-1 rounded-2xl bg-primary font-black shadow-glow-primary transition-all hover:bg-primary/90 hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50\"\n                disabled={!hasText || busy !== null}\n                onClick={() => run(\"publish\", () => onPublish(row.id, text, row))}\n              >\n                {busy === \"publish\" ? (\n                  <motion.div\n                    animate={{ rotate: 360 }}\n                    transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n                  >\n                    <RefreshCw className=\"mr-3 h-6 w-6\" />\n                  </motion.div>\n                ) : (\n                  <Send className=\"mr-3 h-6 w-6\" />\n                )}\n                Publish Response\n              </Button>\n\n              <TooltipProvider delayDuration={400}>\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      className=\"h-14 w-14 rounded-2xl border-border/50 bg-background shadow-sm hover:bg-muted/50 transition-all flex shrink-0 items-center justify-center\"\n                      disabled={busy !== null}\n                      onClick={() => run(\"generate\", () => onGenerate(row.id))}\n                    >\n                      {busy === \"generate\" ? (\n                        <motion.div animate={{ rotate: 360 }} transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}>\n                          <RefreshCw className=\"h-6 w-6 text-primary\" />\n                        </motion.div>\n                      ) : (\n                        <Sparkles className=\"h-6 w-6 text-primary\" />\n                      )}\n                    </Button>\n                  </TooltipTrigger>\n                  <TooltipContent className=\"font-bold\">Regenerate AI Draft</TooltipContent>\n                </Tooltip>\n              </TooltipProvider>\n            </div>\n\n            <div className=\"flex w-full sm:w-auto items-center gap-3\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                className=\"h-14 px-8 rounded-2xl font-bold border-border/50 bg-background shadow-sm hover:bg-muted/50 transition-all\"\n                disabled={!isDirty || !hasText || busy !== null}\n                onClick={() => run(\"save\", () => onSave(row.id, text))}\n              >\n                {busy === \"save\" ? (\n                  <motion.div animate={{ rotate: 360 }} transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}>\n                    <RefreshCw className=\"h-5 w-5 mr-3\" />\n                  </motion.div>\n                ) : (\n                  <Save className=\"h-5 w-5 mr-3\" />\n                )}\n                Save Draft\n              </Button>\n\n              <div className=\"flex items-center gap-1.5\">\n                <TooltipProvider delayDuration={400}>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-14 w-14 rounded-2xl transition-all hover:bg-muted/80\"\n                        disabled={!hasText || busy !== null}\n                        onClick={() => run(\"verify\", () => onVerify(row.id))}\n                      >\n                        {busy === \"verify\" ? (\n                          <motion.div\n                            animate={{ rotate: 360 }}\n                            transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n                          >\n                            <RefreshCw className=\"h-6 w-6 text-primary\" />\n                          </motion.div>\n                        ) : (\n                          <ShieldCheck className=\"h-6 w-6 text-primary\" />\n                        )}\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent className=\"font-bold\">Fact-Check Draft</TooltipContent>\n                  </Tooltip>\n\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-14 w-14 rounded-2xl transition-all hover:bg-muted/80\"\n                        disabled={!hasText || busy !== null}\n                        onClick={() => void copyToClipboard()}\n                      >\n                        <Copy className=\"h-6 w-6\" />\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent className=\"font-bold\">Copy to Clipboard</TooltipContent>\n                  </Tooltip>\n\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-14 w-14 rounded-2xl transition-all hover:bg-muted/80 text-muted-foreground/40 hover:text-destructive hover:bg-destructive/5\"\n                        disabled={busy !== null}\n                        onClick={() => setText(row.currentDraft?.text ?? \"\")}\n                      >\n                        <X className=\"h-6 w-6\" />\n                      </Button>\n                    </TooltipTrigger>\n                    <TooltipContent className=\"font-bold\">Discard Changes</TooltipContent>\n                  </Tooltip>\n                </TooltipProvider>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </motion.div>\n  )\n}\n"
    },
    {
      "path": "app/(app)/inbox/components/EmptyState.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/components/EmptyState.tsx",
      "bytes": 1274,
      "content": "import * as React from \"react\"\nimport { motion } from \"framer-motion\"\n\ntype EmptyStateProps = {\n  icon: React.ComponentType<{ className?: string }>\n  title: string\n  description: string\n}\n\nexport function EmptyState({ icon: Icon, title, description }: EmptyStateProps) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.4 }}\n      className=\"flex min-h-[400px] flex-col items-center justify-center p-8 text-center\"\n    >\n      <div className=\"relative mb-6\">\n        <motion.div\n          animate={{ opacity: [0.3, 0.6, 0.3] }}\n          transition={{ duration: 2, repeat: Infinity, ease: \"easeInOut\" }}\n          className=\"absolute inset-0 rounded-3xl bg-primary/5 blur-2xl\"\n        />\n        <div className=\"relative grid h-20 w-20 place-items-center rounded-3xl border border-border/50 bg-background shadow-card transition-transform duration-500 hover:scale-110\">\n          <Icon className=\"h-9 w-9 text-primary/60\" />\n        </div>\n      </div>\n      <h3 className=\"text-xl font-bold tracking-tight text-foreground\">{title}</h3>\n      <p className=\"mt-2 max-w-sm text-sm font-medium leading-relaxed text-muted-foreground\">\n        {description}\n      </p>\n    </motion.div>\n  )\n}\n\n\n"
    },
    {
      "path": "app/(app)/inbox/components/InboxFiltersSheet.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/components/InboxFiltersSheet.tsx",
      "bytes": 7115,
      "content": "import * as React from \"react\"\n\nimport type { ReviewFilter } from \"@/lib/hooks\"\nimport type { LocationOption } from \"../types\"\nimport { Button } from \"@/components/ui/button\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\nimport { Sheet, SheetContent, SheetTitle } from \"@/components/ui/sheet\"\nimport { cn } from \"@/lib/utils\"\nimport { Filter } from \"@/components/icons\"\n\ntype QueueOption = {\n  value: ReviewFilter\n  label: string\n  disabled?: boolean\n}\n\ntype InboxFiltersSheetProps = {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  side: \"right\" | \"bottom\"\n  queueOptions: QueueOption[]\n  baseFilter: ReviewFilter\n  onBaseFilterChange: (value: ReviewFilter) => void\n  locationFilter: string\n  onLocationFilterChange: (value: string) => void\n  locations: LocationOption[]\n  ratingFilter: string\n  onRatingFilterChange: (value: string) => void\n  showMentionFilter: boolean\n  mentionFilter: string\n  onMentionFilterChange: (value: string) => void\n  mentionKeywords: string[]\n  onClearAll: () => void\n}\n\nexport function InboxFiltersSheet({\n  open,\n  onOpenChange,\n  side,\n  queueOptions,\n  baseFilter,\n  onBaseFilterChange,\n  locationFilter,\n  onLocationFilterChange,\n  locations,\n  ratingFilter,\n  onRatingFilterChange,\n  showMentionFilter,\n  mentionFilter,\n  onMentionFilterChange,\n  mentionKeywords,\n  onClearAll,\n}: InboxFiltersSheetProps) {\n  return (\n    <Sheet open={open} onOpenChange={onOpenChange}>\n      <SheetContent\n        side={side}\n        className={cn(\n          \"flex flex-col p-0 border-border/50 bg-background/95 backdrop-blur-xl\",\n          side === \"bottom\" ? \"h-[80vh] rounded-t-[32px] shadow-google-xl\" : \"h-full w-full sm:max-w-[400px]\"\n        )}\n      >\n        <SheetTitle className=\"sr-only\">Inbox Filters</SheetTitle>\n        \n        <div className=\"flex items-center justify-between border-b border-border/50 p-6 md:px-8\">\n          <div>\n            <h2 className=\"text-xl font-black tracking-tight\">Filters</h2>\n            <p className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-widest mt-1\">Refine your queue</p>\n          </div>\n          {side === \"bottom\" && (\n            <div className=\"h-1.5 w-12 rounded-full bg-muted mx-auto absolute top-3 left-1/2 -translate-x-1/2\" />\n          )}\n        </div>\n\n        <ScrollArea className=\"flex-1 px-6 py-8 md:px-8\">\n          <div className=\"space-y-8\">\n            <FilterSection label=\"Active Queue\">\n              <Select value={baseFilter} onValueChange={(value) => onBaseFilterChange(value as ReviewFilter)}>\n                <SelectTrigger className=\"h-12 rounded-[20px] bg-muted/30 border-none px-5 font-bold focus:ring-0\">\n                  <SelectValue placeholder=\"Select queue\" />\n                </SelectTrigger>\n                <SelectContent className=\"rounded-2xl border-border/50\">\n                  {queueOptions.map((option) => (\n                    <SelectItem key={option.value} value={option.value} disabled={option.disabled} className=\"rounded-xl py-3 font-bold text-sm\">\n                      {option.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </FilterSection>\n\n            <FilterSection label=\"Business Location\">\n              <Select value={locationFilter} onValueChange={onLocationFilterChange}>\n                <SelectTrigger className=\"h-12 rounded-[20px] bg-muted/30 border-none px-5 font-bold focus:ring-0\">\n                  <SelectValue placeholder=\"All locations\" />\n                </SelectTrigger>\n                <SelectContent className=\"rounded-2xl border-border/50\">\n                  <SelectItem value=\"all\" className=\"rounded-xl py-3 font-bold text-sm\">All Locations</SelectItem>\n                  {locations.map((location) => (\n                    <SelectItem key={location.id} value={location.id} className=\"rounded-xl py-3 font-bold text-sm\">\n                      {location.displayName}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </FilterSection>\n\n            <FilterSection label=\"Experience Rating\">\n              <Select value={ratingFilter} onValueChange={onRatingFilterChange}>\n                <SelectTrigger className=\"h-12 rounded-[20px] bg-muted/30 border-none px-5 font-bold focus:ring-0\">\n                  <SelectValue placeholder=\"Any rating\" />\n                </SelectTrigger>\n                <SelectContent className=\"rounded-2xl border-border/50\">\n                  <SelectItem value=\"all\" className=\"rounded-xl py-3 font-bold text-sm\">Any Rating</SelectItem>\n                  {[5, 4, 3, 2, 1].map((stars) => (\n                    <SelectItem key={stars} value={String(stars)} className=\"rounded-xl py-3 font-bold text-sm\">\n                      {stars} {stars === 1 ? 'Star' : 'Stars'}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </FilterSection>\n\n            {showMentionFilter && (\n              <FilterSection label=\"Keyword Detection\">\n                <Select value={mentionFilter} onValueChange={onMentionFilterChange}>\n                  <SelectTrigger className=\"h-12 rounded-[20px] bg-muted/30 border-none px-5 font-bold focus:ring-0\">\n                    <SelectValue placeholder=\"Pick keyword\" />\n                  </SelectTrigger>\n                  <SelectContent className=\"rounded-2xl border-border/50\">\n                    {mentionKeywords.map((keyword) => (\n                      <SelectItem key={keyword} value={keyword} className=\"rounded-xl py-3 font-bold text-sm\">\n                        @{keyword}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </FilterSection>\n            )}\n          </div>\n        </ScrollArea>\n\n        <div className=\"border-t border-border/50 bg-background/50 p-6 md:p-8\">\n          <div className=\"flex items-center justify-between gap-4\">\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              className=\"h-12 px-6 rounded-2xl font-bold text-muted-foreground hover:bg-muted transition-all\"\n              onClick={onClearAll}\n            >\n              Reset All\n            </Button>\n            <Button\n              type=\"button\"\n              className=\"h-12 flex-1 rounded-2xl bg-primary font-black shadow-glow-primary transition-all hover:bg-primary/90 hover:scale-[1.02] active:scale-[0.98]\"\n              onClick={() => onOpenChange(false)}\n            >\n              Apply Selection\n            </Button>\n          </div>\n        </div>\n      </SheetContent>\n    </Sheet>\n  )\n}\n\n\nfunction FilterSection({ label, children }: { label: string; children: React.ReactNode }) {\n  return (\n    <div className=\"space-y-2.5\">\n      <label className=\"text-[10px] font-black uppercase tracking-widest text-muted-foreground/60 px-1\">\n        {label}\n      </label>\n      {children}\n    </div>\n  )\n}\n\n"
    },
    {
      "path": "app/(app)/inbox/components/InboxHeader.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/components/InboxHeader.tsx",
      "bytes": 8919,
      "content": "import * as React from \"react\"\nimport { motion, AnimatePresence } from \"framer-motion\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { ToggleGroup, ToggleGroupItem } from \"@/components/ui/toggle-group\"\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\"\nimport { Filter, InboxIcon, RefreshCw, Search, Sparkles, CheckCircle2 } from \"@/components/icons\"\n\ntype InboxHeaderProps = {\n  pendingCount: number\n  loading: boolean\n  searchQuery: string\n  onSearchQueryChange: (value: string) => void\n  activeTab: \"all\" | \"pending\" | \"replied\"\n  onActiveTabChange: (value: \"all\" | \"pending\" | \"replied\") => void\n  activeFiltersCount: number\n  onOpenFilters: () => void\n  onOpenQuickReply: () => void\n  quickReplyDisabled: boolean\n  bulkApproveEnabled: boolean\n  selectionMode: boolean\n  onToggleSelectionMode: () => void\n  eligibleBulkCount: number\n  onSelectReady: () => void\n  onRefresh: () => void\n}\n\nexport function InboxHeader({\n  pendingCount,\n  loading,\n  searchQuery,\n  onSearchQueryChange,\n  activeTab,\n  onActiveTabChange,\n  activeFiltersCount,\n  onOpenFilters,\n  onOpenQuickReply,\n  quickReplyDisabled,\n  bulkApproveEnabled,\n  selectionMode,\n  onToggleSelectionMode,\n  eligibleBulkCount,\n  onSelectReady,\n  onRefresh,\n}: InboxHeaderProps) {\n  return (\n    <header className=\"sticky top-0 z-20 border-b border-border bg-background/95 backdrop-blur-xl\">\n      <div className=\"p-4 space-y-4\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"hidden sm:flex h-8 w-8 items-center justify-center rounded-lg bg-primary/10 text-primary\">\n              <InboxIcon className=\"h-4 w-4\" />\n            </div>\n            <h1 className=\"text-xl font-black tracking-tight\">Inbox</h1>\n            <AnimatePresence>\n              {pendingCount > 0 && (\n                <motion.div\n                  initial={{ opacity: 0, scale: 0.8 }}\n                  animate={{ opacity: 1, scale: 1 }}\n                  exit={{ opacity: 0, scale: 0.8 }}\n                >\n                  <Badge variant=\"default\" className=\"h-5 px-2 rounded-full text-[10px] font-black bg-primary/10 text-primary border-none shadow-none\">\n                    {pendingCount}\n                  </Badge>\n                </motion.div>\n              )}\n            </AnimatePresence>\n          </div>\n\n          <div className=\"flex items-center gap-1\">\n            <TooltipProvider delayDuration={400}>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-9 w-9 rounded-xl text-muted-foreground hover:bg-muted hover:text-foreground\"\n                    onClick={onRefresh}\n                  >\n                    {loading ? (\n                      <motion.div\n                        animate={{ rotate: 360 }}\n                        transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n                      >\n                        <RefreshCw className=\"h-4 w-4\" />\n                      </motion.div>\n                    ) : (\n                      <RefreshCw className=\"h-4 w-4\" />\n                    )}\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent className=\"font-bold\">Sync Reviews</TooltipContent>\n              </Tooltip>\n              \n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={onOpenQuickReply}\n                    className=\"h-9 w-9 rounded-xl text-primary hover:bg-primary/5\"\n                    disabled={quickReplyDisabled}\n                  >\n                    <Sparkles className=\"h-4 w-4\" />\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent className=\"font-bold\">Quick Reply Mode</TooltipContent>\n              </Tooltip>\n\n              {bulkApproveEnabled && (\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <Button\n                      type=\"button\"\n                      variant={selectionMode ? \"default\" : \"ghost\"}\n                      size=\"icon\"\n                      className={cn(\n                        \"h-9 w-9 rounded-xl transition-all\",\n                        selectionMode ? \"bg-primary shadow-glow-primary\" : \"text-muted-foreground hover:bg-muted\"\n                      )}\n                      onClick={onToggleSelectionMode}\n                    >\n                      <CheckCircle2 className=\"h-4 w-4\" />\n                    </Button>\n                  </TooltipTrigger>\n                  <TooltipContent className=\"font-bold\">Bulk Selection</TooltipContent>\n                </Tooltip>\n              )}\n            </TooltipProvider>\n          </div>\n        </div>\n\n        <div className=\"flex flex-col sm:flex-row gap-3\">\n          <div className=\"relative flex-1\">\n            <Search className=\"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground/50\" />\n            <Input\n              type=\"text\"\n              placeholder=\"Filter reviews...\"\n              value={searchQuery}\n              onChange={(event) => onSearchQueryChange(event.target.value)}\n              className=\"h-10 rounded-2xl border-none bg-muted/40 pl-9 pr-4 text-sm font-medium focus:bg-muted/60 focus:ring-0 transition-all\"\n            />\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <ToggleGroup\n              type=\"single\"\n              value={activeTab}\n              onValueChange={(value) => {\n                if (value === \"pending\" || value === \"replied\" || value === \"all\") {\n                  onActiveTabChange(value)\n                }\n              }}\n              className=\"flex h-10 rounded-2xl bg-muted/40 p-1 flex-1 sm:flex-initial\"\n            >\n              {([\"pending\", \"replied\", \"all\"] as const).map((tab) => (\n                <ToggleGroupItem\n                  key={tab}\n                  value={tab}\n                  className=\"h-8 rounded-xl px-4 text-[10px] font-black uppercase tracking-widest transition-all data-[state=on]:bg-background data-[state=on]:text-primary data-[state=on]:shadow-sm flex-1 sm:flex-initial\"\n                >\n                  {tab}\n                </ToggleGroupItem>\n              ))}\n            </ToggleGroup>\n\n            <TooltipProvider delayDuration={400}>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"icon\"\n                    onClick={onOpenFilters}\n                    className=\"h-10 w-10 shrink-0 rounded-2xl border-none bg-muted/40 hover:bg-muted/60 relative\"\n                  >\n                    <Filter className=\"h-4 w-4 text-muted-foreground\" />\n                    <AnimatePresence>\n                      {activeFiltersCount > 0 && (\n                        <motion.span\n                          initial={{ opacity: 0, scale: 0.5 }}\n                          animate={{ opacity: 1, scale: 1 }}\n                          exit={{ opacity: 0, scale: 0.5 }}\n                          className=\"absolute -top-1 -right-1 h-4 w-4 rounded-full bg-primary text-[9px] font-black text-white flex items-center justify-center shadow-sm\"\n                        >\n                          {activeFiltersCount}\n                        </motion.span>\n                      )}\n                    </AnimatePresence>\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent className=\"font-bold\">Advanced Filters</TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n          </div>\n        </div>\n\n        <AnimatePresence>\n          {selectionMode && eligibleBulkCount > 0 && (\n            <motion.div\n              initial={{ opacity: 0, height: 0, marginTop: 0 }}\n              animate={{ opacity: 1, height: \"auto\", marginTop: 12 }}\n              exit={{ opacity: 0, height: 0, marginTop: 0 }}\n              className=\"overflow-hidden\"\n            >\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                className=\"w-full h-10 rounded-2xl border-primary/20 bg-primary/5 text-primary text-xs font-black uppercase tracking-widest hover:bg-primary/10 transition-all\"\n                onClick={onSelectReady}\n              >\n                Select {eligibleBulkCount} Ready for Approval\n              </Button>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n    </header>\n  )\n}\n\n\n\n\n"
    },
    {
      "path": "app/(app)/inbox/components/InboxReviewList.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/components/InboxReviewList.tsx",
      "bytes": 3465,
      "content": "import * as React from \"react\"\nimport { motion } from \"framer-motion\"\n\nimport { EmptyState } from \"./EmptyState\"\nimport { ReviewCardItem } from \"./ReviewCardItem\"\nimport { Button } from \"@/components/ui/button\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { InboxIcon, RefreshCw } from \"@/components/icons\"\n\nimport type { ReviewRow } from \"@/lib/hooks\"\n\ntype InboxReviewListProps = {\n  loading: boolean\n  bootstrapLoading: boolean\n  rows: ReviewRow[]\n  activeReviewId: string | null\n  selectionMode: boolean\n  selectedIds: string[]\n  quickApproveLoadingId: string | null\n  hasMore: boolean\n  loadingMore: boolean\n  onOpenReview: (reviewId: string) => void\n  onCheckedChange: (reviewId: string, checked: boolean) => void\n  onQuickApprove: (reviewId: string) => void\n  onLoadMore: () => void\n}\n\nexport function InboxReviewList({\n  loading,\n  bootstrapLoading,\n  rows,\n  activeReviewId,\n  selectionMode,\n  selectedIds,\n  quickApproveLoadingId,\n  hasMore,\n  loadingMore,\n  onOpenReview,\n  onCheckedChange,\n  onQuickApprove,\n  onLoadMore,\n}: InboxReviewListProps) {\n  const showInitialLoading = loading && rows.length === 0\n\n  return (\n    <section className=\"h-full overflow-hidden\">\n      <ScrollArea className=\"h-full\">\n        {showInitialLoading || bootstrapLoading ? (\n          <EmptyState icon={RefreshCw} title=\"Loading reviews\" description=\"Fetching your latest inbox data...\" />\n        ) : rows.length === 0 ? (\n          <EmptyState\n            icon={InboxIcon}\n            title=\"All caught up!\"\n            description=\"No reviews found for the current filters. Try adjusting them or check back later.\"\n          />\n        ) : (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            transition={{ duration: 0.4 }}\n            className=\"flex flex-col gap-3 p-4 pb-32 md:pb-8\"\n          >\n            {rows.map((review) => (\n              <ReviewCardItem\n                key={review.id}\n                row={review}\n                selected={review.id === activeReviewId && !selectionMode}\n                checked={selectedIds.includes(review.id)}\n                showCheckbox={selectionMode}\n                quickApproveLoading={quickApproveLoadingId === review.id}\n                onOpen={onOpenReview}\n                onCheckedChange={onCheckedChange}\n                onQuickApprove={onQuickApprove}\n              />\n            ))}\n\n            {hasMore && (\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                className=\"w-full h-12 rounded-[20px] border-border/50 bg-background shadow-sm hover:bg-muted/50 font-bold transition-all mt-2\" \n                onClick={onLoadMore} \n                disabled={loadingMore}\n              >\n                {loadingMore ? (\n                  <>\n                    <motion.div\n                      animate={{ rotate: 360 }}\n                      transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n                    >\n                      <RefreshCw className=\"mr-2 h-4 w-4\" />\n                    </motion.div>\n                    Syncing more...\n                  </>\n                ) : (\n                  <>\n                    <RefreshCw className=\"mr-2 h-4 w-4\" />\n                    Load More Reviews\n                  </>\n                )}\n              </Button>\n            )}\n          </motion.div>\n        )}\n      </ScrollArea>\n    </section>\n  )\n}\n\n\n"
    },
    {
      "path": "app/(app)/inbox/components/ReviewCardItem.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/components/ReviewCardItem.tsx",
      "bytes": 6919,
      "content": "import { motion, AnimatePresence } from \"framer-motion\"\nimport { initials } from \"../model\"\nimport { Stars } from \"./Stars\"\nimport { formatAge } from \"@/lib/hooks\"\nimport { cn } from \"@/lib/utils\"\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\"\nimport { Button } from \"@/components/ui/button\"\nimport { Checkbox } from \"@/components/ui/checkbox\"\nimport { CheckCircle2, Clock, MapPin, RefreshCw, TrendingUp, Zap } from \"@/components/icons\"\n\nimport type { ReviewRow } from \"@/lib/hooks\"\n\ntype ReviewCardItemProps = {\n  row: ReviewRow\n  selected: boolean\n  checked: boolean\n  showCheckbox: boolean\n  quickApproveLoading: boolean\n  onOpen: (reviewId: string) => void\n  onCheckedChange: (reviewId: string, val: boolean) => void\n  onQuickApprove: (reviewId: string) => void\n}\n\nexport function ReviewCardItem({\n  row,\n  selected,\n  checked,\n  showCheckbox,\n  quickApproveLoading,\n  onOpen,\n  onCheckedChange,\n  onQuickApprove,\n}: ReviewCardItemProps) {\n  const reviewerName = row.reviewer.displayName || \"Anonymous\"\n  const isReplied = row.status === \"replied\"\n  const isUrgent = row.starRating <= 2 && !isReplied\n  const canQuickApprove = !isReplied && row.currentDraft?.text?.trim() && row.draftStatus === \"READY\"\n\n  return (\n    <motion.article\n      onClick={() => onOpen(row.id)}\n      whileTap={{ scale: 0.98 }}\n      whileHover={{ scale: 1.01 }}\n      className={cn(\n        \"group relative flex cursor-pointer flex-col gap-3 rounded-2xl border border-border/50 bg-background p-4 transition-all duration-300\",\n        selected\n          ? \"border-primary/30 bg-primary/[0.02] shadow-glow-primary ring-1 ring-primary/10\"\n          : \"hover:border-border hover:bg-muted/20 hover:shadow-sm\",\n      )}\n      aria-label={`Review by ${reviewerName}`}\n    >\n      <div className=\"flex items-start justify-between gap-4\">\n        <div className=\"flex items-center gap-3 min-w-0\">\n          <Avatar className=\"h-10 w-10 border border-border/30 shadow-sm shrink-0\">\n            <AvatarFallback className={cn(\"bg-primary/5 text-[12px] font-black text-primary transition-colors\", selected && \"bg-primary text-primary-foreground\")}>\n              {initials(reviewerName)}\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"min-w-0\">\n            <h3 className=\"truncate text-sm font-black tracking-tight text-foreground\">\n              {reviewerName}\n            </h3>\n            <div className=\"flex items-center gap-1.5 text-[10px] font-bold text-muted-foreground/60 uppercase tracking-widest\">\n              <Clock className=\"h-2.5 w-2.5\" />\n              {formatAge(row.createTimeIso)} ago\n            </div>\n          </div>\n        </div>\n\n        {showCheckbox && (\n          <div onClick={(event) => event.stopPropagation()} className=\"shrink-0\">\n            <Checkbox\n              checked={checked}\n              onCheckedChange={(value) => onCheckedChange(row.id, Boolean(value))}\n              className=\"h-5 w-5 rounded-lg border-border/50 data-[state=checked]:bg-primary\"\n            />\n          </div>\n        )}\n      </div>\n\n      <div className=\"space-y-2.5\">\n        <div className=\"flex items-center justify-between\">\n          <Stars rating={row.starRating} size=\"xs\" />\n          <div className=\"flex items-center gap-1 text-[10px] font-bold text-muted-foreground/40 uppercase tracking-widest max-w-[60%]\">\n            <MapPin className=\"h-3 w-3 shrink-0\" />\n            <span className=\"truncate\">{row.location.displayName}</span>\n          </div>\n        </div>\n\n        <p className=\"line-clamp-2 text-sm leading-relaxed text-muted-foreground font-medium\">\n          {row.comment || <span className=\"italic opacity-50\">No comment provided</span>}\n        </p>\n\n        <div className=\"flex items-center justify-between gap-2 pt-1\">\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <AnimatePresence mode=\"wait\">\n              {isReplied ? (\n                <motion.div\n                  key=\"replied\"\n                  initial={{ opacity: 0, scale: 0.9 }}\n                  animate={{ opacity: 1, scale: 1 }}\n                  className=\"flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-600 text-[9px] font-black uppercase tracking-widest\"\n                >\n                  <CheckCircle2 className=\"h-2.5 w-2.5\" />\n                  Replied\n                </motion.div>\n              ) : isUrgent ? (\n                <motion.div\n                  key=\"urgent\"\n                  initial={{ opacity: 0, scale: 0.9 }}\n                  animate={{ opacity: 1, scale: 1 }}\n                  className=\"flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-destructive/10 text-destructive text-[9px] font-black uppercase tracking-widest\"\n                >\n                  <TrendingUp className=\"h-2.5 w-2.5\" />\n                  Urgent\n                </motion.div>\n              ) : (\n                <motion.div\n                  key=\"pending\"\n                  initial={{ opacity: 0, scale: 0.9 }}\n                  animate={{ opacity: 1, scale: 1 }}\n                  className=\"flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-muted text-muted-foreground/60 text-[9px] font-black uppercase tracking-widest\"\n                >\n                  <Clock className=\"h-2.5 w-2.5\" />\n                  Pending\n                </motion.div>\n              )}\n            </AnimatePresence>\n\n            {!isReplied && row.draftStatus === \"READY\" && (\n              <motion.div\n                initial={{ opacity: 0, x: -10 }}\n                animate={{ opacity: 1, x: 0 }}\n                className=\"flex items-center gap-1.5 px-2 py-0.5 rounded-full bg-primary/10 text-primary text-[9px] font-black uppercase tracking-widest\"\n              >\n                <Zap className=\"h-2.5 w-2.5 fill-primary\" />\n                Ready\n              </motion.div>\n            )}\n          </div>\n\n          {canQuickApprove && (\n            <Button\n              size=\"sm\"\n              variant=\"ghost\"\n              className=\"h-7 rounded-lg px-3 text-[10px] font-black uppercase tracking-widest text-primary hover:bg-primary/5 shadow-none transition-all\"\n              onClick={(event) => {\n                event.stopPropagation()\n                onQuickApprove(row.id)\n              }}\n              disabled={quickApproveLoading}\n            >\n              {quickApproveLoading ? (\n                <motion.div animate={{ rotate: 360 }} transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}>\n                  <RefreshCw className=\"h-3 w-3\" />\n                </motion.div>\n              ) : \"Approve\"}\n            </Button>\n          )}\n        </div>\n      </div>\n      \n      {selected && (\n        <motion.div\n          layoutId=\"active-indicator\"\n          className=\"absolute left-0 top-4 bottom-4 w-1 rounded-r-full bg-primary shadow-glow-primary\"\n        />\n      )}\n    </motion.article>\n  )\n}\n\n\n\n"
    },
    {
      "path": "app/(app)/inbox/components/Stars.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/components/Stars.tsx",
      "bytes": 806,
      "content": "import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Star } from \"@/components/icons\"\n\ntype StarsProps = {\n  rating: number\n  size?: \"xs\" | \"sm\" | \"md\"\n}\n\nexport function Stars({ rating, size = \"sm\" }: StarsProps) {\n  const sizeClass = size === \"xs\" ? \"h-3 w-3\" : size === \"md\" ? \"h-4 w-4\" : \"h-3.5 w-3.5\"\n\n  return (\n    <div className=\"flex items-center gap-0.5\" role=\"img\" aria-label={`${rating} stars`}>\n      {Array.from({ length: 5 }, (_, index) => {\n        const filled = index < rating\n        return (\n          <Star\n            key={`${rating}-${String(index)}`}\n            weight={filled ? \"fill\" : \"regular\"}\n            className={cn(sizeClass, filled ? \"fill-yellow-400 text-yellow-400\" : \"text-muted-foreground/25\")}\n          />\n        )\n      })}\n    </div>\n  )\n}\n"
    },
    {
      "path": "app/(app)/inbox/hooks/useDebouncedValue.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/hooks/useDebouncedValue.ts",
      "bytes": 344,
      "content": "import * as React from \"react\"\n\nexport function useDebouncedValue<T>(value: T, delayMs: number) {\n  const [debounced, setDebounced] = React.useState(value)\n\n  React.useEffect(() => {\n    const timer = window.setTimeout(() => setDebounced(value), delayMs)\n    return () => window.clearTimeout(timer)\n  }, [value, delayMs])\n\n  return debounced\n}\n"
    },
    {
      "path": "app/(app)/inbox/hooks/useReviewMutations.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/hooks/useReviewMutations.ts",
      "bytes": 11883,
      "content": "import * as React from \"react\"\nimport { toast } from \"sonner\"\n\nimport { applyDetailSnapshot, getVerifierBlockedMessage, mapDetailToRow } from \"../model\"\nimport { apiCall, fetchReviewDetail, waitForJobCompletion, waitForReviewState } from \"../network\"\n\nimport type { ReviewDetail, ReviewRow } from \"@/lib/hooks\"\nimport type { ReviewMutationResponse } from \"../types\"\n\nconst QUICK_JOB_WAIT_MS = 1800\nconst BACKGROUND_JOB_WAIT_MS = 25_000\n\ntype UseReviewMutationsInput = {\n  rows: ReviewRow[]\n  updateRow: (id: string, updater: (row: ReviewRow) => ReviewRow) => void\n  refresh: () => Promise<void> | void\n}\n\nexport function useReviewMutations({ rows, updateRow, refresh }: UseReviewMutationsInput) {\n  const backgroundJobsRef = React.useRef<Set<string>>(new Set())\n\n  const getJobId = React.useCallback((result: ReviewMutationResponse) => {\n    return result.jobId ?? result.verifyJobId ?? result.job?.id ?? null\n  }, [])\n\n  const syncRowFromServer = React.useCallback(async (reviewId: string) => {\n    const detail = await fetchReviewDetail(reviewId)\n    if (detail) {\n      updateRow(reviewId, (row) => mapDetailToRow(row, detail))\n    }\n    return detail\n  }, [updateRow])\n\n  const syncRowFromSnapshotOrServer = React.useCallback(async (reviewId: string, detail: ReviewDetail | null) => {\n    if (detail) {\n      updateRow(reviewId, (row) => mapDetailToRow(row, detail))\n      return detail\n    }\n    return syncRowFromServer(reviewId)\n  }, [syncRowFromServer, updateRow])\n\n  const resolveTerminalFailureMessage = React.useCallback((params: {\n    status: \"FAILED\" | \"CANCELLED\"\n    fallbackMessage: string\n    lastError: string | null\n  }) => {\n    const { status, fallbackMessage, lastError } = params\n    if (lastError) return lastError\n    if (status === \"CANCELLED\") return \"This job was cancelled before completion.\"\n    return fallbackMessage\n  }, [])\n\n  const settleQueuedJob = React.useCallback(async (params: {\n    jobId: string\n    queuedMessage: string\n    successMessage: string\n    failureMessage: string\n    onCompleted: (reviewSnapshot: ReviewDetail | null) => Promise<void>\n  }) => {\n    const { jobId, queuedMessage, successMessage, failureMessage, onCompleted } = params\n\n    const quickResult = await waitForJobCompletion(jobId, QUICK_JOB_WAIT_MS)\n    if (quickResult?.job.status === \"FAILED\" || quickResult?.job.status === \"CANCELLED\") {\n      throw new Error(\n        resolveTerminalFailureMessage({\n          status: quickResult.job.status,\n          fallbackMessage: failureMessage,\n          lastError: quickResult.job.lastError,\n        }),\n      )\n    }\n\n    if (quickResult?.job.status === \"COMPLETED\") {\n      await onCompleted(quickResult.review ?? null)\n      toast.success(successMessage)\n      return\n    }\n\n    toast.success(queuedMessage)\n    if (backgroundJobsRef.current.has(jobId)) return\n    backgroundJobsRef.current.add(jobId)\n\n    void (async () => {\n      try {\n        const final = await waitForJobCompletion(jobId, BACKGROUND_JOB_WAIT_MS)\n        if (!final) return\n\n        if (final.job.status === \"FAILED\" || final.job.status === \"CANCELLED\") {\n          toast.error(\n            resolveTerminalFailureMessage({\n              status: final.job.status,\n              fallbackMessage: failureMessage,\n              lastError: final.job.lastError,\n            }),\n          )\n          return\n        }\n\n        await onCompleted(final.review ?? null)\n        toast.success(successMessage)\n      } catch (error) {\n        toast.error(error instanceof Error ? error.message : failureMessage)\n      } finally {\n        backgroundJobsRef.current.delete(jobId)\n      }\n    })()\n  }, [resolveTerminalFailureMessage])\n\n  const generateDraft = React.useCallback(async (reviewId: string) => {\n    const previousDraftId = rows.find((row) => row.id === reviewId)?.currentDraft?.id ?? null\n    const result = await apiCall<ReviewMutationResponse>(`/api/reviews/${reviewId}/drafts/generate`, \"POST\")\n\n    if (applyDetailSnapshot(reviewId, result.review, updateRow)) {\n      toast.success(\"Draft regenerated\")\n      return\n    }\n\n    const jobId = getJobId(result)\n    if (jobId) {\n      await settleQueuedJob({\n        jobId,\n        queuedMessage: \"Draft generation queued\",\n        successMessage: \"Draft regenerated\",\n        failureMessage: \"Draft generation failed.\",\n        onCompleted: async (reviewSnapshot) => {\n          await syncRowFromSnapshotOrServer(reviewId, reviewSnapshot)\n        },\n      })\n      return\n    }\n\n    const changed = await waitForReviewState(\n      reviewId,\n      (detail) => {\n        const currentDraftId = detail.currentDraft?.id ?? null\n        return previousDraftId == null ? currentDraftId != null : currentDraftId !== previousDraftId\n      },\n      5000,\n    )\n\n    if (changed) {\n      updateRow(reviewId, (row) => mapDetailToRow(row, changed))\n      toast.success(\"Draft regenerated\")\n    } else {\n      toast.success(\"Draft generation queued\")\n    }\n  }, [getJobId, rows, settleQueuedJob, syncRowFromSnapshotOrServer, updateRow])\n\n  const saveDraft = React.useCallback(async (reviewId: string, text: string) => {\n    const trimmed = text.trim()\n    if (!trimmed) throw new Error(\"Draft is empty.\")\n\n    const result = await apiCall<ReviewMutationResponse>(`/api/reviews/${reviewId}/drafts/edit`, \"POST\", { text: trimmed })\n    if (applyDetailSnapshot(reviewId, result.review, updateRow)) {\n      toast.success(\"Draft saved\")\n      return\n    }\n\n    const claimed = Number(result?.worker?.claimed ?? 0)\n    const changed = await waitForReviewState(\n      reviewId,\n      (detail) => (detail.currentDraft?.text.trim() ?? \"\") === trimmed,\n      claimed > 0 ? 5000 : 6500,\n    )\n\n    if (changed) {\n      updateRow(reviewId, (row) => mapDetailToRow(row, changed))\n      toast.success(\"Draft saved\")\n    }\n  }, [updateRow])\n\n  const verifyDraft = React.useCallback(async (reviewId: string) => {\n    const result = await apiCall<ReviewMutationResponse>(`/api/reviews/${reviewId}/drafts/verify`, \"POST\")\n    if (applyDetailSnapshot(reviewId, result.review, updateRow)) {\n      if (result.review?.currentDraft?.status === \"BLOCKED_BY_VERIFIER\") {\n        throw new Error(getVerifierBlockedMessage(result.review))\n      }\n      toast.success(\"Draft verified\")\n      return\n    }\n\n    const jobId = getJobId(result)\n    if (jobId) {\n      await settleQueuedJob({\n        jobId,\n        queuedMessage: \"Draft verification queued\",\n        successMessage: \"Draft verified\",\n        failureMessage: \"Draft verification failed.\",\n        onCompleted: async (reviewSnapshot) => {\n          const detail = await syncRowFromSnapshotOrServer(reviewId, reviewSnapshot)\n          if (detail?.currentDraft?.status === \"BLOCKED_BY_VERIFIER\") {\n            throw new Error(getVerifierBlockedMessage(detail))\n          }\n        },\n      })\n      return\n    }\n\n    const claimed = Number(result?.worker?.claimed ?? 0)\n    const verified = await waitForReviewState(\n      reviewId,\n      (detail) => {\n        const status = detail.currentDraft?.status\n        return status === \"READY\" || status === \"BLOCKED_BY_VERIFIER\"\n      },\n      claimed > 0 ? 5000 : 7000,\n    )\n\n    if (!verified) throw new Error(\"Verification is still processing. Please retry.\")\n\n    updateRow(reviewId, (row) => mapDetailToRow(row, verified))\n    if (verified.currentDraft?.status === \"BLOCKED_BY_VERIFIER\") {\n      throw new Error(getVerifierBlockedMessage(verified))\n    }\n    toast.success(\"Draft verified\")\n  }, [getJobId, settleQueuedJob, syncRowFromSnapshotOrServer, updateRow])\n\n  const publishReply = React.useCallback(async (reviewId: string, text: string, row: ReviewRow) => {\n    if (!text.trim()) throw new Error(\"Draft is empty.\")\n\n    const current = row.currentDraft?.text.trim() ?? \"\"\n    const incoming = text.trim()\n    let verified: ReviewDetail | null = null\n\n    if (current !== incoming) {\n      const editResult = await apiCall<ReviewMutationResponse>(`/api/reviews/${reviewId}/drafts/edit`, \"POST\", { text: incoming })\n      if (applyDetailSnapshot(reviewId, editResult.review, updateRow)) {\n        verified = editResult.review ?? null\n      }\n\n      const editClaimed = Number(editResult?.worker?.claimed ?? 0)\n      if (!verified) {\n        const afterEdit = await waitForReviewState(\n          reviewId,\n          (detail) => {\n            const currentText = detail.currentDraft?.text.trim() ?? \"\"\n            const status = detail.currentDraft?.status\n            return currentText === incoming && (status === \"READY\" || status === \"BLOCKED_BY_VERIFIER\")\n          },\n          editClaimed > 0 ? 5000 : 6500,\n        )\n        if (afterEdit) {\n          updateRow(reviewId, (nextRow) => mapDetailToRow(nextRow, afterEdit))\n          verified = afterEdit\n        }\n      }\n    }\n\n    if (!verified) {\n      const verifyResult = await apiCall<ReviewMutationResponse>(`/api/reviews/${reviewId}/drafts/verify`, \"POST\")\n      if (applyDetailSnapshot(reviewId, verifyResult.review, updateRow)) {\n        verified = verifyResult.review ?? null\n      }\n\n      const verifyJobId = getJobId(verifyResult)\n      if (!verified && verifyJobId) {\n        await settleQueuedJob({\n          jobId: verifyJobId,\n          queuedMessage: \"Draft verification queued\",\n          successMessage: \"Draft verified\",\n          failureMessage: \"Draft verification failed.\",\n          onCompleted: async (reviewSnapshot) => {\n            verified = await syncRowFromSnapshotOrServer(reviewId, reviewSnapshot)\n            if (verified?.currentDraft?.status === \"BLOCKED_BY_VERIFIER\") {\n              throw new Error(getVerifierBlockedMessage(verified))\n            }\n          },\n        })\n      }\n\n      const verifyClaimed = Number(verifyResult?.worker?.claimed ?? 0)\n      if (!verified) {\n        verified = await waitForReviewState(\n          reviewId,\n          (detail) => {\n            const status = detail.currentDraft?.status\n            return status === \"READY\" || status === \"BLOCKED_BY_VERIFIER\"\n          },\n          verifyClaimed > 0 ? 5000 : 7000,\n        )\n      }\n    }\n\n    if (!verified) throw new Error(\"Verification is still processing. Please try publishing again in a few seconds.\")\n    const verifiedDetail = verified\n\n    updateRow(reviewId, (nextRow) => mapDetailToRow(nextRow, verifiedDetail))\n    if (verifiedDetail.currentDraft?.status !== \"READY\") {\n      throw new Error(getVerifierBlockedMessage(verifiedDetail))\n    }\n\n    const postResult = await apiCall<ReviewMutationResponse>(`/api/reviews/${reviewId}/reply/post`, \"POST\")\n    if (applyDetailSnapshot(reviewId, postResult.review, updateRow) && postResult.review?.reply.comment) {\n      toast.success(\"Reply published\")\n      void refresh()\n      return\n    }\n\n    const postJobId = getJobId(postResult)\n    if (postJobId) {\n      await settleQueuedJob({\n        jobId: postJobId,\n        queuedMessage: \"Reply posting queued\",\n        successMessage: \"Reply published\",\n        failureMessage: \"Reply posting failed.\",\n        onCompleted: async (reviewSnapshot) => {\n          const posted = await syncRowFromSnapshotOrServer(reviewId, reviewSnapshot)\n          if (!posted?.reply.comment) {\n            await Promise.resolve(refresh())\n            return\n          }\n          await Promise.resolve(refresh())\n        },\n      })\n      return\n    }\n\n    const postClaimed = Number(postResult?.worker?.claimed ?? 0)\n    const posted = await waitForReviewState(\n      reviewId,\n      (detail) => detail.reply.comment != null,\n      postClaimed > 0 ? 4500 : 7000,\n    )\n\n    if (posted) {\n      updateRow(reviewId, (nextRow) => mapDetailToRow(nextRow, posted))\n      toast.success(\"Reply published\")\n    } else {\n      toast.success(\"Reply posting queued\")\n    }\n\n    void refresh()\n  }, [getJobId, refresh, settleQueuedJob, syncRowFromSnapshotOrServer, updateRow])\n\n  return {\n    generateDraft,\n    saveDraft,\n    verifyDraft,\n    publishReply,\n  }\n}\n"
    },
    {
      "path": "app/(app)/inbox/InboxClient.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/InboxClient.tsx",
      "bytes": 19068,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { useSearchParams } from \"next/navigation\"\nimport { AnimatePresence, motion } from \"framer-motion\"\nimport { toast } from \"sonner\"\n\nimport { BlitzQuickReply } from \"./components/BlitzQuickReply\"\nimport { DetailPanel } from \"./components/DetailPanel\"\nimport { EmptyState } from \"./components/EmptyState\"\nimport { InboxFiltersSheet } from \"./components/InboxFiltersSheet\"\nimport { InboxHeader } from \"./components/InboxHeader\"\nimport { InboxReviewList } from \"./components/InboxReviewList\"\nimport { useDebouncedValue } from \"./hooks/useDebouncedValue\"\nimport { useReviewMutations } from \"./hooks/useReviewMutations\"\nimport { canBulkApprove, parseFilter, resolveRemoteFilter } from \"./model\"\nimport { apiCall } from \"./network\"\nimport type { InboxBootstrap, ReviewMutationResponse } from \"./types\"\nimport { useIsDesktop } from \"@/lib/hooks/useMediaQuery\"\nimport { usePaginatedReviews, type ReviewFilter } from \"@/lib/hooks\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Sheet, SheetContent, SheetTitle } from \"@/components/ui/sheet\"\nimport { CheckCircle2, MessageSquare, RefreshCw, Send, X } from \"@/components/icons\"\n\nconst QUEUE_FILTER_OPTIONS: Array<{ value: ReviewFilter; label: string }> = [\n  { value: \"unanswered\", label: \"Pending\" },\n  { value: \"urgent\", label: \"Urgent\" },\n  { value: \"five_star\", label: \"5 Star\" },\n  { value: \"mentions\", label: \"Mentions\" },\n  { value: \"all\", label: \"All\" },\n]\n\nfunction parseInitialTab(input: string | null, fallback: \"all\" | \"pending\" | \"replied\") {\n  if (input === \"all\" || input === \"pending\" || input === \"replied\") return input\n  return fallback\n}\n\nfunction parseInitialRating(input: string | null) {\n  if (!input) return \"all\"\n  const num = Number(input)\n  if (!Number.isFinite(num) || num < 1 || num > 5) return \"all\"\n  return String(Math.floor(num))\n}\n\ntype InboxClientProps = {\n  ssrBootstrap: InboxBootstrap | null\n}\n\nexport default function InboxClient({ ssrBootstrap }: InboxClientProps) {\n  const searchParams = useSearchParams()\n  \n  // Memoize initial parameters parsing to prevent unnecessary recalculations\n  const initialParams = React.useMemo(() => {\n    const filter = parseFilter(searchParams.get(\"filter\"))\n    const tab = parseInitialTab(searchParams.get(\"tab\"), filter === \"all\" ? \"all\" : \"pending\")\n    const mention = searchParams.get(\"mention\")?.trim().toLowerCase() ?? \"\"\n    const locationId = searchParams.get(\"locationId\")?.trim() ?? \"\"\n    const rating = parseInitialRating(searchParams.get(\"rating\"))\n    \n    const effectiveFilter = filter === \"mentions\" && mention.length === 0 ? \"all\" : filter\n    const remoteFilter = resolveRemoteFilter(effectiveFilter, tab)\n    const remoteStatus = tab === \"pending\" ? \"pending\" : tab === \"replied\" ? \"replied\" : \"all\"\n    const remoteMention = effectiveFilter === \"mentions\" ? mention || undefined : undefined\n\n    return { filter, tab, mention, locationId, rating, remoteFilter, remoteStatus, remoteMention }\n  }, [searchParams])\n\n  const [bootstrap, setBootstrap] = React.useState<InboxBootstrap | null>(ssrBootstrap)\n  const [bootstrapLoading, setBootstrapLoading] = React.useState(ssrBootstrap === null)\n\n  const [baseFilter, setBaseFilter] = React.useState<ReviewFilter>(initialParams.filter)\n  const [mentionFilter, setMentionFilter] = React.useState(initialParams.mention)\n  const [searchQuery, setSearchQuery] = React.useState(\"\")\n  const [locationFilter, setLocationFilter] = React.useState(initialParams.locationId || \"all\")\n  const [ratingFilter, setRatingFilter] = React.useState(initialParams.rating)\n  const [activeTab, setActiveTab] = React.useState<\"all\" | \"pending\" | \"replied\">(initialParams.tab)\n  const [activeReviewId, setActiveReviewId] = React.useState<string | null>(null)\n\n  const [showBlitzSheet, setShowBlitzSheet] = React.useState(false)\n  const [showDetailSheet, setShowDetailSheet] = React.useState(false)\n  const [showFilterSheet, setShowFilterSheet] = React.useState(false)\n\n  const [selectionMode, setSelectionMode] = React.useState(false)\n  const [selectedIds, setSelectedIds] = React.useState<string[]>([])\n  const [quickApproveLoadingId, setQuickApproveLoadingId] = React.useState<string | null>(null)\n  const [bulkActionLoading, setBulkActionLoading] = React.useState(false)\n\n  const isDesktop = useIsDesktop()\n  const debouncedSearch = useDebouncedValue(searchQuery, 320)\n  const filterSheetSide: \"right\" | \"bottom\" = isDesktop ? \"right\" : \"bottom\"\n\n  React.useEffect(() => {\n    if (ssrBootstrap !== null) return\n\n    setBootstrapLoading(true)\n    void (async () => {\n      try {\n        const { remoteFilter, remoteStatus, remoteMention, locationId, rating } = initialParams\n        const params = new URLSearchParams({\n          filter: remoteFilter,\n          status: remoteStatus,\n          includeCounts: \"1\",\n        })\n        if (remoteMention) params.set(\"mention\", remoteMention)\n        if (locationId) params.set(\"locationId\", locationId)\n        if (rating !== \"all\") params.set(\"rating\", rating)\n\n        const data = await apiCall<InboxBootstrap>(`/api/inbox/bootstrap?${params.toString()}`, \"GET\")\n        setBootstrap(data)\n      } catch (error) {\n        toast.error(error instanceof Error ? error.message : \"Failed to load inbox settings\")\n      } finally {\n        setBootstrapLoading(false)\n      }\n    })()\n  }, [ssrBootstrap, initialParams])\n\n  React.useEffect(() => {\n    if (isDesktop) {\n      setShowDetailSheet(false)\n    }\n  }, [isDesktop])\n\n  React.useEffect(() => {\n    if (!selectionMode) {\n      setSelectedIds([])\n    }\n  }, [selectionMode])\n\n  const mentionKeywords = React.useMemo(() => {\n    return Array.from(\n      new Set(\n        (bootstrap?.mentionKeywords ?? [])\n          .map((keyword) => keyword.trim().toLowerCase())\n          .filter(Boolean),\n      ),\n    )\n  }, [bootstrap?.mentionKeywords])\n\n  React.useEffect(() => {\n    if (mentionFilter.trim()) return\n    if (mentionKeywords.length === 0) return\n    setMentionFilter(mentionKeywords[0])\n  }, [mentionFilter, mentionKeywords])\n\n  React.useEffect(() => {\n    if (baseFilter === \"mentions\" && mentionKeywords.length === 0) {\n      setBaseFilter(\"unanswered\")\n    }\n  }, [baseFilter, mentionKeywords.length])\n\n  const mentionSelection = mentionFilter.trim().toLowerCase()\n  const effectiveBaseFilter = baseFilter === \"mentions\" && mentionSelection.length === 0 ? \"all\" : baseFilter\n  const remoteFilter = resolveRemoteFilter(effectiveBaseFilter, activeTab)\n  const remoteStatus = activeTab === \"pending\" ? \"pending\" : activeTab === \"replied\" ? \"replied\" : \"all\"\n\n  const normalizedMention = effectiveBaseFilter === \"mentions\" ? mentionSelection || undefined : undefined\n  const normalizedSearch = debouncedSearch.trim() || undefined\n  const normalizedLocation = locationFilter === \"all\" ? undefined : locationFilter\n  const normalizedRating = ratingFilter === \"all\" ? undefined : Number(ratingFilter)\n\n  const { rows, counts, loading, loadingMore, error, hasMore, loadMore, refresh, updateRow } = usePaginatedReviews({\n    filter: remoteFilter,\n    mention: normalizedMention,\n    status: remoteStatus,\n    search: normalizedSearch,\n    locationId: normalizedLocation,\n    rating: Number.isFinite(normalizedRating) ? normalizedRating : undefined,\n    enabled: !bootstrapLoading,\n    initialPage: bootstrap?.initialPage ?? null,\n  })\n\n  const { generateDraft, saveDraft, verifyDraft, publishReply } = useReviewMutations({\n    rows,\n    updateRow,\n    refresh,\n  })\n\n  // Grouped mutation handlers\n  const mutations = React.useMemo(() => ({\n    generateDraft, saveDraft, verifyDraft, publishReply\n  }), [generateDraft, saveDraft, verifyDraft, publishReply])\n\n  React.useEffect(() => {\n    if (!error) return\n    if (error === \"mention is required when filter=mentions.\") {\n      toast.error(\"Pick a keyword before using the mentions queue.\")\n      return\n    }\n    toast.error(error === \"SESSION_EXPIRED\" ? \"Session expired. Please sign in again.\" : error)\n  }, [error])\n\n  React.useEffect(() => {\n    setSelectedIds((prev) => prev.filter((id) => rows.some((row) => row.id === id)))\n  }, [rows])\n\n  React.useEffect(() => {\n    if (activeReviewId && !rows.some((row) => row.id === activeReviewId)) {\n      setActiveReviewId(null)\n      setShowDetailSheet(false)\n    }\n  }, [rows, activeReviewId])\n\n  React.useEffect(() => {\n    if (!activeReviewId && rows.length > 0 && !loading) {\n      setActiveReviewId(rows[0].id)\n    }\n  }, [activeReviewId, rows, loading])\n\n  const activeRow = React.useMemo(() => rows.find((row) => row.id === activeReviewId) ?? null, [rows, activeReviewId])\n  const pendingRows = React.useMemo(() => rows.filter((row) => row.status === \"pending\"), [rows])\n  const eligibleBulkIds = React.useMemo(\n    () => rows.filter((row) => canBulkApprove(row)).map((row) => row.id),\n    [rows],\n  )\n\n  const pendingCount = counts?.unanswered ?? rows.filter((row) => row.status === \"pending\").length\n\n  const activeFiltersCount =\n    (searchQuery ? 1 : 0) +\n    (locationFilter !== \"all\" ? 1 : 0) +\n    (ratingFilter !== \"all\" ? 1 : 0) +\n    (baseFilter !== \"unanswered\" ? 1 : 0)\n\n  const applyFilter = React.useCallback(\n    (next: ReviewFilter) => {\n      setBaseFilter(next)\n\n      if ((next === \"unanswered\" || next === \"urgent\") && activeTab === \"replied\") {\n        setActiveTab(\"pending\")\n      }\n\n      if (next === \"mentions\" && !mentionFilter.trim() && mentionKeywords.length > 0) {\n        setMentionFilter(mentionKeywords[0])\n      }\n    },\n    [activeTab, mentionFilter, mentionKeywords],\n  )\n\n  const clearAllFilters = React.useCallback(() => {\n    setSearchQuery(\"\")\n    setLocationFilter(\"all\")\n    setRatingFilter(\"all\")\n    setBaseFilter(\"unanswered\")\n    if (mentionKeywords.length > 0) {\n      setMentionFilter(mentionKeywords[0])\n    }\n  }, [mentionKeywords])\n\n  const openBlitzQuickReply = React.useCallback((fromEvent = false) => {\n    setActiveTab(\"pending\")\n    setBaseFilter(\"all\")\n    setSearchQuery(\"\")\n    setLocationFilter(\"all\")\n    setRatingFilter(\"all\")\n    setSelectionMode(false)\n    setShowFilterSheet(false)\n    setShowDetailSheet(false)\n    setShowBlitzSheet(true)\n\n    if (fromEvent) {\n      toast.success(\"Quick Reply opened\")\n    }\n  }, [])\n\n  React.useEffect(() => {\n    const handler = () => openBlitzQuickReply(true)\n    window.addEventListener(\"replyai:open-blitz\", handler)\n    return () => window.removeEventListener(\"replyai:open-blitz\", handler)\n  }, [openBlitzQuickReply])\n\n  const toggleSelectionById = React.useCallback((reviewId: string, checked: boolean) => {\n    setSelectedIds((prev) => {\n      if (checked) return prev.includes(reviewId) ? prev : [...prev, reviewId]\n      return prev.filter((id) => id !== reviewId)\n    })\n  }, [])\n\n  const handleOpenReview = React.useCallback(\n    (reviewId: string) => {\n      setActiveReviewId(reviewId)\n      if (!isDesktop) {\n        setShowDetailSheet(true)\n      }\n    },\n    [isDesktop],\n  )\n\n  const handleQuickApprove = React.useCallback(\n    async (reviewId: string) => {\n      const row = rows.find((item) => item.id === reviewId)\n      if (!row?.currentDraft?.text?.trim()) return\n\n      setQuickApproveLoadingId(reviewId)\n      try {\n        await publishReply(reviewId, row.currentDraft.text, row)\n      } catch (error) {\n        toast.error(error instanceof Error ? error.message : \"Quick approve failed\")\n      } finally {\n        setQuickApproveLoadingId(null)\n      }\n    },\n    [publishReply, rows],\n  )\n\n  const handleBulkApprove = React.useCallback(async () => {\n    if (!bootstrap?.bulkApproveEnabled) {\n      toast.error(\"Bulk approve is disabled in settings.\")\n      return\n    }\n\n    const eligibleIds = selectedIds.filter((id) => {\n      const row = rows.find((item) => item.id === id)\n      return row ? canBulkApprove(row) : false\n    })\n\n    if (eligibleIds.length === 0) {\n      toast.error(\"Select 5-star pending reviews with verified drafts.\")\n      return\n    }\n\n    setBulkActionLoading(true)\n    try {\n      await apiCall<ReviewMutationResponse>(\"/api/replies/bulk-approve\", \"POST\", {\n        reviewIds: eligibleIds.slice(0, 50),\n      })\n      toast.success(`${eligibleIds.length} replies published`)\n      setSelectedIds([])\n      setSelectionMode(false)\n      void refresh()\n    } catch (error) {\n      toast.error(error instanceof Error ? error.message : \"Bulk approve failed\")\n    } finally {\n      setBulkActionLoading(false)\n    }\n  }, [bootstrap?.bulkApproveEnabled, refresh, rows, selectedIds])\n\n  const detailContent = activeRow ? (\n    <DetailPanel\n      row={activeRow}\n      onGenerate={mutations.generateDraft}\n      onSave={mutations.saveDraft}\n      onVerify={mutations.verifyDraft}\n      onPublish={mutations.publishReply}\n    />\n  ) : (\n    <EmptyState\n      icon={MessageSquare}\n      title=\"Nothing selected\"\n      description=\"Choose a review from the list to see details and reply tools.\"\n    />\n  )\n\n  const locations = bootstrap?.locations ?? []\n  const queueOptions = React.useMemo(\n    () =>\n      QUEUE_FILTER_OPTIONS.map((option) => ({\n        value: option.value,\n        label: option.label,\n        disabled: option.value === \"mentions\" && mentionKeywords.length === 0,\n      })),\n    [mentionKeywords.length],\n  )\n\n  return (\n    <div\n      className={cn(\n        \"flex h-full w-full flex-col overflow-hidden bg-background text-foreground\",\n      )}\n    >\n      <InboxHeader\n        pendingCount={pendingCount}\n        loading={loading}\n        searchQuery={searchQuery}\n        onSearchQueryChange={setSearchQuery}\n        activeTab={activeTab}\n        onActiveTabChange={setActiveTab}\n        activeFiltersCount={activeFiltersCount}\n        onOpenFilters={() => setShowFilterSheet(true)}\n        onOpenQuickReply={() => openBlitzQuickReply(false)}\n        quickReplyDisabled={pendingRows.length === 0}\n        bulkApproveEnabled={Boolean(bootstrap?.bulkApproveEnabled)}\n        selectionMode={selectionMode}\n        onToggleSelectionMode={() => setSelectionMode((prev) => !prev)}\n        eligibleBulkCount={eligibleBulkIds.length}\n        onSelectReady={() => setSelectedIds(eligibleBulkIds)}\n        onRefresh={() => void refresh()}\n      />\n\n      <div className=\"flex-1 overflow-hidden md:grid md:grid-cols-[400px_minmax(0,1fr)] lg:grid-cols-[440px_minmax(0,1fr)] bg-zinc-50/50 dark:bg-zinc-950/20\">\n        <InboxReviewList\n          loading={loading}\n          bootstrapLoading={bootstrapLoading}\n          rows={rows}\n          activeReviewId={activeReviewId}\n          selectionMode={selectionMode}\n          selectedIds={selectedIds}\n          quickApproveLoadingId={quickApproveLoadingId}\n          hasMore={hasMore}\n          loadingMore={loadingMore}\n          onOpenReview={handleOpenReview}\n          onCheckedChange={toggleSelectionById}\n          onQuickApprove={handleQuickApprove}\n          onLoadMore={loadMore}\n        />\n\n        <motion.aside\n          initial={{ opacity: 0, x: 20 }}\n          animate={{ opacity: 1, x: 0 }}\n          className=\"hidden h-full overflow-hidden md:flex md:flex-col border-l border-border/50 bg-background/50 backdrop-blur-sm\"\n        >\n          {detailContent}\n        </motion.aside>\n      </div>\n\n      <AnimatePresence>\n        {selectionMode && selectedIds.length > 0 && (\n          <motion.div \n            initial={{ opacity: 0, y: 100, x: \"-50%\" }}\n            animate={{ opacity: 1, y: 0, x: \"-50%\" }}\n            exit={{ opacity: 0, y: 100, x: \"-50%\" }}\n            className=\"fixed left-1/2 bottom-8 z-50 min-w-[320px] max-w-[90vw]\"\n          >\n            <div className=\"rounded-[24px] border border-primary/20 bg-background/80 backdrop-blur-xl p-4 shadow-google-xl flex items-center justify-between gap-6\">\n              <div className=\"flex items-center gap-3 pl-2\">\n                <div className=\"h-10 w-10 rounded-xl bg-primary flex items-center justify-center text-primary-foreground shadow-glow-primary\">\n                  <CheckCircle2 className=\"h-5 w-5\" />\n                </div>\n                <div>\n                  <div className=\"text-sm font-black text-foreground tabular-nums\">{selectedIds.length} Selected</div>\n                  <div className=\"text-[10px] font-bold text-muted-foreground uppercase tracking-widest\">Ready for batch action</div>\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                <Button \n                  type=\"button\" \n                  size=\"sm\" \n                  onClick={handleBulkApprove} \n                  disabled={bulkActionLoading}\n                  className=\"h-11 rounded-xl bg-primary px-6 font-black shadow-glow-primary hover:bg-primary/90 transition-all\"\n                >\n                  {bulkActionLoading ? (\n                    <motion.div animate={{ rotate: 360 }} transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}>\n                      <RefreshCw className=\"mr-2 h-4 w-4\" />\n                    </motion.div>\n                  ) : (\n                    <Send className=\"mr-2 h-4 w-4\" />\n                  )}\n                  Post Batch\n                </Button>\n\n                <Button \n                  type=\"button\" \n                  size=\"icon\" \n                  variant=\"ghost\" \n                  onClick={() => setSelectedIds([])}\n                  className=\"h-11 w-11 rounded-xl text-muted-foreground hover:bg-muted\"\n                >\n                  <X className=\"h-5 w-5\" />\n                </Button>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      <Sheet open={showBlitzSheet} onOpenChange={setShowBlitzSheet}>\n        <SheetContent side=\"right\" className=\"h-screen w-screen max-w-none p-0 border-none\">\n          <SheetTitle className=\"sr-only\">Quick Reply Blitz Mode</SheetTitle>\n          <BlitzQuickReply\n            pendingRows={pendingRows}\n            focusReviewId={activeReviewId}\n            onGenerate={generateDraft}\n            onSave={saveDraft}\n            onPublish={publishReply}\n          />\n        </SheetContent>\n      </Sheet>\n\n      <Sheet open={showDetailSheet} onOpenChange={setShowDetailSheet}>\n        <SheetContent side=\"right\" className=\"w-full max-w-none p-0 md:hidden\">\n          <SheetTitle className=\"sr-only\">Review details</SheetTitle>\n          {detailContent}\n        </SheetContent>\n      </Sheet>\n\n      <InboxFiltersSheet\n        open={showFilterSheet}\n        onOpenChange={setShowFilterSheet}\n        side={filterSheetSide}\n        queueOptions={queueOptions}\n        baseFilter={baseFilter}\n        onBaseFilterChange={applyFilter}\n        locationFilter={locationFilter}\n        onLocationFilterChange={setLocationFilter}\n        locations={locations}\n        ratingFilter={ratingFilter}\n        onRatingFilterChange={setRatingFilter}\n        showMentionFilter={effectiveBaseFilter === \"mentions\" && mentionKeywords.length > 0}\n        mentionFilter={mentionFilter}\n        onMentionFilterChange={setMentionFilter}\n        mentionKeywords={mentionKeywords}\n        onClearAll={clearAllFilters}\n      />\n    </div>\n  )\n}\n"
    },
    {
      "path": "app/(app)/inbox/model.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/model.ts",
      "bytes": 1905,
      "content": "import type { ReviewDetail, ReviewFilter, ReviewRow } from \"@/lib/hooks\"\nimport { mapReviewDetailToRow } from \"@/lib/reviews/detail-to-row\"\nimport { getFirstVerifierIssueMessage } from \"@/lib/reviews/verifier-result\"\n\nexport function parseFilter(input: string | null): ReviewFilter {\n  const value = (input ?? \"\").toLowerCase()\n  if (value === \"unanswered\" || value === \"urgent\" || value === \"five_star\" || value === \"mentions\" || value === \"all\") {\n    return value\n  }\n  return \"unanswered\"\n}\n\nexport function resolveRemoteFilter(baseFilter: ReviewFilter, tab: \"all\" | \"pending\" | \"replied\"): ReviewFilter {\n  if (tab === \"replied\") {\n    return baseFilter === \"unanswered\" || baseFilter === \"urgent\" ? \"all\" : baseFilter\n  }\n  if (tab === \"all\") {\n    return baseFilter === \"unanswered\" ? \"all\" : baseFilter\n  }\n  return baseFilter\n}\n\nexport function canBulkApprove(row: ReviewRow) {\n  return row.status === \"pending\" && row.starRating === 5 && row.draftStatus === \"READY\"\n}\n\nexport function initials(name: string) {\n  const parts = name.trim().split(/\\s+/).filter(Boolean)\n  const first = parts[0]?.[0] ?? \"?\"\n  const last = parts.length > 1 ? parts[parts.length - 1]?.[0] : \"\"\n  return (first + last).toUpperCase()\n}\n\nexport function mapDetailToRow(existing: ReviewRow, detail: ReviewDetail): ReviewRow {\n  return mapReviewDetailToRow(detail, existing)\n}\n\nexport function applyDetailSnapshot(\n  reviewId: string,\n  detail: ReviewDetail | null | undefined,\n  updateRow: (id: string, updater: (row: ReviewRow) => ReviewRow) => void,\n) {\n  if (!detail) return false\n  updateRow(reviewId, (row) => mapDetailToRow(row, detail))\n  return true\n}\n\nexport function getVerifierBlockedMessage(detail: ReviewDetail | null) {\n  const firstMessage = getFirstVerifierIssueMessage(detail?.currentDraft?.verifierResultJson ?? null)\n  return firstMessage ?? \"Draft was blocked by verifier. Please adjust and retry.\"\n}\n"
    },
    {
      "path": "app/(app)/inbox/network.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/network.ts",
      "bytes": 10509,
      "content": "import { withIdempotencyHeader } from \"@/lib/api/client-idempotency\"\nimport { extractClientErrorMessage } from \"@/lib/api/client-error\"\n\nimport type { ReviewDetail } from \"@/lib/hooks\"\n\nconst JOB_POLL_BASE_MS = 900\nconst JOB_POLL_MAX_MS = 2600\nconst JOB_SSE_MIN_BUDGET_MS = 900\nconst JOB_SSE_MAX_BUDGET_MS = 12_000\nconst JOB_SSE_CLOSE_GRACE_MS = 1_250\nconst JOB_TERMINAL_CACHE_TTL_MS = 15_000\nconst JOB_TERMINAL_CACHE_MAX_ENTRIES = 512\nconst REVIEW_POLL_INTERVAL_MS = 650\n\ntype JobStatus = \"PENDING\" | \"RUNNING\" | \"RETRYING\" | \"COMPLETED\" | \"FAILED\" | \"CANCELLED\"\n\ntype JobDetail = {\n  id: string\n  type: string\n  status: JobStatus\n  attempts: number\n  maxAttempts: number\n  runAtIso: string\n  lockedAtIso: string | null\n  completedAtIso: string | null\n  lastError: string | null\n  retryAfterSec?: number | null\n}\n\ntype JobStatusResponse = {\n  job: JobDetail\n}\n\ntype JobStreamEvent = {\n  kind: \"snapshot\" | \"transition\" | \"terminal\"\n  job: JobDetail\n  review?: ReviewDetail | null\n}\n\ntype JobStreamTimeoutEvent = {\n  kind: \"timeout\"\n  job: JobDetail | null\n}\n\ntype TerminalJobCacheEntry = {\n  job: JobDetail\n  expiresAt: number\n}\n\nexport type JobCompletionResult = {\n  job: JobDetail\n  review: ReviewDetail | null\n}\n\nconst terminalJobCache = new Map<string, TerminalJobCacheEntry>()\nconst inflightJobDetailRequests = new Map<string, Promise<JobDetail | null>>()\nconst JOB_STATUS_VALUES = new Set<JobStatus>([\"PENDING\", \"RUNNING\", \"RETRYING\", \"COMPLETED\", \"FAILED\", \"CANCELLED\"])\n\nfunction sleep(ms: number) {\n  return new Promise((resolve) => setTimeout(resolve, ms))\n}\n\nfunction isTerminalJobStatus(status: JobStatus) {\n  return status === \"COMPLETED\" || status === \"FAILED\" || status === \"CANCELLED\"\n}\n\nfunction trimExpiredTerminalCache(now: number) {\n  for (const [key, value] of terminalJobCache.entries()) {\n    if (value.expiresAt <= now) {\n      terminalJobCache.delete(key)\n    }\n  }\n}\n\nfunction getCachedTerminalJob(jobId: string): JobDetail | null {\n  const now = Date.now()\n  const cached = terminalJobCache.get(jobId)\n  if (!cached) return null\n  if (cached.expiresAt <= now) {\n    terminalJobCache.delete(jobId)\n    return null\n  }\n  return cached.job\n}\n\nfunction cacheTerminalJob(job: JobDetail) {\n  if (!isTerminalJobStatus(job.status)) return\n\n  const now = Date.now()\n  trimExpiredTerminalCache(now)\n  terminalJobCache.set(job.id, { job, expiresAt: now + JOB_TERMINAL_CACHE_TTL_MS })\n  while (terminalJobCache.size > JOB_TERMINAL_CACHE_MAX_ENTRIES) {\n    const oldest = terminalJobCache.keys().next()\n    if (oldest.done) break\n    terminalJobCache.delete(oldest.value)\n  }\n}\n\nfunction resolveJobPollDelayMs(params: {\n  job: JobDetail | null\n  attempts: number\n  remainingMs: number\n}) {\n  const { job, attempts, remainingMs } = params\n  if (remainingMs <= 0) return 0\n\n  const retryAfterMs = Number(job?.retryAfterSec ?? 0) * 1000\n  if (Number.isFinite(retryAfterMs) && retryAfterMs > 0) {\n    return Math.min(remainingMs, Math.max(JOB_POLL_BASE_MS, Math.min(4_000, retryAfterMs)))\n  }\n\n  const status = job?.status\n  const computedDelay =\n    status === \"PENDING\"\n      ? JOB_POLL_BASE_MS + attempts * 260\n      : status === \"RUNNING\"\n        ? JOB_POLL_BASE_MS + attempts * 210\n        : status === \"RETRYING\"\n          ? JOB_POLL_BASE_MS + 450 + attempts * 320\n          : JOB_POLL_BASE_MS + attempts * 240\n\n  return Math.min(remainingMs, Math.max(JOB_POLL_BASE_MS, Math.min(JOB_POLL_MAX_MS, computedDelay)))\n}\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return typeof value === \"object\" && value !== null\n}\n\nfunction parseJobDetail(value: unknown): JobDetail | null {\n  if (!isRecord(value)) return null\n  const status = value.status\n  if (\n    typeof value.id !== \"string\" ||\n    typeof value.type !== \"string\" ||\n    typeof status !== \"string\" ||\n    !JOB_STATUS_VALUES.has(status as JobStatus)\n  ) {\n    return null\n  }\n  return value as JobDetail\n}\n\nfunction parseJobStreamEvent(data: string): JobStreamEvent | JobStreamTimeoutEvent | null {\n  try {\n    const raw = JSON.parse(data) as unknown\n    if (!isRecord(raw) || typeof raw.kind !== \"string\") return null\n\n    if (raw.kind === \"timeout\") {\n      const job = parseJobDetail(raw.job)\n      return { kind: \"timeout\", job }\n    }\n\n    if (raw.kind !== \"snapshot\" && raw.kind !== \"transition\" && raw.kind !== \"terminal\") {\n      return null\n    }\n\n    const job = parseJobDetail(raw.job)\n    if (!job) return null\n    const review = raw.review as ReviewDetail | null | undefined\n    return { kind: raw.kind, job, review }\n  } catch {\n    return null\n  }\n}\n\nfunction resolveSseBudgetMs(timeoutMs: number) {\n  if (timeoutMs <= 0) return 0\n  if (timeoutMs <= JOB_SSE_MIN_BUDGET_MS) return timeoutMs\n\n  const proportional = Math.floor(timeoutMs * 0.6)\n  return Math.min(timeoutMs, Math.max(JOB_SSE_MIN_BUDGET_MS, Math.min(JOB_SSE_MAX_BUDGET_MS, proportional)))\n}\n\nexport async function apiCall<T>(url: string, method: string, body?: unknown): Promise<T> {\n  const upper = method.toUpperCase()\n  const mutating = [\"POST\", \"PUT\", \"PATCH\", \"DELETE\"].includes(upper)\n  const baseHeaders = body ? { \"content-type\": \"application/json\" } : undefined\n  const headers = mutating ? withIdempotencyHeader(baseHeaders) : baseHeaders\n\n  const response = await fetch(url, {\n    method: upper,\n    headers,\n    body: body ? JSON.stringify(body) : undefined,\n  })\n\n  const data = await response.json().catch(() => null)\n  if (!response.ok) {\n    throw new Error(\n      extractClientErrorMessage({\n        body: data,\n        statusText: response.statusText,\n      }),\n    )\n  }\n\n  return data as T\n}\n\nexport async function fetchReviewDetail(reviewId: string): Promise<ReviewDetail | null> {\n  const response = await fetch(`/api/reviews/${reviewId}`)\n  if (!response.ok) return null\n  return (await response.json().catch(() => null)) as ReviewDetail | null\n}\n\nexport async function fetchJobDetail(jobId: string): Promise<JobDetail | null> {\n  const cached = getCachedTerminalJob(jobId)\n  if (cached) return cached\n\n  const inflight = inflightJobDetailRequests.get(jobId)\n  if (inflight) {\n    return inflight\n  }\n\n  const request = (async () => {\n    const response = await fetch(`/api/jobs/${jobId}`)\n    if (!response.ok) return null\n    const data = (await response.json().catch(() => null)) as JobStatusResponse | null\n    const job = data?.job ?? null\n    if (job) {\n      cacheTerminalJob(job)\n    }\n    return job\n  })()\n\n  inflightJobDetailRequests.set(jobId, request)\n  try {\n    return await request\n  } finally {\n    if (inflightJobDetailRequests.get(jobId) === request) {\n      inflightJobDetailRequests.delete(jobId)\n    }\n  }\n}\n\nasync function waitForJobCompletionViaSse(jobId: string, timeoutMs: number): Promise<JobCompletionResult | null> {\n  if (timeoutMs <= 0) return null\n  if (typeof window === \"undefined\" || typeof EventSource === \"undefined\") return null\n\n  const streamUrl = `/api/jobs/${encodeURIComponent(jobId)}/events?timeoutMs=${Math.floor(timeoutMs)}`\n\n  return new Promise<JobCompletionResult | null>((resolve) => {\n    const source = new EventSource(streamUrl)\n    let settled = false\n    let guardTimer: ReturnType<typeof globalThis.setTimeout> | null = null\n\n    const finish = (value: JobCompletionResult | null) => {\n      if (settled) return\n      settled = true\n      if (guardTimer != null) {\n        globalThis.clearTimeout(guardTimer)\n      }\n      source.close()\n      resolve(value)\n    }\n\n    const handleMessage = (data: string) => {\n      const parsed = parseJobStreamEvent(data)\n      if (!parsed) return\n\n      if (parsed.kind === \"timeout\") {\n        finish(null)\n        return\n      }\n\n      if (!isTerminalJobStatus(parsed.job.status)) {\n        return\n      }\n\n      cacheTerminalJob(parsed.job)\n      finish({\n        job: parsed.job,\n        review: parsed.review ?? null,\n      })\n    }\n\n    const onJob = (event: Event) => {\n      const message = event as MessageEvent<string>\n      handleMessage(message.data)\n    }\n\n    const onTimeout = (event: Event) => {\n      const message = event as MessageEvent<string>\n      const parsed = parseJobStreamEvent(message.data)\n      if (parsed?.kind === \"timeout\") {\n        if (parsed.job) {\n          cacheTerminalJob(parsed.job)\n        }\n        finish(null)\n        return\n      }\n      finish(null)\n    }\n\n    source.onmessage = onJob as (event: MessageEvent<string>) => void\n    source.addEventListener(\"job\", onJob)\n    source.addEventListener(\"timeout\", onTimeout)\n    source.onerror = () => {\n      finish(null)\n    }\n\n    guardTimer = globalThis.setTimeout(() => {\n      finish(null)\n    }, timeoutMs + JOB_SSE_CLOSE_GRACE_MS)\n  })\n}\n\nasync function waitForJobCompletionByPolling(jobId: string, timeoutMs: number): Promise<JobCompletionResult | null> {\n  if (timeoutMs <= 0) return null\n\n  const cached = getCachedTerminalJob(jobId)\n  if (cached) {\n    return { job: cached, review: null }\n  }\n\n  const startedAt = Date.now()\n  let attempts = 0\n\n  while (Date.now() - startedAt < timeoutMs) {\n    const job = await fetchJobDetail(jobId)\n    if (job && (job.status === \"COMPLETED\" || job.status === \"FAILED\" || job.status === \"CANCELLED\")) {\n      return { job, review: null }\n    }\n\n    const elapsedMs = Date.now() - startedAt\n    const remainingMs = timeoutMs - elapsedMs\n    const delayMs = resolveJobPollDelayMs({ job, attempts, remainingMs })\n    if (delayMs <= 0) break\n    await sleep(delayMs)\n    attempts += 1\n  }\n\n  return null\n}\n\nexport async function waitForJobCompletion(jobId: string, timeoutMs: number): Promise<JobCompletionResult | null> {\n  if (timeoutMs <= 0) return null\n\n  const cached = getCachedTerminalJob(jobId)\n  if (cached) {\n    return { job: cached, review: null }\n  }\n\n  const startedAt = Date.now()\n  const sseBudgetMs = resolveSseBudgetMs(timeoutMs)\n  if (sseBudgetMs > 0) {\n    const streamed = await waitForJobCompletionViaSse(jobId, sseBudgetMs)\n    if (streamed) {\n      return streamed\n    }\n  }\n\n  const elapsedMs = Date.now() - startedAt\n  const remainingMs = timeoutMs - elapsedMs\n  if (remainingMs <= 0) return null\n\n  return waitForJobCompletionByPolling(jobId, remainingMs)\n}\n\nexport async function waitForReviewState(\n  reviewId: string,\n  predicate: (detail: ReviewDetail) => boolean,\n  timeoutMs: number,\n) {\n  const startedAt = Date.now()\n\n  while (Date.now() - startedAt < timeoutMs) {\n    const detail = await fetchReviewDetail(reviewId)\n    if (detail && predicate(detail)) {\n      return detail\n    }\n    await sleep(REVIEW_POLL_INTERVAL_MS)\n  }\n\n  return null\n}\n"
    },
    {
      "path": "app/(app)/inbox/page.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/page.tsx",
      "bytes": 2246,
      "content": "import { getSession } from \"@/lib/session\"\nimport { fetchInboxBootstrap } from \"@/lib/reviews/bootstrap\"\nimport { parseFilter, resolveRemoteFilter } from \"./model\"\nimport InboxClient from \"./InboxClient\"\nimport type { InboxBootstrap } from \"./types\"\n\nexport default async function InboxPage({\n  searchParams,\n}: {\n  searchParams: Promise<Record<string, string | string[] | undefined>>\n}) {\n  const params = await searchParams\n  const session = await getSession()\n\n  let ssrBootstrap: InboxBootstrap | null = null\n\n  if (session?.orgId) {\n    try {\n      const rawFilter = typeof params.filter === \"string\" ? params.filter : null\n      const rawTab = typeof params.tab === \"string\" ? params.tab : null\n      const rawMention = typeof params.mention === \"string\" ? params.mention.trim().toLowerCase() : \"\"\n      const rawLocationId = typeof params.locationId === \"string\" ? params.locationId.trim() : \"\"\n      const rawRating = typeof params.rating === \"string\" ? params.rating : null\n\n      const filter = parseFilter(rawFilter)\n      const derivedTab = filter === \"all\" ? \"all\" : \"pending\"\n      const tab =\n        rawTab === \"all\" || rawTab === \"pending\" || rawTab === \"replied\" ? rawTab : derivedTab\n\n      const effectiveFilter =\n        filter === \"mentions\" && rawMention.length === 0 ? \"all\" : filter\n      const remoteFilter = resolveRemoteFilter(effectiveFilter, tab)\n      const remoteStatus =\n        tab === \"pending\" ? \"pending\" : tab === \"replied\" ? \"replied\" : \"all\"\n      const remoteMention =\n        effectiveFilter === \"mentions\" ? rawMention || undefined : undefined\n\n      const ratingNum = rawRating ? Number(rawRating) : undefined\n      const validRating =\n        ratingNum && Number.isFinite(ratingNum) && ratingNum >= 1 && ratingNum <= 5\n          ? Math.floor(ratingNum)\n          : undefined\n\n      ssrBootstrap = await fetchInboxBootstrap({\n        orgId: session.orgId,\n        filter: remoteFilter,\n        status: remoteStatus as \"pending\" | \"replied\" | \"all\",\n        mention: remoteMention,\n        locationId: rawLocationId || undefined,\n        rating: validRating,\n        includeCounts: true,\n      })\n    } catch {\n      ssrBootstrap = null\n    }\n  }\n\n  return <InboxClient ssrBootstrap={ssrBootstrap} />\n}\n"
    },
    {
      "path": "app/(app)/inbox/types.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/types.ts",
      "bytes": 751,
      "content": "import type { ReviewDetail, ReviewFilter } from \"@/lib/hooks\"\nimport type { ReviewListPage } from \"@/lib/reviews/types\"\n\nexport type LocationOption = {\n  id: string\n  displayName: string\n}\n\nexport type InboxBootstrap = {\n  mentionKeywords: string[]\n  bulkApproveEnabled: boolean\n  locations: LocationOption[]\n  initialPage: (ReviewListPage & {\n    filter: ReviewFilter\n    status?: \"pending\" | \"replied\" | \"all\"\n    mention?: string | null\n  }) | null\n}\n\nexport type ReviewMutationResponse = {\n  accepted?: boolean\n  jobId?: string\n  verifyJobId?: string\n  job?: {\n    id: string\n    status: \"PENDING\" | \"RUNNING\" | \"RETRYING\" | \"COMPLETED\" | \"FAILED\"\n    lastError?: string | null\n  }\n  worker?: { claimed?: number }\n  review?: ReviewDetail | null\n}\n"
    },
    {
      "path": "app/(app)/layout.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/layout.tsx",
      "bytes": 613,
      "content": "import type { ReactNode } from \"react\"\nimport { redirect } from \"next/navigation\"\nimport { getSession } from \"@/lib/session\"\nimport { AppShell } from \"@/components/AppShell\"\n\nexport default async function AppLayout({ children }: { children: ReactNode }) {\n  const session = await getSession()\n  if (!session?.user?.id || !session.orgId) redirect(\"/signin\")\n\n  return (\n    <AppShell\n      user={{\n        name: session.user.name ?? null,\n        email: session.user.email ?? null,\n        image: session.user.image ?? null,\n        role: session.role ?? \"\",\n      }}\n    >\n      {children}\n    </AppShell>\n  )\n}\n\n"
    },
    {
      "path": "app/globals.css",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/globals.css",
      "bytes": 8522,
      "content": "/* Tailwind v4 (PostCSS): single entry import + explicit config link. */\n@import \"tailwindcss\";\n@config \"../tailwind.config.ts\";\n\n/* Tailwind v4 animation utilities used by shadcn components. */\n@import \"tw-animate-css\";\n\n/* shadcn Tailwind v4 helpers (custom variants/utilities). */\n@import \"shadcn/tailwind.css\";\n\n/*\n  Design system preset (manual cutover; do not run `shadcn create`):\n  - base: radix\n  - style: nova (zinc)\n  - theme: blue\n  - radius: large\n  - rtl: false\n  - font: noto-sans (via `next/font/google`, `--font-sans`)\n*/\n\n/*\n  Tailwind v4: expose design tokens as theme variables so utilities like\n  `bg-background`, `text-foreground`, `border-border`, `ring-ring`, etc work.\n*/\n@theme inline {\n  --color-border: hsl(var(--border));\n  --color-input: hsl(var(--input));\n  --color-ring: hsl(var(--ring));\n  --color-background: hsl(var(--background));\n  --color-foreground: hsl(var(--foreground));\n\n  --color-primary: hsl(var(--primary));\n  --color-primary-foreground: hsl(var(--primary-foreground));\n  --color-secondary: hsl(var(--secondary));\n  --color-secondary-foreground: hsl(var(--secondary-foreground));\n  --color-destructive: hsl(var(--destructive));\n  --color-destructive-foreground: hsl(var(--destructive-foreground));\n  --color-muted: hsl(var(--muted));\n  --color-muted-foreground: hsl(var(--muted-foreground));\n  --color-accent: hsl(var(--accent));\n  --color-accent-foreground: hsl(var(--accent-foreground));\n  --color-popover: hsl(var(--popover));\n  --color-popover-foreground: hsl(var(--popover-foreground));\n  --color-card: hsl(var(--card));\n  --color-card-foreground: hsl(var(--card-foreground));\n\n  /* Extended palette for reviews & accents */\n  --color-emerald-50: oklch(0.97 0.038 160);\n  --color-emerald-100: oklch(0.93 0.06 160);\n  --color-emerald-400: oklch(0.72 0.17 162);\n  --color-emerald-500: oklch(0.65 0.17 162);\n  --color-emerald-600: oklch(0.58 0.16 162);\n  --color-emerald-700: oklch(0.50 0.14 162);\n  --color-emerald-900: oklch(0.35 0.10 162);\n  --color-amber-50: oklch(0.98 0.04 90);\n  --color-amber-100: oklch(0.94 0.07 85);\n  --color-amber-400: oklch(0.82 0.19 84);\n  --color-amber-500: oklch(0.75 0.18 80);\n  --color-amber-600: oklch(0.68 0.18 80);\n  --color-amber-700: oklch(0.60 0.16 80);\n  --color-rose-50: oklch(0.97 0.03 15);\n  --color-rose-100: oklch(0.93 0.06 12);\n  --color-rose-500: oklch(0.62 0.2 15);\n  --color-rose-700: oklch(0.50 0.18 15);\n  --color-blue-50: oklch(0.97 0.02 250);\n  --color-blue-100: oklch(0.93 0.05 250);\n  --color-blue-200: oklch(0.88 0.08 250);\n  --color-blue-400: oklch(0.72 0.17 255);\n  --color-blue-500: oklch(0.62 0.22 260);\n  --color-blue-600: oklch(0.55 0.24 262);\n  --color-blue-700: oklch(0.48 0.22 262);\n  --color-blue-900: oklch(0.35 0.15 262);\n  --color-indigo-50: oklch(0.97 0.02 270);\n  --color-indigo-100: oklch(0.93 0.04 270);\n  --color-indigo-600: oklch(0.52 0.22 270);\n  --color-purple-50: oklch(0.97 0.02 300);\n  --color-purple-100: oklch(0.93 0.04 300);\n  --color-purple-600: oklch(0.52 0.22 300);\n  --color-zinc-50: oklch(0.985 0 0);\n  --color-zinc-100: oklch(0.96 0.003 264);\n  --color-zinc-200: oklch(0.92 0.004 264);\n  --color-zinc-300: oklch(0.87 0.006 264);\n  --color-zinc-400: oklch(0.71 0.01 264);\n  --color-zinc-500: oklch(0.55 0.014 264);\n  --color-zinc-600: oklch(0.44 0.015 264);\n  --color-zinc-700: oklch(0.37 0.013 264);\n  --color-zinc-800: oklch(0.27 0.006 264);\n  --color-zinc-900: oklch(0.21 0.006 264);\n  --color-zinc-950: oklch(0.15 0.004 264);\n\n  /* Spacing tokens */\n  --spacing-safe-bottom: env(safe-area-inset-bottom, 0px);\n}\n\n@layer base {\n  :root {\n    /* Modern Minimal (Zinc) */\n    --background: 0 0% 100%;\n    --foreground: 240 10% 3.9%;\n    --card: 0 0% 100%;\n    --card-foreground: 240 10% 3.9%;\n    --popover: 0 0% 100%;\n    --popover-foreground: 240 10% 3.9%;\n    --primary: 240 5.9% 10%;\n    --primary-foreground: 0 0% 98%;\n    --secondary: 240 4.8% 95.9%;\n    --secondary-foreground: 240 5.9% 10%;\n    --muted: 240 4.8% 95.9%;\n    --muted-foreground: 240 3.8% 46.1%;\n    --accent: 240 4.8% 95.9%;\n    --accent-foreground: 240 5.9% 10%;\n    --destructive: 0 84.2% 60.2%;\n    --destructive-foreground: 0 0% 98%;\n    --border: 240 5.9% 90%;\n    --input: 240 5.9% 90%;\n    --ring: 240 5.9% 10%;\n    --radius: 0.5rem;\n\n    /* Layout & depth */\n    --shadow-glass: 0 0 0 1px rgba(0,0,0,0.05), 0 2px 8px rgba(0,0,0,0.04);\n    --shadow-card: 0 1px 2px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.06);\n    --shadow-elevated: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n    --shadow-floating: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n\n    /* App layout */\n    --sidebar: var(--card);\n    --sidebar-foreground: var(--foreground);\n    --sidebar-muted: var(--muted);\n    --sidebar-border: var(--border);\n\n    /* Legacy compat */\n    --shadow-google-sm: var(--shadow-card);\n    --shadow-google-md: var(--shadow-elevated);\n    --shadow-google-lg: var(--shadow-floating);\n    --shadow-google-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n  }\n\n  .dark {\n    /* Modern Minimal (Dark Zinc, polished) */\n    --background: 240 10% 6%;\n    --foreground: 0 0% 95%;\n    --card: 240 8% 8%;\n    --card-foreground: 0 0% 95%;\n    --popover: 240 8% 8%;\n    --popover-foreground: 0 0% 95%;\n    --primary: 217 91% 60%;\n    --primary-foreground: 0 0% 100%;\n    --secondary: 240 4% 16%;\n    --secondary-foreground: 0 0% 95%;\n    --muted: 240 4% 14%;\n    --muted-foreground: 240 5% 65%;\n    --accent: 240 4% 14%;\n    --accent-foreground: 0 0% 95%;\n    --destructive: 0 63% 31%;\n    --destructive-foreground: 0 0% 95%;\n    --border: 240 4% 16%;\n    --input: 240 4% 16%;\n    --ring: 217 91% 60%;\n\n    --shadow-glass: 0 0 0 1px rgba(255, 255, 255, 0.06), 0 2px 8px rgba(0, 0, 0, 0.4);\n    --shadow-card: 0 1px 2px rgba(0, 0, 0, 0.4), 0 1px 3px rgba(0, 0, 0, 0.3);\n    --shadow-elevated: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -1px rgba(0, 0, 0, 0.3);\n    --shadow-floating: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);\n\n    --sidebar: var(--card);\n    --sidebar-foreground: var(--foreground);\n    --sidebar-muted: var(--muted);\n    --sidebar-border: var(--border);\n  }\n\n  html {\n    font-size: 15px;\n  }\n\n  @media (min-width: 768px) {\n    html {\n      font-size: 14px;\n    }\n  }\n\n  body {\n    @apply bg-background text-foreground antialiased;\n    font-feature-settings: \"cv11\", \"ss01\";\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n  }\n\n  * {\n    @apply border-border outline-ring/50;\n  }\n\n  /* Reduced motion: hard-disable animation/transitions app-wide. */\n  @media (prefers-reduced-motion: reduce) {\n    * {\n      animation-duration: 1ms !important;\n      animation-iteration-count: 1 !important;\n      transition-duration: 1ms !important;\n      scroll-behavior: auto !important;\n    }\n  }\n}\n\n@layer utilities {\n\n  /* Shadow system */\n  .shadow-glass {\n    box-shadow: var(--shadow-glass);\n  }\n\n  .shadow-glow-primary {\n    box-shadow: 0 0 20px -5px hsl(var(--primary) / 0.5);\n  }\n\n  .shadow-glow-emerald {\n    box-shadow: 0 0 20px -5px var(--color-emerald-500);\n  }\n\n  .dark .scrollbar-thin {\n    scrollbar-color: oklch(0.4 0 0) transparent;\n  }\n\n  .dark .scrollbar-thin::-webkit-scrollbar-thumb {\n    background-color: oklch(0.4 0 0);\n  }\n  \n  .shadow-dock {\n    box-shadow: 0 8px 32px -4px rgba(0, 0, 0, 0.1), 0 4px 16px -2px rgba(0, 0, 0, 0.05);\n  }\n\n  .shadow-card {\n    box-shadow: var(--shadow-card);\n  }\n\n  .shadow-elevated {\n    box-shadow: var(--shadow-elevated);\n  }\n\n  .shadow-floating {\n    box-shadow: var(--shadow-floating);\n  }\n\n  /* Legacy compat */\n  .shadow-google-sm {\n    box-shadow: var(--shadow-card);\n  }\n\n  .shadow-google-md {\n    box-shadow: var(--shadow-elevated);\n  }\n\n  .shadow-google-lg {\n    box-shadow: var(--shadow-floating);\n  }\n\n  .shadow-google-xl {\n    box-shadow: var(--shadow-google-xl);\n  }\n\n  /* Gradient text */\n  .text-gradient {\n    background-clip: text;\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n  }\n\n  /* Radix Accordion: height animation without JS (uses Radix CSS vars). */\n  @keyframes accordion-down {\n    from {\n      height: 0;\n    }\n    to {\n      height: var(--radix-accordion-content-height);\n    }\n  }\n\n  @keyframes accordion-up {\n    from {\n      height: var(--radix-accordion-content-height);\n    }\n    to {\n      height: 0;\n    }\n  }\n}\n\n.dark .scrollbar-thin {\n  scrollbar-color: oklch(0.4 0 0) transparent;\n}\n\n.dark .scrollbar-thin::-webkit-scrollbar-thumb {\n  background-color: oklch(0.4 0 0);\n}\n"
    },
    {
      "path": "app/layout.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/layout.tsx",
      "bytes": 920,
      "content": "import type { Metadata, Viewport } from \"next\"\nimport { Noto_Sans } from \"next/font/google\"\nimport \"@/app/globals.css\"\nimport { cn } from \"@/lib/utils\"\nimport { Providers } from \"@/components/Providers\"\n\nconst notoSans = Noto_Sans({\n  subsets: [\"latin\"],\n  weight: [\"400\", \"500\", \"600\", \"700\"],\n  variable: \"--font-sans\",\n})\n\nexport const viewport: Viewport = {\n  width: \"device-width\",\n  initialScale: 1,\n  viewportFit: \"cover\",\n}\n\nexport const metadata: Metadata = {\n  title: \"GBP Reviews\",\n  description: \"Google Business Profile Review Manager\",\n}\n\nexport default function RootLayout({ children }: { children: React.ReactNode }) {\n  return (\n    <html\n      lang=\"en\"\n      suppressHydrationWarning\n      dir=\"ltr\"\n      className={cn(notoSans.variable, \"font-sans\")}\n    >\n      <body className=\"min-h-screen bg-background text-foreground\">\n        <Providers>{children}</Providers>\n      </body>\n    </html>\n  )\n}\n"
    },
    {
      "path": "components/AppShell.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/AppShell.tsx",
      "bytes": 18468,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport Link from \"next/link\"\nimport { usePathname } from \"next/navigation\"\nimport { signOut } from \"next-auth/react\"\nimport { useTheme } from \"next-themes\"\nimport { SearchProvider } from \"@/components/search-context\"\nimport { cn } from \"@/lib/utils\"\nimport { REPLYAI_UNANSWERED_COUNT_EVENT } from \"@/lib/reviews/count-events\"\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\"\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\"\nimport {\n  Bell,\n  ChevronDown,\n  ChevronLeft,\n  ChevronRight,\n  Globe,\n  LayoutDashboard,\n  LogOut,\n  MessageSquare,\n  Moon,\n  Settings,\n  Sparkles,\n  Sun,\n  BarChart,\n} from \"@/components/icons\"\nimport { JobHealthWidget } from \"./JobHealthWidget\"\n\ntype UserShape = {\n  name: string | null\n  email: string | null\n  image: string | null\n  role: string\n}\n\ntype NavItem = {\n  href: string\n  label: string\n  shortLabel: string\n  Icon: React.ElementType\n}\n\nconst SIDEBAR_COLLAPSE_STORAGE_KEY = \"replyai.sidebarCollapsed\"\nconst UNANSWERED_CACHE_TTL_MS = 20_000\nconst UNANSWERED_POLL_INTERVAL_MS = 60_000\n\nlet unansweredCountCache = {\n  value: 0,\n  updatedAt: 0,\n}\n\nfunction isNavItemActive(pathname: string, href: string) {\n  return pathname === href || pathname.startsWith(`${href}/`)\n}\n\nfunction useUnansweredCountPolling() {\n  const [count, setCount] = React.useState<number>(() => unansweredCountCache.value)\n  const pathname = usePathname()\n  const onInboxPage = pathname.startsWith(\"/inbox\")\n  const pollEnabled = !onInboxPage\n  const [isVisible, setIsVisible] = React.useState(() => {\n    if (typeof document === \"undefined\") return true\n    return document.visibilityState === \"visible\"\n  })\n\n  React.useEffect(() => {\n    const onCountUpdate = (event: Event) => {\n      const detail = (event as CustomEvent<{ count?: unknown }>).detail\n      const next = Number(detail?.count)\n      if (!Number.isFinite(next)) return\n      unansweredCountCache = { value: next, updatedAt: Date.now() }\n      setCount(next)\n    }\n\n    window.addEventListener(REPLYAI_UNANSWERED_COUNT_EVENT, onCountUpdate as EventListener)\n    return () => {\n      window.removeEventListener(REPLYAI_UNANSWERED_COUNT_EVENT, onCountUpdate as EventListener)\n    }\n  }, [])\n\n  React.useEffect(() => {\n    const onVisibilityChange = () => {\n      setIsVisible(document.visibilityState === \"visible\")\n    }\n\n    document.addEventListener(\"visibilitychange\", onVisibilityChange)\n    return () => {\n      document.removeEventListener(\"visibilitychange\", onVisibilityChange)\n    }\n  }, [])\n\n  React.useEffect(() => {\n    if (!pollEnabled || !isVisible) return\n\n    let mounted = true\n    let timer: ReturnType<typeof setInterval> | null = null\n    let inflightController: AbortController | null = null\n\n    const run = async () => {\n      inflightController?.abort()\n      inflightController = new AbortController()\n      try {\n        const res = await fetch(\"/api/reviews/counts\", {\n          signal: inflightController.signal,\n        })\n        if (!mounted || !res.ok) return\n        const data = await res.json()\n        const next = Number(data?.counts?.unanswered)\n        if (Number.isFinite(next)) {\n          unansweredCountCache = { value: next, updatedAt: Date.now() }\n          setCount(next)\n        }\n      } catch {\n        // ignore polling failures\n      }\n    }\n\n    const cacheIsFresh = Date.now() - unansweredCountCache.updatedAt < UNANSWERED_CACHE_TTL_MS\n    if (cacheIsFresh) {\n      setCount(unansweredCountCache.value)\n    } else {\n      void run()\n    }\n\n    timer = setInterval(run, UNANSWERED_POLL_INTERVAL_MS)\n    return () => {\n      mounted = false\n      inflightController?.abort()\n      if (timer) clearInterval(timer)\n    }\n  }, [pollEnabled, isVisible])\n\n  return count\n}\n\nfunction viewLabelForPath(pathname: string) {\n  if (pathname.startsWith(\"/inbox\") || pathname.startsWith(\"/reviews/\")) return \"Inbox\"\n  if (pathname.startsWith(\"/locations\")) return \"Locations\"\n  if (pathname.startsWith(\"/settings\")) return \"Settings\"\n  if (pathname.startsWith(\"/system-health\")) return \"System Health\"\n  return \"Inbox\"\n}\n\nfunction initials(name: string | null | undefined) {\n  if (!name) return \"U\"\n  const parts = name.trim().split(/\\s+/)\n  const a = parts[0]?.[0] ?? \"U\"\n  const b = parts.length > 1 ? parts[parts.length - 1]?.[0] : \"\"\n  return `${a}${b}`.toUpperCase()\n}\n\nexport function AppShell({\n  user,\n  children,\n}: {\n  user: UserShape\n  children: React.ReactNode\n}) {\n  const pathname = usePathname()\n  const unanswered = useUnansweredCountPolling()\n  const viewLabel = viewLabelForPath(pathname)\n  const [sidebarCollapsed, setSidebarCollapsed] = React.useState(false)\n  const [mounted, setMounted] = React.useState(false)\n  const { theme, setTheme } = useTheme()\n\n  React.useEffect(() => {\n    setMounted(true)\n  }, [])\n\n  React.useEffect(() => {\n    try {\n      const raw = window.localStorage.getItem(SIDEBAR_COLLAPSE_STORAGE_KEY)\n      if (raw) setSidebarCollapsed(raw === \"1\")\n    } catch {\n      // Ignore storage failures.\n    }\n  }, [])\n\n  React.useEffect(() => {\n    try {\n      window.localStorage.setItem(SIDEBAR_COLLAPSE_STORAGE_KEY, sidebarCollapsed ? \"1\" : \"0\")\n    } catch {\n      // Ignore storage failures.\n    }\n  }, [sidebarCollapsed])\n\n  const items: NavItem[] = [\n    { href: \"/inbox\", label: \"Inbox\", shortLabel: \"Inbox\", Icon: MessageSquare },\n    { href: \"/locations\", label: \"Locations\", shortLabel: \"Places\", Icon: LayoutDashboard },\n    { href: \"/settings\", label: \"Settings\", shortLabel: \"Settings\", Icon: Settings },\n    { href: \"/system-health\", label: \"System Health\", shortLabel: \"Health\", Icon: BarChart },\n  ]\n\n  const toggleTheme = () => {\n    setTheme(theme === \"dark\" ? \"light\" : \"dark\")\n  }\n\n  return (\n    <SearchProvider>\n      <TooltipProvider delayDuration={300}>\n        <div className=\"flex h-screen w-full overflow-hidden bg-background text-foreground\">\n          <aside\n            className={cn(\n              \"hidden shrink-0 flex-col border-r border-border bg-card transition-[width] duration-300 lg:flex\",\n              sidebarCollapsed ? \"w-[72px]\" : \"w-64\",\n            )}\n          >\n            <div className=\"border-b border-border p-4\">\n              <div className=\"flex items-center justify-between\">\n                <Link\n                  href=\"/inbox\"\n                  className={cn(\"flex items-center\", sidebarCollapsed ? \"gap-0\" : \"gap-2.5\")}\n                  aria-label=\"Go to inbox\"\n                >\n                  <div className=\"rounded-xl bg-primary p-2 shadow-glow-primary\">\n                    <Sparkles className=\"h-5 w-5 text-primary-foreground\" />\n                  </div>\n                  <span\n                    className={cn(\n                      \"overflow-hidden whitespace-nowrap text-lg font-bold tracking-tight text-foreground transition-all duration-300\",\n                      sidebarCollapsed ? \"max-w-0 opacity-0\" : \"max-w-[180px] opacity-100\",\n                    )}\n                  >\n                    ReplyAI\n                  </span>\n                </Link>\n\n                <Tooltip>\n                  <TooltipTrigger asChild>\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => setSidebarCollapsed(!sidebarCollapsed)}\n                      aria-label={sidebarCollapsed ? \"Expand sidebar\" : \"Collapse sidebar\"}\n                      className=\"h-8 w-8 text-muted-foreground hover:bg-muted/80 hover:text-foreground\"\n                    >\n                      {sidebarCollapsed ? <ChevronRight className=\"h-4 w-4\" /> : <ChevronLeft className=\"h-4 w-4\" />}\n                    </Button>\n                  </TooltipTrigger>\n                  <TooltipContent side=\"right\">{sidebarCollapsed ? \"Expand\" : \"Collapse\"}</TooltipContent>\n                </Tooltip>\n              </div>\n            </div>\n\n            <ScrollArea className=\"flex-1 px-3 py-4\">\n              <nav className=\"space-y-1.5\" aria-label=\"Main navigation\">\n                {items.map((item) => {\n                  const isActive = isNavItemActive(pathname, item.href)\n                  const showCount = item.href === \"/inbox\" && unanswered > 0\n\n                  return (\n                    <Tooltip key={item.href}>\n                      <TooltipTrigger asChild>\n                        <Link\n                          href={item.href}\n                          prefetch={true}\n                          aria-current={isActive ? \"page\" : undefined}\n                          className={cn(\n                            \"group relative flex items-center gap-3 rounded-xl px-3 py-2.5 text-sm font-medium transition-all duration-200\",\n                            sidebarCollapsed && \"justify-center px-0\",\n                            isActive\n                              ? \"bg-primary text-primary-foreground shadow-glow-primary\"\n                              : \"text-muted-foreground hover:bg-muted/80 hover:text-foreground\",\n                          )}\n                        >\n                          <item.Icon\n                            className={cn(\n                              \"h-5 w-5 shrink-0 transition-transform duration-200 group-hover:scale-110\",\n                              isActive ? \"text-primary-foreground\" : \"text-muted-foreground group-hover:text-foreground\",\n                            )}\n                          />\n                          {!sidebarCollapsed ? <span className=\"truncate\">{item.label}</span> : null}\n                          {showCount && !sidebarCollapsed ? (\n                            <Badge className={cn(\n                              \"ml-auto rounded-full px-1.5 py-0.5 text-[10px] font-bold\",\n                              isActive ? \"bg-primary-foreground text-primary\" : \"bg-primary text-primary-foreground\"\n                            )}>\n                              {unanswered > 99 ? \"99+\" : unanswered}\n                            </Badge>\n                          ) : null}\n                        </Link>\n                      </TooltipTrigger>\n                      {sidebarCollapsed ? (\n                        <TooltipContent side=\"right\" sideOffset={10} className=\"font-semibold\">\n                          {item.label}\n                          {showCount ? ` (${unanswered})` : \"\"}\n                        </TooltipContent>\n                      ) : null}\n                    </Tooltip>\n                  )\n                })}\n              </nav>\n\n              <div className=\"mt-8 space-y-4\">\n                <div className={cn(\n                  \"px-3 text-[10px] font-bold uppercase tracking-widest text-muted-foreground/50 transition-opacity duration-300\",\n                  sidebarCollapsed ? \"opacity-0\" : \"opacity-100\"\n                )}>\n                  System\n                </div>\n                <JobHealthWidget compact={sidebarCollapsed} />\n              </div>\n            </ScrollArea>\n\n            <div className=\"border-t border-border p-4\">\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    className={cn(\n                      \"h-auto w-full rounded-xl p-2 transition-all hover:bg-muted/80\",\n                      sidebarCollapsed ? \"justify-center\" : \"flex items-center justify-start gap-3\",\n                    )}\n                    aria-label=\"User menu\"\n                  >\n                    <Avatar className=\"h-9 w-9 shrink-0 border border-border shadow-sm\">\n                      <AvatarImage src={user.image ?? undefined} alt={user.name ?? \"User\"} />\n                      <AvatarFallback className=\"bg-primary/10 text-xs font-bold text-primary\">\n                        {initials(user.name)}\n                      </AvatarFallback>\n                    </Avatar>\n                    {!sidebarCollapsed ? (\n                      <>\n                        <div className=\"min-w-0 flex-1 text-left\">\n                          <p className=\"truncate text-sm font-semibold text-foreground leading-none\">{user.name ?? \"User\"}</p>\n                          <p className=\"mt-1 truncate text-[11px] text-muted-foreground\">{user.email ?? \"\"}</p>\n                        </div>\n                        <ChevronDown className=\"h-4 w-4 text-muted-foreground/50\" />\n                      </>\n                    ) : null}\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\" className=\"w-56 rounded-xl\">\n                  <DropdownMenuItem onSelect={toggleTheme}>\n                    {mounted && theme === \"dark\" ? (\n                      <>\n                        <Sun className=\"mr-2 size-4\" />\n                        Light mode\n                      </>\n                    ) : (\n                      <>\n                        <Moon className=\"mr-2 size-4\" />\n                        Dark mode\n                      </>\n                    )}\n                  </DropdownMenuItem>\n                  <DropdownMenuItem\n                    onSelect={() => signOut({ callbackUrl: \"/signin\" })}\n                    className=\"text-destructive focus:text-destructive focus:bg-destructive/10\"\n                  >\n                    <LogOut className=\"mr-2 size-4\" />\n                    Sign out\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </div>\n          </aside>\n\n          <main className=\"relative flex flex-1 flex-col overflow-hidden\">\n            <header className=\"z-10 flex h-14 shrink-0 items-center justify-between border-b border-border bg-background/80 glass-sm px-4 md:h-16 md:px-6\">\n              <div className=\"flex items-center gap-3 md:gap-4\">\n                <h1 className=\"text-base font-bold tracking-tight text-foreground md:text-xl\">{viewLabel}</h1>\n                <Separator orientation=\"vertical\" className=\"hidden h-5 bg-border md:block\" />\n                <div className=\"hidden items-center gap-2 text-sm font-medium text-muted-foreground md:flex\">\n                  <Globe className=\"h-4 w-4 text-primary/60\" />\n                  <span>Google Business Profile</span>\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-2 md:gap-3\">\n                {pathname.startsWith(\"/inbox\") && unanswered > 0 ? (\n                  <Button\n                    type=\"button\"\n                    onClick={() => window.dispatchEvent(new Event(\"replyai:open-blitz\"))}\n                    className=\"hidden items-center gap-2 rounded-full bg-primary px-4 text-sm font-bold text-primary-foreground shadow-glow-primary hover:bg-primary/90 md:flex\"\n                  >\n                    <Sparkles className=\"h-4 w-4\" />\n                    Quick Reply\n                  </Button>\n                ) : null}\n\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"relative h-10 w-10 rounded-full text-muted-foreground hover:bg-muted/80 hover:text-foreground md:h-9 md:w-9\"\n                  aria-label=\"Notifications\"\n                >\n                  <Bell className=\"h-5 w-5\" />\n                  <span className=\"absolute right-2 top-2 h-2 w-2 rounded-full bg-destructive shadow-[0_0_0_2px_white] dark:shadow-[0_0_0_2px_black]\" />\n                </Button>\n\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={toggleTheme}\n                  className=\"h-9 w-9 rounded-full text-muted-foreground hover:bg-muted/80 hover:text-foreground lg:hidden\"\n                  aria-label=\"Toggle theme\"\n                >\n                  {mounted && theme === \"dark\" ? <Sun className=\"h-5 w-5\" /> : <Moon className=\"h-5 w-5\" />}\n                </Button>\n              </div>\n            </header>\n\n            <div className=\"flex-1 overflow-x-hidden overflow-y-auto bg-zinc-50/50 dark:bg-zinc-950/20\">{children}</div>\n\n            <nav\n              className=\"flex h-16 shrink-0 items-center justify-around border-t border-border bg-background/80 glass px-2 pb-[env(safe-area-inset-bottom)] lg:hidden\"\n              aria-label=\"Mobile navigation\"\n            >\n              {items.map((item) => {\n                const isActive = isNavItemActive(pathname, item.href)\n                const showCount = item.href === \"/inbox\" && unanswered > 0\n\n                return (\n                  <Link\n                    key={item.href}\n                    href={item.href}\n                    prefetch={true}\n                    aria-current={isActive ? \"page\" : undefined}\n                    className={cn(\n                      \"relative flex h-full flex-1 flex-col items-center justify-center gap-1 transition-all duration-200\",\n                      isActive ? \"text-primary scale-110\" : \"text-muted-foreground\",\n                    )}\n                  >\n                    <div className=\"relative\">\n                      <item.Icon className={cn(\"h-5 w-5\", isActive && \"stroke-[2.5px]\")} />\n                      {showCount ? (\n                        <span className=\"absolute -right-2 -top-1.5 flex h-4 min-w-4 items-center justify-center rounded-full bg-primary px-1 text-[9px] font-black text-primary-foreground shadow-sm\">\n                          {unanswered > 99 ? \"99+\" : unanswered}\n                        </span>\n                      ) : null}\n                    </div>\n                    <span className=\"text-[10px] font-bold uppercase tracking-widest\">{item.shortLabel}</span>\n                  </Link>\n                )\n              })}\n            </nav>\n          </main>\n        </div>\n      </TooltipProvider>\n    </SearchProvider>\n  )\n}\n\n\nexport function ShellBadge({\n  children,\n  className,\n}: {\n  children: React.ReactNode\n  className?: string\n}) {\n  return <Badge className={cn(\"bg-foreground text-background\", className)}>{children}</Badge>\n}\n"
    },
    {
      "path": "components/icons.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/icons.ts",
      "bytes": 1397,
      "content": "// Single source of truth for the app's icon library.\n// Preset: Phosphor icons (Nova / Zinc / Blue / LTR).\n//\n// All app code should import icons from here, never directly from icon packages,\n// so we can swap libraries without touching the whole codebase.\n\nexport {\n  ArrowLeft,\n  ArrowSquareOut as ExternalLink,\n  ArrowClockwise as RefreshCw,\n  Bell,\n  CaretDown as ChevronDown,\n  CaretRight as ChevronRight,\n  CaretUp as ChevronUp,\n  Check,\n  CheckCircle as CheckCircle2,\n  Circle,\n  CircleNotch as Loader2,\n  Clock,\n  Copy,\n  EnvelopeSimple as Mail,\n  FloppyDisk as Save,\n  GearSix as Settings,\n  Laptop,\n  Lightning as Zap,\n  List as Menu,\n  MagnifyingGlass as Search,\n  MapPin,\n  ChatCenteredDots as MessageSquare,\n  Moon,\n  Plus,\n  Question as CircleHelp,\n  Question as HelpCircle,\n  ShieldCheck,\n  SignOut as LogOut,\n  Sparkle as Sparkles,\n  Star,\n  Sun,\n  TrendUp as TrendingUp,\n  User,\n  Users,\n  Warning as AlertTriangle,\n  X,\n  Trash as Trash2,\n  ArrowUpRight,\n  ThumbsUp,\n  ThumbsDown,\n  ClockCounterClockwise as History,\n  ChartBar as BarChart,\n  Eye,\n  PencilSimple as Pencil,\n  FunnelSimple as Filter,\n  ArrowRight,\n  CaretLeft as ChevronLeft,\n  DotsThree as MoreHorizontal,\n  SquaresFour as LayoutDashboard,\n  Envelope,\n  PencilSimpleLine as Edit,\n  PaperPlaneRight as Send,\n  GlobeSimple as Globe,\n  ArrowUp,\n  ArrowDown,\n  Tray as InboxIcon,\n} from \"@phosphor-icons/react/ssr\"\n"
    },
    {
      "path": "components/JobHealthWidget.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/JobHealthWidget.tsx",
      "bytes": 7628,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport Link from \"next/link\"\nimport { useJobSummaryPolling } from \"@/lib/hooks\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Card } from \"@/components/ui/card\"\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\"\nimport { AlertTriangle, CheckCircle2, ExternalLink, Loader2 } from \"@/components/icons\"\nimport { cn } from \"@/lib/utils\"\n\nexport function JobHealthWidget({ compact = false }: { compact?: boolean }) {\n  const { summary, backlog, failed24h, error } = useJobSummaryPolling(60_000)\n  const [open, setOpen] = React.useState(false)\n  const [detailLoading, setDetailLoading] = React.useState(false)\n  const [detailError, setDetailError] = React.useState<string | null>(null)\n  const [detailSummary, setDetailSummary] = React.useState<typeof summary>(null)\n\n  React.useEffect(() => {\n    if (!open) return\n    if (detailSummary) return\n\n    let mounted = true\n    const controller = new AbortController()\n\n    setDetailLoading(true)\n    setDetailError(null)\n    void (async () => {\n      try {\n        const res = await fetch(\"/api/jobs/summary?detail=1\", { signal: controller.signal })\n        if (!mounted) return\n        if (!res.ok) {\n          setDetailError(res.statusText)\n          return\n        }\n        const data = await res.json()\n        setDetailSummary(data.summary ?? null)\n      } catch (err: unknown) {\n        if (!mounted) return\n        if (err instanceof DOMException && err.name === \"AbortError\") return\n        setDetailError(err instanceof Error ? err.message : \"Unknown error\")\n      } finally {\n        if (mounted) setDetailLoading(false)\n      }\n    })()\n\n    return () => {\n      mounted = false\n      controller.abort()\n    }\n  }, [open, detailSummary])\n\n  const effectiveSummary = detailSummary ?? summary\n  const aiQuality = effectiveSummary?.aiQuality24h\n\n  const label = error\n    ? \"Unavailable\"\n    : failed24h > 0\n      ? `${failed24h} failed`\n      : backlog > 0\n        ? `${backlog} queued`\n        : \"All clear\"\n\n  const hasIssue = error || failed24h > 0\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          className={cn(\n            \"w-full flex items-center gap-2 text-left py-1.5 px-1.5 rounded-lg transition-colors hover:bg-muted/60 outline-none focus-visible:ring-2 focus-visible:ring-ring\",\n            compact && \"px-0\"\n          )}\n        >\n          {hasIssue ? (\n            <div className=\"size-6 rounded-md bg-destructive/10 grid place-items-center shrink-0\">\n              <AlertTriangle className=\"size-3 text-destructive\" />\n            </div>\n          ) : backlog > 0 ? (\n            <div className=\"size-6 rounded-md bg-primary/10 grid place-items-center shrink-0\">\n              <Loader2 className=\"size-3 text-primary animate-spin\" />\n            </div>\n          ) : (\n            <div className=\"size-6 rounded-md bg-emerald-500/10 grid place-items-center shrink-0\">\n              <CheckCircle2 className=\"size-3 text-emerald-500\" />\n            </div>\n          )}\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"text-[10px] font-semibold leading-none\">Jobs</div>\n            <div className=\"text-[9px] text-muted-foreground truncate mt-0.5\">{label}</div>\n          </div>\n        </Button>\n      </DialogTrigger>\n\n      <DialogContent className=\"max-w-lg rounded-xl\">\n        <DialogHeader>\n          <DialogTitle className=\"text-base\">System Health</DialogTitle>\n          <DialogDescription className=\"text-xs\">\n            Worker queue status and recent failures\n          </DialogDescription>\n        </DialogHeader>\n\n        {detailLoading ? (\n          <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n            <Loader2 className=\"size-4 animate-spin\" />\n            Loading details...\n          </div>\n        ) : detailError ? (\n          <div className=\"text-xs text-destructive\">Failed to load details: {detailError}</div>\n        ) : null}\n\n        <div className={cn(\"grid gap-3\", aiQuality ? \"grid-cols-2 lg:grid-cols-4\" : \"grid-cols-2\")}>\n          <Card className=\"rounded-xl p-4 shadow-card\">\n            <div className=\"text-[9px] font-bold text-muted-foreground uppercase tracking-wider\">Backlog</div>\n            <div className=\"mt-1.5 text-2xl font-bold tabular-nums\">{backlog}</div>\n          </Card>\n          <Card className=\"rounded-xl p-4 shadow-card\">\n            <div className=\"text-[9px] font-bold text-muted-foreground uppercase tracking-wider\">Failed (24h)</div>\n            <div className={cn(\"mt-1.5 text-2xl font-bold tabular-nums\", failed24h > 0 && \"text-destructive\")}>{failed24h}</div>\n          </Card>\n          {aiQuality ? (\n            <Card className=\"rounded-xl p-4 shadow-card\">\n              <div className=\"text-[9px] font-bold text-muted-foreground uppercase tracking-wider\">SEO Coverage</div>\n              <div className=\"mt-1.5 text-2xl font-bold tabular-nums\">{(aiQuality.avgKeywordCoverage * 100).toFixed(0)}%</div>\n            </Card>\n          ) : null}\n          {aiQuality ? (\n            <Card className=\"rounded-xl p-4 shadow-card\">\n              <div className=\"text-[9px] font-bold text-muted-foreground uppercase tracking-wider\">Stuffing Risk</div>\n              <div className={cn(\"mt-1.5 text-2xl font-bold tabular-nums\", aiQuality.stuffingRisk > 0 && \"text-destructive\")}>\n                {(aiQuality.stuffingRiskRate * 100).toFixed(1)}%\n              </div>\n            </Card>\n          ) : null}\n        </div>\n        {aiQuality?.topProgramVersion ? (\n          <div className=\"text-[11px] text-muted-foreground\">\n            Active DSPy program: <span className=\"font-mono\">{aiQuality.topProgramVersion}</span>\n          </div>\n        ) : null}\n\n        {effectiveSummary?.recentFailures?.length ? (\n          <div className=\"space-y-2\">\n            <div className=\"text-xs font-semibold\">Recent Failures</div>\n            <div className=\"max-h-[250px] overflow-auto scrollbar-thin space-y-1.5\">\n              {effectiveSummary.recentFailures.slice(0, 8).map((f) => (\n                <Card key={f.id} className=\"rounded-lg p-3 shadow-card\">\n                  <div className=\"flex items-center justify-between gap-2\">\n                    <Badge variant=\"secondary\" className=\"rounded-md text-[10px] h-5 px-1.5\">{f.type}</Badge>\n                    <span className=\"text-[9px] text-muted-foreground font-mono truncate max-w-[120px]\">{f.id}</span>\n                  </div>\n                  {f.lastError && (\n                    <p className=\"mt-1.5 text-[11px] text-muted-foreground whitespace-pre-wrap break-words leading-relaxed\">\n                      {f.lastError}\n                    </p>\n                  )}\n                </Card>\n              ))}\n            </div>\n          </div>\n        ) : (\n          <div className=\"rounded-xl border-2 border-dashed border-muted p-6 text-center\">\n            <CheckCircle2 className=\"size-5 text-emerald-500 mx-auto mb-1.5\" />\n            <p className=\"text-xs text-muted-foreground\">No failures recorded</p>\n          </div>\n        )}\n\n        <div className=\"flex justify-end\">\n          <Button asChild variant=\"secondary\" className=\"rounded-lg\">\n            <Link href=\"/system-health\">\n              <ExternalLink className=\"size-4\" />\n              <span className=\"ml-2\">View details</span>\n            </Link>\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n"
    },
    {
      "path": "components/Providers.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/Providers.tsx",
      "bytes": 564,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { AnimatePresence } from \"framer-motion\"\nimport { ThemeProvider } from \"@/components/ThemeProvider\"\nimport { Toaster } from \"@/components/ui/sonner\"\nimport { DirectionProvider } from \"@/components/ui/direction\"\n\nexport function Providers({ children }: { children: React.ReactNode }) {\n  return (\n    <ThemeProvider>\n      <DirectionProvider dir=\"ltr\">\n        <AnimatePresence mode=\"wait\">\n          {children}\n        </AnimatePresence>\n        <Toaster />\n      </DirectionProvider>\n    </ThemeProvider>\n  )\n}\n"
    },
    {
      "path": "components/search-context.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/search-context.tsx",
      "bytes": 673,
      "content": "\"use client\"\n\nimport * as React from \"react\"\n\ntype SearchState = {\n  query: string\n  setQuery: (q: string) => void\n}\n\nconst SearchContext = React.createContext<SearchState | null>(null)\n\nexport function SearchProvider({ children }: { children: React.ReactNode }) {\n  const [query, setQuery] = React.useState(\"\")\n\n  const value = React.useMemo(() => ({ query, setQuery }), [query])\n  return <SearchContext.Provider value={value}>{children}</SearchContext.Provider>\n}\n\nexport function useGlobalSearch(): SearchState {\n  const ctx = React.useContext(SearchContext)\n  if (!ctx) {\n    throw new Error(\"useGlobalSearch must be used within <SearchProvider>.\")\n  }\n  return ctx\n}\n\n"
    },
    {
      "path": "components/ThemeProvider.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ThemeProvider.tsx",
      "bytes": 352,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { ThemeProvider as NextThemesProvider } from \"next-themes\"\n\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\n  return (\n    <NextThemesProvider attribute=\"class\" defaultTheme=\"light\" enableSystem disableTransitionOnChange>\n      {children}\n    </NextThemesProvider>\n  )\n}\n"
    },
    {
      "path": "components/ui/avatar.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/avatar.tsx",
      "bytes": 1358,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\nimport { cn } from \"@/lib/utils\"\n\nexport const Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\", className)}\n    {...props}\n  />\n))\nAvatar.displayName = \"Avatar\"\n\nexport const AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full object-cover\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = \"AvatarImage\"\n\nexport const AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted text-muted-foreground font-semibold\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = \"AvatarFallback\"\n"
    },
    {
      "path": "components/ui/badge.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/badge.tsx",
      "bytes": 975,
      "content": "import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default: \"border-transparent bg-primary text-primary-foreground\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive: \"border-transparent bg-destructive text-destructive-foreground\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport type BadgeProps = React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof badgeVariants>\n\nexport function Badge({ className, variant, ...props }: BadgeProps) {\n  return <div className={cn(badgeVariants({ variant }), className)} {...props} />\n}\n\n"
    },
    {
      "path": "components/ui/button.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/button.tsx",
      "bytes": 1797,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background disabled:pointer-events-none disabled:opacity-50\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90 shadow-google-sm\",\n        secondary: \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive: \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline: \"border bg-background hover:bg-accent hover:text-accent-foreground\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 px-3\",\n        lg: \"h-11 px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport type ButtonProps = React.ButtonHTMLAttributes<HTMLButtonElement> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }\n\nexport const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size }), className)}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { buttonVariants }\n"
    },
    {
      "path": "components/ui/card.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/card.tsx",
      "bytes": 1203,
      "content": "import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nexport function Card({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"rounded-2xl border bg-card text-card-foreground\", className)}\n      {...props}\n    />\n  )\n}\n\nexport function CardHeader({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {\n  return <div className={cn(\"flex flex-col space-y-1.5 p-6\", className)} {...props} />\n}\n\nexport function CardTitle({ className, ...props }: React.HTMLAttributes<HTMLHeadingElement>) {\n  return <h3 className={cn(\"text-lg font-semibold leading-none tracking-tight\", className)} {...props} />\n}\n\nexport function CardDescription({ className, ...props }: React.HTMLAttributes<HTMLParagraphElement>) {\n  return <p className={cn(\"text-sm text-muted-foreground\", className)} {...props} />\n}\n\nexport function CardContent({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {\n  return <div className={cn(\"p-6 pt-0\", className)} {...props} />\n}\n\nexport function CardFooter({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {\n  return <div className={cn(\"flex items-center p-6 pt-0\", className)} {...props} />\n}\n\n"
    },
    {
      "path": "components/ui/checkbox.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/checkbox.tsx",
      "bytes": 1031,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"@/components/icons\"\nimport { cn } from \"@/lib/utils\"\n\nexport const Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator className=\"flex items-center justify-center text-current\">\n      <Check className=\"h-3.5 w-3.5\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = \"Checkbox\"\n"
    },
    {
      "path": "components/ui/dialog.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/dialog.tsx",
      "bytes": 3529,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"@/components/icons\"\nimport { cn } from \"@/lib/utils\"\n\nexport const Dialog = DialogPrimitive.Root\nexport const DialogTrigger = DialogPrimitive.Trigger\nexport const DialogPortal = DialogPrimitive.Portal\nexport const DialogClose = DialogPrimitive.Close\n\nexport const DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/40 backdrop-blur-sm\",\n      \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n      \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className,\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = \"DialogOverlay\"\n\nexport const DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-google-lg rounded-xl\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n        \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n        \"data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95\",\n        \"data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%]\",\n        \"data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]\",\n        className,\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = \"DialogContent\"\n\nexport function DialogHeader({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {\n  return <div className={cn(\"flex flex-col space-y-1.5 text-center sm:text-left\", className)} {...props} />\n}\n\nexport function DialogFooter({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {\n  return <div className={cn(\"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\", className)} {...props} />\n}\n\nexport const DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title ref={ref} className={cn(\"text-lg font-semibold leading-none tracking-tight\", className)} {...props} />\n))\nDialogTitle.displayName = \"DialogTitle\"\n\nexport const DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description ref={ref} className={cn(\"text-sm text-muted-foreground\", className)} {...props} />\n))\nDialogDescription.displayName = \"DialogDescription\"\n"
    },
    {
      "path": "components/ui/direction.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/direction.tsx",
      "bytes": 334,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as DirectionPrimitive from \"@radix-ui/react-direction\"\n\nexport function DirectionProvider({\n  dir,\n  children,\n}: {\n  dir: \"ltr\" | \"rtl\"\n  children: React.ReactNode\n}) {\n  return <DirectionPrimitive.DirectionProvider dir={dir}>{children}</DirectionPrimitive.DirectionProvider>\n}\n\n"
    },
    {
      "path": "components/ui/dropdown-menu.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/dropdown-menu.tsx",
      "bytes": 6843,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"@/components/icons\"\nimport { cn } from \"@/lib/utils\"\n\nexport const DropdownMenu = DropdownMenuPrimitive.Root\nexport const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\nexport const DropdownMenuGroup = DropdownMenuPrimitive.Group\nexport const DropdownMenuPortal = DropdownMenuPrimitive.Portal\nexport const DropdownMenuSub = DropdownMenuPrimitive.Sub\nexport const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nexport const DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & { inset?: boolean }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName = \"DropdownMenuSubTrigger\"\n\nexport const DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-google-md\",\n      \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n      \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      \"data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95\",\n      \"data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className,\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName = \"DropdownMenuSubContent\"\n\nexport const DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-google-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n        \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n        \"data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95\",\n        \"data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className,\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = \"DropdownMenuContent\"\n\nexport const DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & { inset?: boolean }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = \"DropdownMenuItem\"\n\nexport const DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName = \"DropdownMenuCheckboxItem\"\n\nexport const DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = \"DropdownMenuRadioItem\"\n\nexport const DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & { inset?: boolean }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", inset && \"pl-8\", className)}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = \"DropdownMenuLabel\"\n\nexport const DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator ref={ref} className={cn(\"-mx-1 my-1 h-px bg-muted\", className)} {...props} />\n))\nDropdownMenuSeparator.displayName = \"DropdownMenuSeparator\"\n\nexport const DropdownMenuShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\n  return <span className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)} {...props} />\n}\n"
    },
    {
      "path": "components/ui/input.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/input.tsx",
      "bytes": 769,
      "content": "import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nexport type InputProps = React.InputHTMLAttributes<HTMLInputElement>\n\nexport const Input = React.forwardRef<HTMLInputElement, InputProps>(({ className, type, ...props }, ref) => {\n  return (\n    <input\n      type={type}\n      className={cn(\n        \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nInput.displayName = \"Input\"\n\n"
    },
    {
      "path": "components/ui/scroll-area.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/scroll-area.tsx",
      "bytes": 1490,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\nimport { cn } from \"@/lib/utils\"\n\nexport const ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root ref={ref} className={cn(\"relative overflow-hidden\", className)} {...props}>\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = \"ScrollArea\"\n\nexport const ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Scrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Scrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.Scrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" && \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" && \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Thumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.Scrollbar>\n))\nScrollBar.displayName = \"ScrollBar\"\n"
    },
    {
      "path": "components/ui/select.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/select.tsx",
      "bytes": 5175,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"@/components/icons\"\nimport { cn } from \"@/lib/utils\"\n\nexport const Select = SelectPrimitive.Root\nexport const SelectGroup = SelectPrimitive.Group\nexport const SelectValue = SelectPrimitive.Value\n\nexport const SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = \"SelectTrigger\"\n\nexport const SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\"flex cursor-default items-center justify-center py-1\", className)}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = \"SelectScrollUpButton\"\n\nexport const SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\"flex cursor-default items-center justify-center py-1\", className)}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName = \"SelectScrollDownButton\"\n\nexport const SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      position={position}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-google-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n        \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n        \"data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className,\n      )}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\",\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = \"SelectContent\"\n\nexport const SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label ref={ref} className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)} {...props} />\n))\nSelectLabel.displayName = \"SelectLabel\"\n\nexport const SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = \"SelectItem\"\n\nexport const SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator ref={ref} className={cn(\"-mx-1 my-1 h-px bg-muted\", className)} {...props} />\n))\nSelectSeparator.displayName = \"SelectSeparator\"\n"
    },
    {
      "path": "components/ui/separator.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/separator.tsx",
      "bytes": 684,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\nimport { cn } from \"@/lib/utils\"\n\nexport const Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(({ className, orientation = \"horizontal\", decorative = true, ...props }, ref) => (\n  <SeparatorPrimitive.Root\n    ref={ref}\n    decorative={decorative}\n    orientation={orientation}\n    className={cn(\n      \"shrink-0 bg-border\",\n      orientation === \"horizontal\" ? \"h-px w-full\" : \"h-full w-px\",\n      className\n    )}\n    {...props}\n  />\n))\nSeparator.displayName = \"Separator\"\n"
    },
    {
      "path": "components/ui/sheet.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/sheet.tsx",
      "bytes": 4219,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"@/components/icons\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"@/lib/utils\"\n\nexport const Sheet = DialogPrimitive.Root\nexport const SheetTrigger = DialogPrimitive.Trigger\nexport const SheetClose = DialogPrimitive.Close\nexport const SheetPortal = DialogPrimitive.Portal\n\nexport const SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/40 backdrop-blur-sm\",\n      \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n      \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className,\n    )}\n    {...props}\n  />\n))\nSheetOverlay.displayName = \"SheetOverlay\"\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-google-lg transition ease-in-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left:\n          \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  },\n)\n\nexport interface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nexport const SheetContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        sheetVariants({ side }),\n        \"data-[state=open]:duration-500 data-[state=closed]:duration-300\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n        \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n        side === \"bottom\" ? \"rounded-t-2xl\" : \"rounded-none\",\n        className,\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = \"SheetContent\"\n\nexport function SheetHeader({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {\n  return <div className={cn(\"flex flex-col space-y-2 text-center sm:text-left\", className)} {...props} />\n}\n\nexport function SheetFooter({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {\n  return <div className={cn(\"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\", className)} {...props} />\n}\n\nexport const SheetTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title ref={ref} className={cn(\"text-lg font-semibold leading-none tracking-tight\", className)} {...props} />\n))\nSheetTitle.displayName = \"SheetTitle\"\n\nexport const SheetDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description ref={ref} className={cn(\"text-sm text-muted-foreground\", className)} {...props} />\n))\nSheetDescription.displayName = \"SheetDescription\"\n\n"
    },
    {
      "path": "components/ui/sonner.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/sonner.tsx",
      "bytes": 682,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { Toaster as Sonner } from \"sonner\"\nimport { useTheme } from \"next-themes\"\n\nexport function Toaster() {\n  const { theme } = useTheme()\n  const resolved = theme === \"dark\" ? \"dark\" : \"light\"\n\n  return (\n    <Sonner\n      theme={resolved}\n      richColors\n      closeButton\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast bg-background text-foreground border border-border shadow-google-md\",\n          description: \"text-muted-foreground\",\n          actionButton: \"bg-primary text-primary-foreground\",\n          cancelButton: \"bg-muted text-muted-foreground\",\n        },\n      }}\n    />\n  )\n}\n\n"
    },
    {
      "path": "components/ui/textarea.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/textarea.tsx",
      "bytes": 716,
      "content": "import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nexport type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>\n\nexport const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\n"
    },
    {
      "path": "components/ui/toggle-group.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/toggle-group.tsx",
      "bytes": 1975,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"@/lib/utils\"\n\nconst toggleGroupVariants = cva(\n  \"inline-flex items-center justify-center rounded-xl bg-muted p-1 text-muted-foreground\",\n  {\n    variants: {\n      size: {\n        sm: \"h-8\",\n        default: \"h-9\",\n        lg: \"h-10\",\n      },\n    },\n    defaultVariants: {\n      size: \"default\",\n    },\n  }\n)\n\nexport const ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleGroupVariants>\n>(({ className, size, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(toggleGroupVariants({ size }), className)}\n    {...props}\n  />\n))\nToggleGroup.displayName = \"ToggleGroup\"\n\nconst toggleGroupItemVariants = cva(\n  \"inline-flex items-center justify-center whitespace-nowrap rounded-lg px-3 text-xs font-semibold transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-background data-[state=on]:text-foreground data-[state=on]:shadow-google-sm\",\n  {\n    variants: {\n      size: {\n        sm: \"h-7\",\n        default: \"h-8\",\n        lg: \"h-9\",\n      },\n    },\n    defaultVariants: {\n      size: \"default\",\n    },\n  }\n)\n\nexport const ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleGroupItemVariants>\n>(({ className, size, ...props }, ref) => (\n  <ToggleGroupPrimitive.Item\n    ref={ref}\n    className={cn(toggleGroupItemVariants({ size }), className)}\n    {...props}\n  />\n))\nToggleGroupItem.displayName = \"ToggleGroupItem\"\n"
    },
    {
      "path": "components/ui/tooltip.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/tooltip.tsx",
      "bytes": 1300,
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\nimport { cn } from \"@/lib/utils\"\n\nexport const TooltipProvider = TooltipPrimitive.Provider\nexport const Tooltip = TooltipPrimitive.Root\nexport const TooltipTrigger = TooltipPrimitive.Trigger\n\nexport const TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-xs text-popover-foreground shadow-google-md\",\n        \"data-[state=delayed-open]:animate-in data-[state=closed]:animate-out\",\n        \"data-[state=closed]:fade-out-0 data-[state=delayed-open]:fade-in-0\",\n        \"data-[state=closed]:zoom-out-95 data-[state=delayed-open]:zoom-in-95\",\n        \"data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className,\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = \"TooltipContent\"\n"
    },
    {
      "path": "lib/api/client-error.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/api/client-error.ts",
      "bytes": 884,
      "content": "type ClientErrorPayload = {\n  message?: unknown\n  error?: unknown\n}\n\nfunction toRecord(value: unknown): Record<string, unknown> | null {\n  if (typeof value !== \"object\" || value === null) return null\n  return value as Record<string, unknown>\n}\n\nfunction toNonEmptyString(value: unknown): string | null {\n  if (typeof value !== \"string\") return null\n  const trimmed = value.trim()\n  return trimmed.length > 0 ? trimmed : null\n}\n\nexport function extractClientErrorMessage(params: {\n  body: unknown\n  statusText: string\n  fallback?: string\n}) {\n  const { body, statusText, fallback = \"Request failed\" } = params\n  const payload = toRecord(body) as ClientErrorPayload | null\n\n  const message = toNonEmptyString(payload?.message)\n  if (message) return message\n\n  const error = toNonEmptyString(payload?.error)\n  if (error) return error\n\n  return toNonEmptyString(statusText) ?? fallback\n}\n"
    },
    {
      "path": "lib/api/client-idempotency.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/api/client-idempotency.ts",
      "bytes": 1358,
      "content": "const UUID_V4_REGEX =\n  /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i\n\nfunction bytesToUuid(bytes: Uint8Array): string {\n  const hex = Array.from(bytes, (b) => b.toString(16).padStart(2, \"0\")).join(\"\")\n  return `${hex.slice(0, 8)}-${hex.slice(8, 12)}-${hex.slice(12, 16)}-${hex.slice(16, 20)}-${hex.slice(20, 32)}`\n}\n\nfunction randomBytes(): Uint8Array {\n  const bytes = new Uint8Array(16)\n  const cryptoApi = globalThis.crypto\n\n  if (cryptoApi?.getRandomValues) {\n    cryptoApi.getRandomValues(bytes)\n    return bytes\n  }\n\n  for (let i = 0; i < bytes.length; i += 1) {\n    bytes[i] = Math.floor(Math.random() * 256)\n  }\n  return bytes\n}\n\nfunction normalizeUuidV4(bytes: Uint8Array): Uint8Array {\n  const out = new Uint8Array(bytes)\n  // RFC 4122 version field\n  out[6] = (out[6] & 0x0f) | 0x40\n  // RFC 4122 variant field\n  out[8] = (out[8] & 0x3f) | 0x80\n  return out\n}\n\nexport function createIdempotencyKey(): string {\n  const candidate = globalThis.crypto?.randomUUID?.()\n  if (candidate && UUID_V4_REGEX.test(candidate)) {\n    return candidate\n  }\n  return bytesToUuid(normalizeUuidV4(randomBytes()))\n}\n\nexport function withIdempotencyHeader(headers?: HeadersInit): Headers {\n  const next = new Headers(headers)\n  if (!next.has(\"Idempotency-Key\")) {\n    next.set(\"Idempotency-Key\", createIdempotencyKey())\n  }\n  return next\n}\n"
    },
    {
      "path": "lib/hooks.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks.ts",
      "bytes": 470,
      "content": "\"use client\"\n\nexport { formatAge } from \"./hooks/formatAge\"\nexport { useJobSummaryPolling } from \"./hooks/jobs/useJobSummaryPolling\"\nexport { usePaginatedReviews } from \"./hooks/reviews/usePaginatedReviews\"\nexport { useReviewDetail } from \"./hooks/reviews/useReviewDetail\"\n\nexport type { JobSummary } from \"./hooks/jobs/useJobSummaryPolling\"\nexport type {\n  ReviewCounts,\n  ReviewDetail,\n  ReviewFilter,\n  ReviewRow,\n  ReviewStatusFilter,\n} from \"./hooks/reviews/types\"\n"
    },
    {
      "path": "lib/hooks/formatAge.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks/formatAge.ts",
      "bytes": 455,
      "content": "export function formatAge(iso: string): string {\n  const now = Date.now()\n  const then = new Date(iso).getTime()\n  const diffMs = now - then\n  const minutes = Math.floor(diffMs / 60_000)\n\n  if (minutes < 60) return `${Math.max(minutes, 0)}m`\n\n  const hours = Math.floor(minutes / 60)\n  if (hours < 24) return `${hours}h`\n\n  const days = Math.floor(hours / 24)\n  if (days < 7) return `${days}d`\n\n  const weeks = Math.floor(days / 7)\n  return `${weeks}w`\n}\n"
    },
    {
      "path": "lib/hooks/jobs/useJobSummaryPolling.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks/jobs/useJobSummaryPolling.ts",
      "bytes": 3872,
      "content": "\"use client\"\n\nimport * as React from \"react\"\n\nexport type JobSummary = {\n  byType: Record<\n    string,\n    { pending: number; running: number; retrying: number; failed_24h: number }\n  >\n  recentFailures: Array<{\n    id: string\n    type: string\n    completedAtIso: string | null\n    lastError: string | null\n  }>\n  aiQuality24h?: {\n    runs: number\n    blocked: number\n    stuffingRisk: number\n    avgKeywordCoverage: number\n    blockedRate: number\n    stuffingRiskRate: number\n    requiredKeywordUsageRate: number\n    topProgramVersion: string | null\n    programVersions: Array<{\n      version: string\n      runs: number\n      blockedRate: number\n      avgKeywordCoverage: number\n      requiredKeywordUsageRate: number\n    }>\n    modeDistribution: Array<{\n      mode: \"AUTO\" | \"MANUAL_REGENERATE\" | \"VERIFY_EXISTING_DRAFT\"\n      runs: number\n      ratio: number\n    }>\n  }\n}\n\ntype UseJobSummaryResult = {\n  summary: JobSummary | null\n  backlog: number\n  failed24h: number\n  error: string | null\n}\n\nexport function useJobSummaryPolling(pollMs: number = 60_000): UseJobSummaryResult {\n  const [summary, setSummary] = React.useState<JobSummary | null>(null)\n  const [error, setError] = React.useState<string | null>(null)\n\n  React.useEffect(() => {\n    let mounted = true\n    let visible = typeof document === \"undefined\" ? true : document.visibilityState === \"visible\"\n    let timer: ReturnType<typeof setTimeout> | null = null\n    let controller: AbortController | null = null\n\n    const schedule = (ms: number) => {\n      if (!mounted) return\n      if (timer) clearTimeout(timer)\n      timer = setTimeout(() => {\n        void run()\n      }, ms)\n    }\n\n    const run = async () => {\n      if (!mounted || !visible) return\n      controller?.abort()\n      controller = new AbortController()\n\n      try {\n        const res = await fetch(\"/api/jobs/summary\", { signal: controller.signal })\n        if (!mounted) return\n        if (!res.ok) {\n          setError(res.statusText)\n          schedule(pollMs)\n          return\n        }\n        const data = await res.json()\n        setSummary(data.summary)\n        setError(null)\n      } catch (err: unknown) {\n        if (err instanceof DOMException && err.name === \"AbortError\") return\n        if (!mounted) return\n        setError(err instanceof Error ? err.message : \"Unknown error\")\n      } finally {\n        schedule(pollMs)\n      }\n    }\n\n    const onVisibilityChange = () => {\n      visible = document.visibilityState === \"visible\"\n      if (visible) {\n        // Catch up immediately when tab becomes active again.\n        schedule(0)\n      }\n    }\n\n    if (typeof document !== \"undefined\") {\n      document.addEventListener(\"visibilitychange\", onVisibilityChange)\n    }\n\n    // Defer initial fetch to avoid competing with route navigation / hydration.\n    type RequestIdleCallback = (cb: () => void, opts?: { timeout?: number }) => number\n    const requestIdleCallback = (globalThis as unknown as { requestIdleCallback?: RequestIdleCallback }).requestIdleCallback\n    if (typeof requestIdleCallback === \"function\") {\n      requestIdleCallback(() => schedule(0), { timeout: 1200 })\n    } else {\n      schedule(250)\n    }\n\n    return () => {\n      mounted = false\n      controller?.abort()\n      if (timer) clearTimeout(timer)\n      if (typeof document !== \"undefined\") {\n        document.removeEventListener(\"visibilitychange\", onVisibilityChange)\n      }\n    }\n  }, [pollMs])\n\n  const backlog = React.useMemo(() => {\n    if (!summary) return 0\n    return Object.values(summary.byType).reduce(\n      (sum, item) => sum + item.pending + item.running + item.retrying,\n      0,\n    )\n  }, [summary])\n\n  const failed24h = React.useMemo(() => {\n    if (!summary) return 0\n    return Object.values(summary.byType).reduce((sum, item) => sum + item.failed_24h, 0)\n  }, [summary])\n\n  return { summary, backlog, failed24h, error }\n}\n"
    },
    {
      "path": "lib/hooks/reviews/types.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks/reviews/types.ts",
      "bytes": 933,
      "content": "import type { DraftStatus, ReviewListCounts, ReviewListRow } from \"@/lib/reviews/types\"\n\nexport type ReviewFilter = \"unanswered\" | \"urgent\" | \"five_star\" | \"mentions\" | \"all\"\nexport type ReviewStatusFilter = \"pending\" | \"replied\" | \"all\"\n\nexport type ReviewRow = ReviewListRow\nexport type ReviewCounts = ReviewListCounts\n\nexport type ReviewDetail = {\n  id: string\n  starRating: number\n  comment: string | null\n  createTime: string\n  updateTime: string\n  reviewer: { displayName: string | null; isAnonymous: boolean }\n  reply: { comment: string | null; updateTime: string | null }\n  location: { id: string; name: string }\n  mentions: string[]\n  currentDraft: {\n    id: string\n    text: string\n    status: DraftStatus\n    version: number\n    verifierResultJson: unknown | null\n    updatedAt?: string\n  } | null\n  drafts: Array<{\n    id: string\n    text: string\n    status: DraftStatus\n    version: number\n    updatedAt?: string\n  }>\n}\n"
    },
    {
      "path": "lib/hooks/reviews/usePaginatedReviews.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks/reviews/usePaginatedReviews.ts",
      "bytes": 9355,
      "content": "\"use client\"\n\nimport * as React from \"react\"\n\nimport { REVIEWS_PAGE_SIZE } from \"@/lib/reviews/constants\"\nimport { emitUnansweredCount } from \"@/lib/reviews/count-events\"\nimport type { ReviewListPage } from \"@/lib/reviews/types\"\n\nimport type { ReviewCounts, ReviewFilter, ReviewRow, ReviewStatusFilter } from \"./types\"\n\nexport type ReviewInitialPage = ReviewListPage & {\n  filter: ReviewFilter\n  status?: ReviewStatusFilter\n  mention?: string | null\n}\n\ntype UsePaginatedReviewsResult = {\n  rows: ReviewRow[]\n  counts: ReviewCounts | null\n  loading: boolean\n  loadingMore: boolean\n  error: string | null\n  hasMore: boolean\n  loadMore: () => void\n  refresh: () => void\n  updateRow: (id: string, updater: (row: ReviewRow) => ReviewRow) => void\n}\n\nfunction initialPageMatchesFilters(input: {\n  initialPage: ReviewInitialPage | null | undefined\n  filter: ReviewFilter\n  mention?: string\n  status: ReviewStatusFilter\n  locationId?: string\n  rating?: number\n  search?: string\n}) {\n  const { initialPage, filter, mention, status, locationId, rating, search } = input\n  return (\n    !!initialPage &&\n    !locationId &&\n    rating == null &&\n    !search &&\n    initialPage.filter === filter &&\n    (initialPage.mention ?? null) === (mention ?? null) &&\n    (initialPage.status == null || initialPage.status === status)\n  )\n}\n\nexport function usePaginatedReviews(opts: {\n  filter: ReviewFilter\n  mention?: string\n  status?: ReviewStatusFilter\n  locationId?: string\n  rating?: number\n  search?: string\n  enabled?: boolean\n  initialPage?: ReviewInitialPage | null\n}): UsePaginatedReviewsResult {\n  const { filter, mention, status = \"all\", locationId, rating, search, enabled = true, initialPage } = opts\n  const initialMatches = initialPageMatchesFilters({\n    initialPage,\n    filter,\n    mention,\n    status,\n    locationId,\n    rating,\n    search,\n  })\n  const seededInitialPage = initialMatches ? initialPage : null\n  const initialConsumedRef = React.useRef(false)\n\n  const [rows, setRows] = React.useState<ReviewRow[]>(seededInitialPage?.rows ?? [])\n  const [counts, setCounts] = React.useState<ReviewCounts | null>(seededInitialPage?.counts ?? null)\n  const [loading, setLoading] = React.useState(enabled && !initialMatches)\n  const [loadingMore, setLoadingMore] = React.useState(false)\n  const [error, setError] = React.useState<string | null>(null)\n  const [hasMore, setHasMore] = React.useState(Boolean(seededInitialPage?.nextCursor))\n\n  const cursorRef = React.useRef<string | null>(seededInitialPage?.nextCursor ?? null)\n  const abortRef = React.useRef<AbortController | null>(null)\n  const countsAbortRef = React.useRef<AbortController | null>(null)\n  const countsLoadingRef = React.useRef(false)\n  const hasLoadedCountsRef = React.useRef(initialMatches && seededInitialPage?.counts !== undefined)\n\n  const setCountsWithBroadcast = React.useCallback((nextCounts: ReviewCounts) => {\n    setCounts(nextCounts)\n    emitUnansweredCount(nextCounts.unanswered)\n  }, [])\n\n  const fetchPage = React.useCallback(\n    async (cursor: string | null, append: boolean, includeCounts: boolean) => {\n      abortRef.current?.abort()\n      const controller = new AbortController()\n      abortRef.current = controller\n\n      if (append) {\n        setLoadingMore(true)\n      } else {\n        setLoading(true)\n      }\n      setError(null)\n\n      const params = new URLSearchParams({ filter, limit: String(REVIEWS_PAGE_SIZE) })\n      if (mention) params.set(\"mention\", mention)\n      params.set(\"status\", status)\n      if (locationId) params.set(\"locationId\", locationId)\n      if (rating != null) params.set(\"rating\", String(rating))\n      if (search) params.set(\"search\", search)\n      if (cursor) params.set(\"cursor\", cursor)\n      params.set(\"includeCounts\", !cursor && includeCounts ? \"1\" : \"0\")\n\n      try {\n        const res = await fetch(`/api/reviews?${params.toString()}`, {\n          signal: controller.signal,\n        })\n\n        if (controller.signal.aborted) return\n\n        if (res.status === 401) {\n          setError(\"SESSION_EXPIRED\")\n          return\n        }\n\n        if (!res.ok) {\n          let msg = res.statusText\n          try {\n            const body = await res.json()\n            if (body.error === \"BAD_CURSOR\") {\n              cursorRef.current = null\n              fetchPage(null, false, includeCounts)\n              return\n            }\n            msg = body.error || msg\n          } catch {\n            // use statusText\n          }\n          setError(msg)\n          return\n        }\n\n        const data = await res.json()\n\n        if (append) {\n          setRows((prev) => [...prev, ...data.rows])\n        } else {\n          setRows(data.rows)\n        }\n\n        if (data.counts !== undefined) {\n          setCountsWithBroadcast(data.counts)\n        }\n\n        if (!append && !cursor && includeCounts) {\n          hasLoadedCountsRef.current = true\n        }\n\n        cursorRef.current = data.nextCursor ?? null\n        setHasMore(!!data.nextCursor)\n      } catch (err: unknown) {\n        if (err instanceof DOMException && err.name === \"AbortError\") return\n        setError(err instanceof Error ? err.message : \"Unknown error\")\n      } finally {\n        if (!controller.signal.aborted) {\n          setLoading(false)\n          setLoadingMore(false)\n        }\n      }\n    },\n    [filter, mention, status, locationId, rating, search, setCountsWithBroadcast],\n  )\n\n  const fetchCounts = React.useCallback(async () => {\n    if (hasLoadedCountsRef.current || countsLoadingRef.current) return\n\n    countsAbortRef.current?.abort()\n    const controller = new AbortController()\n    countsAbortRef.current = controller\n    countsLoadingRef.current = true\n\n    try {\n      const res = await fetch(\"/api/reviews/counts\", { signal: controller.signal })\n      if (controller.signal.aborted) return\n\n      if (res.status === 401) {\n        setError(\"SESSION_EXPIRED\")\n        return\n      }\n\n      if (!res.ok) {\n        return\n      }\n\n      const data = await res.json()\n      if (data.counts !== undefined) {\n        setCountsWithBroadcast(data.counts)\n        hasLoadedCountsRef.current = true\n      }\n    } catch (err: unknown) {\n      if (err instanceof DOMException && err.name === \"AbortError\") return\n      // Ignore background count refresh failures to avoid interrupting list UX.\n    } finally {\n      countsLoadingRef.current = false\n      if (countsAbortRef.current === controller) {\n        countsAbortRef.current = null\n      }\n    }\n  }, [setCountsWithBroadcast])\n\n  React.useEffect(() => {\n    cursorRef.current = null\n    setHasMore(false)\n\n    const canUseInitialPage =\n      !initialConsumedRef.current &&\n      initialPageMatchesFilters({\n        initialPage,\n        filter,\n        mention,\n        status,\n        locationId,\n        rating,\n        search,\n      })\n\n    const matchedInitialPage = canUseInitialPage ? initialPage : null\n    if (matchedInitialPage) {\n      initialConsumedRef.current = true\n      hasLoadedCountsRef.current = matchedInitialPage.counts !== undefined\n      setRows(matchedInitialPage.rows)\n      if (matchedInitialPage.counts) {\n        setCountsWithBroadcast(matchedInitialPage.counts)\n      } else {\n        setCounts(null)\n      }\n      cursorRef.current = matchedInitialPage.nextCursor\n      setHasMore(Boolean(matchedInitialPage.nextCursor))\n      setLoading(false)\n      setLoadingMore(false)\n      setError(null)\n      return () => {\n        abortRef.current?.abort()\n        countsAbortRef.current?.abort()\n      }\n    }\n\n    if (!enabled) {\n      setLoading(false)\n      setLoadingMore(false)\n      return () => {\n        abortRef.current?.abort()\n        countsAbortRef.current?.abort()\n      }\n    }\n\n    fetchPage(null, false, false)\n\n    return () => {\n      abortRef.current?.abort()\n      countsAbortRef.current?.abort()\n    }\n  }, [enabled, fetchPage, filter, initialPage, locationId, mention, rating, search, setCountsWithBroadcast, status])\n\n  React.useEffect(() => {\n    if (!enabled) return\n    if (loading || hasLoadedCountsRef.current) return\n    if (typeof window === \"undefined\") return\n\n    const idleWindow = window as Window & {\n      requestIdleCallback?: (cb: () => void, options?: { timeout?: number }) => number\n      cancelIdleCallback?: (handle: number) => void\n    }\n\n    const run = () => {\n      void fetchCounts()\n    }\n\n    if (typeof idleWindow.requestIdleCallback === \"function\") {\n      const handle = idleWindow.requestIdleCallback(run, { timeout: 1200 })\n      return () => {\n        idleWindow.cancelIdleCallback?.(handle)\n      }\n    }\n\n    const timeout = window.setTimeout(run, 0)\n    return () => {\n      window.clearTimeout(timeout)\n    }\n  }, [enabled, loading, fetchCounts])\n\n  const loadMore = React.useCallback(() => {\n    if (!enabled || !hasMore || loadingMore || loading) return\n    fetchPage(cursorRef.current, true, false)\n  }, [enabled, fetchPage, hasMore, loading, loadingMore])\n\n  const refresh = React.useCallback(() => {\n    if (!enabled) return\n    cursorRef.current = null\n    setHasMore(false)\n    fetchPage(null, false, true)\n  }, [enabled, fetchPage])\n\n  const updateRow = React.useCallback((id: string, updater: (row: ReviewRow) => ReviewRow) => {\n    setRows((prev) => prev.map((row) => (row.id === id ? updater(row) : row)))\n  }, [])\n\n  return { rows, counts, loading, loadingMore, error, hasMore, loadMore, refresh, updateRow }\n}\n"
    },
    {
      "path": "lib/hooks/reviews/useReviewDetail.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks/reviews/useReviewDetail.ts",
      "bytes": 2404,
      "content": "\"use client\"\n\nimport * as React from \"react\"\n\nimport { extractClientErrorMessage } from \"@/lib/api/client-error\"\n\nimport type { ReviewDetail } from \"./types\"\n\ntype UseReviewDetailResult = {\n  review: ReviewDetail | null\n  loading: boolean\n  error: string | null\n  refresh: () => void\n}\n\nexport function useReviewDetail(reviewId: string | null): UseReviewDetailResult {\n  const [review, setReview] = React.useState<ReviewDetail | null>(null)\n  const [loading, setLoading] = React.useState(false)\n  const [error, setError] = React.useState<string | null>(null)\n  const abortRef = React.useRef<AbortController | null>(null)\n\n  const fetchReview = React.useCallback(async (id: string) => {\n    abortRef.current?.abort()\n    const controller = new AbortController()\n    abortRef.current = controller\n\n    setLoading(true)\n    setError(null)\n\n    try {\n      const res = await fetch(`/api/reviews/${id}`, {\n        signal: controller.signal,\n      })\n\n      if (controller.signal.aborted) return\n\n      if (res.status === 401) {\n        setError(\"SESSION_EXPIRED\")\n        return\n      }\n\n      if (res.status === 404) {\n        const body = await res.json().catch(() => null)\n        setError(\n          extractClientErrorMessage({\n            body,\n            statusText: res.statusText,\n            fallback: \"Review not found or not accessible\",\n          }),\n        )\n        return\n      }\n\n      if (!res.ok) {\n        const body = await res.json().catch(() => null)\n        setError(\n          extractClientErrorMessage({\n            body,\n            statusText: res.statusText,\n          }),\n        )\n        return\n      }\n\n      const data = await res.json()\n      setReview(data)\n    } catch (err: unknown) {\n      if (err instanceof DOMException && err.name === \"AbortError\") return\n      setError(err instanceof Error ? err.message : \"Unknown error\")\n    } finally {\n      if (!controller.signal.aborted) {\n        setLoading(false)\n      }\n    }\n  }, [])\n\n  React.useEffect(() => {\n    if (!reviewId) {\n      setReview(null)\n      setLoading(false)\n      setError(null)\n      return\n    }\n\n    void fetchReview(reviewId)\n\n    return () => {\n      abortRef.current?.abort()\n    }\n  }, [reviewId, fetchReview])\n\n  const refresh = React.useCallback(() => {\n    if (reviewId) {\n      void fetchReview(reviewId)\n    }\n  }, [reviewId, fetchReview])\n\n  return { review, loading, error, refresh }\n}\n"
    },
    {
      "path": "lib/hooks/useMediaQuery.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks/useMediaQuery.ts",
      "bytes": 641,
      "content": "\"use client\"\n\nimport * as React from \"react\"\n\nexport function useMediaQuery(query: string): boolean {\n  const [matches, setMatches] = React.useState(false)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(query)\n    setMatches(mql.matches)\n\n    const handler = (e: MediaQueryListEvent) => setMatches(e.matches)\n    mql.addEventListener(\"change\", handler)\n    return () => mql.removeEventListener(\"change\", handler)\n  }, [query])\n\n  return matches\n}\n\nexport function useIsMobile(): boolean {\n  return !useMediaQuery(\"(min-width: 768px)\")\n}\n\nexport function useIsDesktop(): boolean {\n  return useMediaQuery(\"(min-width: 768px)\")\n}\n"
    },
    {
      "path": "lib/reviews/constants.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/reviews/constants.ts",
      "bytes": 36,
      "content": "export const REVIEWS_PAGE_SIZE = 10\n"
    },
    {
      "path": "lib/reviews/detail-to-row.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/reviews/detail-to-row.ts",
      "bytes": 1978,
      "content": "import type { ReviewDetail, ReviewRow } from \"@/lib/hooks/reviews/types\"\nimport type { DraftStatus } from \"@/lib/reviews/types\"\n\nconst DRAFT_STATUS_VALUES: DraftStatus[] = [\n  \"NEEDS_APPROVAL\",\n  \"BLOCKED_BY_VERIFIER\",\n  \"READY\",\n  \"POSTED\",\n  \"POST_FAILED\",\n]\n\nfunction normalizeDraftStatus(status: string): DraftStatus {\n  if (DRAFT_STATUS_VALUES.includes(status as DraftStatus)) {\n    return status as DraftStatus\n  }\n  return \"NEEDS_APPROVAL\"\n}\n\nexport function mapReviewDetailToRow(detail: ReviewDetail, existing?: ReviewRow): ReviewRow {\n  const draftStatus = detail.currentDraft ? normalizeDraftStatus(detail.currentDraft.status) : null\n  const draftUpdatedAt =\n    detail.currentDraft == null\n      ? null\n      : typeof detail.currentDraft.updatedAt === \"string\" && detail.currentDraft.updatedAt.length > 0\n        ? detail.currentDraft.updatedAt\n        : existing?.currentDraft?.updatedAtIso ?? detail.updateTime\n\n  return {\n    id: detail.id,\n    starRating: detail.starRating,\n    snippet: (detail.comment ?? \"\").slice(0, 120),\n    comment: detail.comment ?? \"\",\n    reviewer: {\n      displayName: detail.reviewer.displayName,\n      isAnonymous: detail.reviewer.isAnonymous,\n    },\n    location: {\n      id: detail.location.id,\n      displayName: detail.location.name,\n    },\n    createTimeIso: detail.createTime,\n    unanswered: detail.reply.comment == null,\n    status: detail.reply.comment == null ? \"pending\" : \"replied\",\n    reply: {\n      comment: detail.reply.comment,\n      updateTimeIso: detail.reply.updateTime,\n    },\n    currentDraft: detail.currentDraft\n      ? {\n          id: detail.currentDraft.id,\n          text: detail.currentDraft.text,\n          status: draftStatus ?? \"NEEDS_APPROVAL\",\n          version: detail.currentDraft.version,\n          updatedAtIso: draftUpdatedAt ?? detail.updateTime,\n          verifierResultJson: detail.currentDraft.verifierResultJson,\n        }\n      : null,\n    draftStatus,\n    mentions: detail.mentions,\n  }\n}\n"
    },
    {
      "path": "lib/reviews/types.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/reviews/types.ts",
      "bytes": 934,
      "content": "export type DraftStatus =\n  | \"NEEDS_APPROVAL\"\n  | \"BLOCKED_BY_VERIFIER\"\n  | \"READY\"\n  | \"POSTED\"\n  | \"POST_FAILED\"\n\nexport type ReviewListRow = {\n  id: string\n  starRating: number\n  snippet: string\n  comment: string\n  reviewer: { displayName: string | null; isAnonymous: boolean }\n  location: { id: string; displayName: string }\n  createTimeIso: string\n  unanswered: boolean\n  status: \"pending\" | \"replied\"\n  reply: { comment: string | null; updateTimeIso: string | null }\n  currentDraft: {\n    id: string\n    text: string\n    status: DraftStatus\n    version: number\n    updatedAtIso: string\n    verifierResultJson?: unknown | null\n  } | null\n  draftStatus: DraftStatus | null\n  mentions: string[]\n}\n\nexport type ReviewListCounts = {\n  unanswered: number\n  urgent: number\n  five_star: number\n  mentions_total: number\n}\n\nexport type ReviewListPage = {\n  rows: ReviewListRow[]\n  nextCursor: string | null\n  counts?: ReviewListCounts\n}\n"
    },
    {
      "path": "lib/reviews/verifier-envelope.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/reviews/verifier-envelope.ts",
      "bytes": 2804,
      "content": "import { verifierViolationSchema } from \"@/lib/ai/draft\"\nimport { z } from \"zod\"\n\nexport const VERIFIER_RESULT_SCHEMA_VERSION = 1 as const\n\nconst verifierDecisionSourceSchema = z.enum([\"DSPY_VERIFIER\", \"LOCAL_DETERMINISTIC_POLICY\"])\nconst freshnessHashSchema = z.string().regex(/^[a-f0-9]{64}$/)\nconst verifierPayloadBodySchema = z\n  .object({\n    issues: z.array(z.string()).optional(),\n    dspy: z\n      .object({\n        decision: z.enum([\"READY\", \"BLOCKED_BY_VERIFIER\"]).optional(),\n        verifier: z\n          .object({\n            pass: z.boolean().optional(),\n            violations: z.array(verifierViolationSchema).optional(),\n            suggestedRewrite: z.string().nullable().optional(),\n          })\n          .strict()\n          .optional(),\n        seoQuality: z.unknown().optional(),\n        generation: z.unknown().optional(),\n        models: z.unknown().optional(),\n        trace: z.unknown().optional(),\n        latencyMs: z.number().int().nonnegative().optional(),\n      })\n      .strict()\n      .optional(),\n    policy: z\n      .object({\n        localViolations: z.array(verifierViolationSchema).optional(),\n      })\n      .strict()\n      .optional(),\n  })\n  .strict()\nconst verifierResultEnvelopeSchema = z\n  .object({\n    schemaVersion: z.literal(VERIFIER_RESULT_SCHEMA_VERSION),\n    decisionSource: verifierDecisionSourceSchema,\n    freshnessHash: freshnessHashSchema.optional(),\n    payload: verifierPayloadBodySchema,\n  })\n  .strict()\n\nexport type VerifierDecisionSource = z.infer<typeof verifierDecisionSourceSchema>\nexport type VerifierPayloadBody = z.infer<typeof verifierPayloadBodySchema>\nexport type VerifierResultEnvelope = z.infer<typeof verifierResultEnvelopeSchema>\n\nexport function parseVerifierResultEnvelope(value: unknown): VerifierResultEnvelope | null {\n  const parsed = verifierResultEnvelopeSchema.safeParse(value)\n  return parsed.success ? parsed.data : null\n}\n\nexport function parseVerifierPayloadBody(value: unknown): VerifierPayloadBody | null {\n  const parsed = verifierPayloadBodySchema.safeParse(value)\n  return parsed.success ? parsed.data : null\n}\n\nexport function buildVerifierResultEnvelope(input: {\n  decisionSource: VerifierDecisionSource\n  freshnessHash?: string\n  payload: VerifierPayloadBody\n}): VerifierResultEnvelope {\n  return verifierResultEnvelopeSchema.parse({\n    schemaVersion: VERIFIER_RESULT_SCHEMA_VERSION,\n    decisionSource: input.decisionSource,\n    freshnessHash: input.freshnessHash,\n    payload: input.payload,\n  })\n}\n\nexport function unwrapVerifierResultPayload(payload: unknown): VerifierPayloadBody | null {\n  return parseVerifierResultEnvelope(payload)?.payload ?? null\n}\n\nexport function readVerifierFreshnessHash(payload: unknown): string | null {\n  return parseVerifierResultEnvelope(payload)?.freshnessHash ?? null\n}\n"
    },
    {
      "path": "lib/reviews/verifier-result.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/reviews/verifier-result.ts",
      "bytes": 2865,
      "content": "import {\n  parseVerifierPayloadBody,\n  parseVerifierResultEnvelope,\n  unwrapVerifierResultPayload,\n} from \"@/lib/reviews/verifier-envelope\"\n\ntype VerifierLikePayload = {\n  issues?: unknown\n  dspy?: {\n    verifier?: {\n      violations?: Array<{ message?: unknown }> | unknown\n    }\n  }\n  policy?: {\n    localViolations?: Array<{ message?: unknown }> | unknown\n  }\n}\n\nexport function extractVerifierIssueMessages(payload: unknown): string[] {\n  const parsedEnvelope = parseVerifierResultEnvelope(payload)\n  if (parsedEnvelope) {\n    return dedupeMessages(collectIssueMessages(parsedEnvelope.payload))\n  }\n\n  const parsedPayload = parseVerifierPayloadBody(payload)\n  if (parsedPayload) {\n    return dedupeMessages(collectIssueMessages(parsedPayload))\n  }\n\n  const source = unwrapVerifierResultPayload(payload)\n  if (source) {\n    return dedupeMessages(collectIssueMessages(source))\n  }\n\n  const candidates = getLoosePayloadCandidates(payload)\n  if (candidates.length === 0) return []\n  return dedupeMessages(candidates.flatMap((candidate) => collectIssueMessages(candidate)))\n}\n\nexport function getFirstVerifierIssueMessage(payload: unknown): string | null {\n  return extractVerifierIssueMessages(payload)[0] ?? null\n}\n\nfunction getLoosePayloadCandidates(payload: unknown): VerifierLikePayload[] {\n  if (!payload || typeof payload !== \"object\" || Array.isArray(payload)) return []\n  const root = payload as Record<string, unknown>\n  const nested = root.payload\n  const list: VerifierLikePayload[] = [root as VerifierLikePayload]\n  if (nested && typeof nested === \"object\" && !Array.isArray(nested)) {\n    list.push(nested as VerifierLikePayload)\n  }\n  return list\n}\n\nfunction collectIssueMessages(value: VerifierLikePayload): string[] {\n  if (!value || typeof value !== \"object\") return []\n\n  const fromIssues = toStringArray(value.issues)\n  const fromDspy = toViolationMessages(value.dspy?.verifier?.violations)\n  const fromPolicy = toViolationMessages(value.policy?.localViolations)\n\n  return [...fromIssues, ...fromDspy, ...fromPolicy]\n}\n\nfunction dedupeMessages(messages: string[]): string[] {\n  const seen = new Set<string>()\n  const deduped: string[] = []\n  for (const message of messages) {\n    const normalized = message.trim()\n    if (!normalized) continue\n    const key = normalized.toLowerCase()\n    if (seen.has(key)) continue\n    seen.add(key)\n    deduped.push(normalized)\n  }\n\n  return deduped\n}\n\nfunction toStringArray(value: unknown): string[] {\n  if (!Array.isArray(value)) return []\n  return value.filter((item): item is string => typeof item === \"string\")\n}\n\nfunction toViolationMessages(value: unknown): string[] {\n  if (!Array.isArray(value)) return []\n  return value\n    .map((item) => (item && typeof item === \"object\" ? (item as { message?: unknown }).message : null))\n    .filter((message): message is string => typeof message === \"string\")\n}\n"
    },
    {
      "path": "lib/utils.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/utils.ts",
      "bytes": 166,
      "content": "import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"
    }
  ]
}
