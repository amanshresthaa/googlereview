{
  "route": "/inbox",
  "scope": "frontend",
  "source": "next-dev-source-maps",
  "chunkFile": ".next/dev/static/chunks/app/(app)/inbox/page.js",
  "generatedAt": "2026-02-17T16:19:26.209Z",
  "workspace": "/Users/amankumarshrestha/LapenInns Project/googlereview",
  "mapCount": 475,
  "fileCount": 39,
  "files": [
    {
      "path": "app/(app)/inbox/components/InboxFilterBar.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/components/InboxFilterBar.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { AnimatePresence, motion } from \"framer-motion\"\n\nimport { Button } from \"@/components/ui/button\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\"\nimport { CheckCheck, Filter, RefreshCw, SlidersHorizontal, X } from \"lucide-react\"\nimport { INBOX_THEME_CLASSES } from \"@/lib/design-system/inbox-theme\"\nimport { cn } from \"@/lib/utils\"\n\nimport type { ReviewFilter } from \"@/lib/hooks\"\nimport type { LocationOption } from \"../types\"\n\ntype InboxFilterBarProps = {\n  filter: ReviewFilter\n  onFilterChange: (value: ReviewFilter) => void\n  mentionFilter: string\n  onMentionFilterChange: (value: string) => void\n  mentionKeywords: string[]\n  locationFilter: string\n  onLocationFilterChange: (value: string) => void\n  locations: LocationOption[]\n  ratingFilter: string\n  onRatingFilterChange: (value: string) => void\n  activeFiltersCount: number\n  onReset: () => void\n  onBulkApprove: () => void\n  bulkApproveCount: number\n  bulkApproveLoading: boolean\n  bulkApproveEnabled: boolean\n}\n\nconst FILTER_PANEL_ID = \"inbox-filter-panel\"\n\nconst FILTER_OPTIONS: Array<{ value: ReviewFilter; label: string }> = [\n  { value: \"unanswered\", label: \"Pending\" },\n  { value: \"urgent\", label: \"Urgent\" },\n  { value: \"five_star\", label: \"5 Star\" },\n  { value: \"mentions\", label: \"Mentions\" },\n  { value: \"all\", label: \"All\" },\n]\n\nconst RATING_OPTIONS = [\n  { value: \"all\", label: \"Any rating\" },\n  { value: \"5\", label: \"5★\" },\n  { value: \"4\", label: \"4★\" },\n  { value: \"3\", label: \"3★\" },\n  { value: \"2\", label: \"2★\" },\n  { value: \"1\", label: \"1★\" },\n] as const\n\nexport function InboxFilterBar({\n  filter,\n  onFilterChange,\n  mentionFilter,\n  onMentionFilterChange,\n  mentionKeywords,\n  locationFilter,\n  onLocationFilterChange,\n  locations,\n  ratingFilter,\n  onRatingFilterChange,\n  activeFiltersCount,\n  onReset,\n  onBulkApprove,\n  bulkApproveCount,\n  bulkApproveLoading,\n  bulkApproveEnabled,\n}: InboxFilterBarProps) {\n  const [expanded, setExpanded] = React.useState(false)\n\n  return (\n    <section className={INBOX_THEME_CLASSES.filterSection}>\n      <div className=\"flex items-center justify-between gap-2.5\">\n        <div className=\"flex items-center gap-2 overflow-x-auto pb-1\">\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setExpanded((prev) => !prev)}\n            aria-expanded={expanded}\n            aria-controls={FILTER_PANEL_ID}\n            className={cn(\n              \"h-8 px-3\",\n              INBOX_THEME_CLASSES.filterToggle,\n              expanded\n                ? INBOX_THEME_CLASSES.filterToggleActive\n                : INBOX_THEME_CLASSES.filterToggleIdle,\n            )}\n          >\n            <Filter className=\"h-3.5 w-3.5\" />\n            Filters\n            {activeFiltersCount > 0 && (\n              <span className=\"ml-1 text-brand-muted\">{activeFiltersCount}</span>\n            )}\n          </Button>\n\n          {activeFiltersCount > 0 && !expanded ? (\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={onReset}\n              className=\"h-8 w-8 text-shell-foreground/40 transition-colors hover:bg-transparent hover:text-shell-foreground/60\"\n              aria-label=\"Reset filters\"\n            >\n              <X className=\"h-3.5 w-3.5\" />\n            </Button>\n          ) : null}\n\n          <Separator orientation=\"vertical\" className=\"mx-1 h-6 bg-shell-foreground/10\" />\n\n          <div className=\"flex items-center gap-1 text-xs font-bold tracking-widest text-shell-foreground/40 uppercase\">\n            <SlidersHorizontal className=\"h-3 w-3\" /> Sort by Relevance\n          </div>\n        </div>\n\n        {bulkApproveEnabled && bulkApproveCount > 0 ? (\n          <Button\n            type=\"button\"\n            size=\"sm\"\n            className={cn(\n              \"h-8 shrink-0\",\n              !bulkApproveLoading\n                ? \"bg-transparent border-none text-success-soft hover:text-success/80 text-xs font-bold\"\n                : \"bg-transparent border-none text-shell-foreground/40 text-xs font-bold\",\n            )}\n            onClick={onBulkApprove}\n            disabled={bulkApproveLoading || bulkApproveCount === 0}\n            aria-label={`Bulk approve ${bulkApproveCount} reviews`}\n          >\n            {bulkApproveLoading ? (\n              <RefreshCw className=\"mr-1.5 h-3.5 w-3.5 animate-spin\" />\n            ) : (\n              <CheckCheck className=\"mr-1.5 h-4 w-4\" />\n            )}\n            Approve all ready drafts\n          </Button>\n        ) : null}\n      </div>\n\n      <AnimatePresence initial={false}>\n        {expanded ? (\n          <motion.div\n            id={FILTER_PANEL_ID}\n            role=\"region\"\n            aria-label=\"Inbox filters\"\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: \"auto\", opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.24, ease: [0.16, 1, 0.3, 1] }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"mt-3 flex items-center gap-2.5 overflow-x-auto pb-1.5\">\n              <Select value={filter} onValueChange={(value) => onFilterChange(value as ReviewFilter)}>\n                <SelectTrigger className={cn(INBOX_THEME_CLASSES.filterSelectTrigger, \"min-w-[110px]\")}>\n                  <SelectValue placeholder=\"Queue\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {FILTER_OPTIONS.map((option) => (\n                    <SelectItem\n                      key={option.value}\n                      value={option.value}\n                      disabled={option.value === \"mentions\" && mentionKeywords.length === 0}\n                    >\n                      {option.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n\n              {filter === \"mentions\" ? (\n                <Select value={mentionFilter || \"\"} onValueChange={onMentionFilterChange}>\n                  <SelectTrigger className={cn(INBOX_THEME_CLASSES.filterSelectTrigger, \"min-w-[115px]\")}>\n                    <SelectValue placeholder=\"Keyword\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {mentionKeywords.map((keyword) => (\n                      <SelectItem key={keyword} value={keyword}>\n                        {keyword}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              ) : (\n                <Select value={locationFilter} onValueChange={onLocationFilterChange}>\n                  <SelectTrigger className={cn(INBOX_THEME_CLASSES.filterSelectTrigger, \"min-w-[125px]\")}>\n                    <SelectValue placeholder=\"Location\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All locations</SelectItem>\n                    {locations.map((location) => (\n                      <SelectItem key={location.id} value={location.id}>\n                        {location.displayName}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              )}\n\n              <Select value={ratingFilter} onValueChange={onRatingFilterChange}>\n                <SelectTrigger className={cn(INBOX_THEME_CLASSES.filterSelectTrigger, \"min-w-[98px]\")}>\n                  <SelectValue placeholder=\"Rating\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {RATING_OPTIONS.map((option) => (\n                    <SelectItem key={option.value} value={option.value}>\n                      {option.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n\n              {activeFiltersCount > 0 ? (\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={onReset}\n                  className={cn(\"h-auto px-3 py-1.5\", INBOX_THEME_CLASSES.filterResetButton)}\n                >\n                  Reset\n                </Button>\n              ) : null}\n            </div>\n          </motion.div>\n        ) : null}\n      </AnimatePresence>\n\n      <p className=\"sr-only\" role=\"status\" aria-live=\"polite\">\n        {activeFiltersCount} active filters.\n      </p>\n    </section>\n  )\n}\n"
    },
    {
      "path": "app/(app)/inbox/components/InboxHeader.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/components/InboxHeader.tsx",
      "content": "\"use client\"\n\nimport { motion } from \"framer-motion\"\n\nimport { NotificationCenter } from \"@/components/NotificationCenter\"\nimport { Button } from \"@/components/ui/button\"\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\nimport { RefreshCw } from \"lucide-react\"\nimport { INBOX_THEME_CLASSES, inboxSegmentedClass } from \"@/lib/design-system/inbox-theme\"\nimport { cn } from \"@/lib/utils\"\n\nexport type InboxTab = \"pending\" | \"replied\" | \"all\"\n\ntype InboxHeaderProps = {\n  pendingCount: number\n  tab: InboxTab\n  onTabChange: (value: InboxTab) => void\n  refreshing: boolean\n  onRefresh: () => void\n}\n\nconst TAB_OPTIONS: Array<{ value: InboxTab; label: string }> = [\n  { value: \"pending\", label: \"Pending\" },\n  { value: \"replied\", label: \"Replied\" },\n  { value: \"all\", label: \"All\" },\n]\n\nconst TABLIST_ID = \"inbox-tablist\"\n\nexport function InboxHeader({\n  pendingCount,\n  tab,\n  onTabChange,\n  refreshing,\n  onRefresh,\n}: InboxHeaderProps) {\n  return (\n    <motion.header\n      initial={{ opacity: 0, y: -8 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.32, ease: [0.16, 1, 0.3, 1] }}\n      className={INBOX_THEME_CLASSES.headerSection}\n    >\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"bg-gradient-to-b from-shell-foreground to-shell-foreground/60 bg-clip-text text-3xl font-black tracking-tight text-transparent lg:text-4xl\">\n            Reviews\n          </h2>\n          <p className=\"text-sm text-shell-foreground/40 mt-1 font-medium\">\n            Manage your reputation\n            {pendingCount > 0 && (\n              <span className=\"ml-2 text-shell-foreground/60\">\n                • {pendingCount} pending\n              </span>\n            )}\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <NotificationCenter className={INBOX_THEME_CLASSES.iconButton} />\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"icon\"\n            className={INBOX_THEME_CLASSES.iconButton}\n            onClick={onRefresh}\n            aria-label=\"Refresh inbox\"\n          >\n            <RefreshCw className={cn(\"h-4 w-4 text-shell-foreground/60\", refreshing && \"animate-spin\")} />\n          </Button>\n        </div>\n      </div>\n\n      <Tabs value={tab} onValueChange={(value) => onTabChange(value as InboxTab)}>\n        <TabsList\n          className={cn(INBOX_THEME_CLASSES.segmented, \"h-auto w-full justify-start rounded-none bg-transparent p-0\")}\n          aria-label=\"Review status tabs\"\n          id={TABLIST_ID}\n        >\n          {TAB_OPTIONS.map((option) => (\n            <TabsTrigger\n              key={option.value}\n              value={option.value}\n              id={`inbox-tab-${option.value}`}\n              aria-controls=\"inbox-review-list-panel\"\n              className={cn(\n                inboxSegmentedClass(option.value === tab),\n                \"data-[state=active]:shadow-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/30\",\n              )}\n            >\n              {option.label}\n            </TabsTrigger>\n          ))}\n        </TabsList>\n      </Tabs>\n\n      <p className=\"sr-only\" role=\"status\" aria-live=\"polite\">\n        {pendingCount} pending reviews.\n      </p>\n    </motion.header>\n  )\n}\n"
    },
    {
      "path": "app/(app)/inbox/components/InboxReviewList.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/components/InboxReviewList.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\n\nimport { EmptyState } from \"@/components/ErrorStates\"\nimport { ReviewCard } from \"@/components/ReviewCard\"\nimport { Inbox, RefreshCw } from \"lucide-react\"\nimport { Button } from \"@/components/ui/button\"\nimport { SkeletonList } from \"@/components/ui/progress\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { INBOX_THEME_CLASSES } from \"@/lib/design-system/inbox-theme\"\nimport { useSmoothLoading } from \"@/lib/hooks/useSmoothLoading\"\n\nimport type { ReviewRow } from \"@/lib/hooks\"\n\ntype InboxReviewListProps = {\n  activeTab: \"pending\" | \"replied\" | \"all\"\n  rows: ReviewRow[]\n  activeReviewId: string | null\n  loading: boolean\n  error: string | null\n  hasMore: boolean\n  loadingMore: boolean\n  showQuickApprove: boolean\n  quickApproveLoadingId: string | null\n  onOpenReview: (reviewId: string) => void\n  onQuickApprove: (reviewId: string) => void\n  onGenerateDraft: (reviewId: string) => Promise<void>\n  onSaveDraft: (reviewId: string, text: string, options?: { silent?: boolean }) => Promise<void>\n  onVerifyDraft: (reviewId: string) => Promise<void>\n  onPublishReply: (reviewId: string, text: string, row: ReviewRow) => Promise<void>\n  onLoadMore: () => void\n  onRetry: () => void\n}\n\nconst NOOP_CHECKED_CHANGE: (reviewId: string, checked: boolean) => void = () => {}\n\nexport const InboxReviewList = React.memo(function InboxReviewList({\n  activeTab,\n  rows,\n  activeReviewId,\n  loading,\n  error,\n  hasMore,\n  loadingMore,\n  showQuickApprove,\n  quickApproveLoadingId,\n  onOpenReview,\n  onQuickApprove,\n  onGenerateDraft,\n  onSaveDraft,\n  onVerifyDraft,\n  onPublishReply,\n  onLoadMore,\n  onRetry,\n}: InboxReviewListProps) {\n  const showLoading = useSmoothLoading(loading && rows.length === 0, { delayMs: 120, minDurationMs: 420 })\n  const hasRows = !showLoading && !error && rows.length > 0\n\n  return (\n    <section\n      id=\"inbox-review-list-panel\"\n      role=\"tabpanel\"\n      aria-labelledby={`inbox-tab-${activeTab}`}\n      aria-busy={showLoading || loadingMore}\n      className={INBOX_THEME_CLASSES.feedListSection}\n    >\n      <ScrollArea className=\"h-full\">\n        <div className={INBOX_THEME_CLASSES.feedListInner} role=\"list\" aria-label=\"Reviews list\">\n          <p className=\"sr-only\" role=\"status\" aria-live=\"polite\">\n            {showLoading ? \"Loading reviews.\" : `${rows.length} reviews loaded.`}\n          </p>\n\n          {showLoading ? <SkeletonList count={4} /> : null}\n\n          {!showLoading && error ? (\n            <EmptyState\n              title=\"Unable to load reviews\"\n              description={error}\n              action={{ label: \"Retry\", onClick: onRetry }}\n            />\n          ) : null}\n\n          {!showLoading && !error && rows.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-24 opacity-30 text-center\">\n              <Inbox className=\"mb-4 h-12 w-12 text-shell-foreground/40\" />\n              <p className=\"text-sm font-medium text-shell-foreground/60\">All reviews handled</p>\n              <p className=\"mt-1 text-xs text-shell-foreground/30\">No conversations match the current queue and filters.</p>\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                onClick={onRetry}\n                className=\"mt-4 text-shell-foreground/40 hover:text-shell-foreground/60\"\n              >\n                Refresh\n              </Button>\n            </div>\n          ) : null}\n\n          {hasRows\n            ? rows.map((row) => (\n                <div key={row.id} role=\"listitem\">\n                  <ReviewCard\n                    reviewId={row.id}\n                    row={row}\n                    showCheckbox={false}\n                    checked={false}\n                    onCheckedChange={NOOP_CHECKED_CHANGE}\n                    onOpen={onOpenReview}\n                    selected={row.id === activeReviewId}\n                    showQuickApprove={showQuickApprove}\n                    onQuickApprove={onQuickApprove}\n                    quickApproveLoading={quickApproveLoadingId === row.id}\n                    onGenerateDraft={onGenerateDraft}\n                    onSaveDraft={onSaveDraft}\n                    onVerifyDraft={onVerifyDraft}\n                    onPublishReply={onPublishReply}\n                  />\n                </div>\n              ))\n            : null}\n\n          {!showLoading && !error && hasMore ? (\n            <div className=\"pt-2\">\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                className={INBOX_THEME_CLASSES.listLoadMoreButton}\n                onClick={onLoadMore}\n                disabled={loadingMore}\n                aria-label={loadingMore ? \"Loading more reviews\" : \"Load more reviews\"}\n              >\n                {loadingMore ? (\n                  <>\n                    <RefreshCw className=\"mr-1.5 h-3.5 w-3.5 animate-spin text-shell-foreground/60\" />\n                    Loading\n                  </>\n                ) : (\n                  \"Load more\"\n                )}\n              </Button>\n            </div>\n          ) : null}\n        </div>\n      </ScrollArea>\n    </section>\n  )\n})\n\nInboxReviewList.displayName = \"InboxReviewList\"\n"
    },
    {
      "path": "app/(app)/inbox/hooks/useReviewMutations.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/hooks/useReviewMutations.ts",
      "content": "import * as React from \"react\"\nimport { toast } from \"sonner\"\n\nimport { applyDetailSnapshot, getVerifierBlockedMessage, mapDetailToRow } from \"../model\"\nimport { apiCall, fetchReviewDetail, waitForJobCompletion, waitForReviewState } from \"../network\"\n\nimport type { ReviewDetail, ReviewRow } from \"@/lib/hooks\"\nimport type { ReviewMutationResponse } from \"../types\"\n\nconst QUICK_JOB_WAIT_MS = 1800\nconst BACKGROUND_JOB_WAIT_MS = 25_000\n\ntype UseReviewMutationsInput = {\n  rows: ReviewRow[]\n  updateRow: (id: string, updater: (row: ReviewRow) => ReviewRow) => void\n  refresh: () => Promise<void> | void\n  onQueuedJob?: (event: {\n    jobId: string\n    reviewId: string\n    operation: \"generate\" | \"verify\" | \"publish\"\n  }) => void\n}\n\nexport function useReviewMutations({ rows, updateRow, refresh, onQueuedJob }: UseReviewMutationsInput) {\n  const backgroundJobsRef = React.useRef<Set<string>>(new Set())\n\n  const getJobId = React.useCallback((result: ReviewMutationResponse) => {\n    return result.jobId ?? result.verifyJobId ?? result.job?.id ?? null\n  }, [])\n\n  const syncRowFromServer = React.useCallback(async (reviewId: string) => {\n    const detail = await fetchReviewDetail(reviewId)\n    if (detail) {\n      updateRow(reviewId, (row) => mapDetailToRow(row, detail))\n    }\n    return detail\n  }, [updateRow])\n\n  const syncRowFromSnapshotOrServer = React.useCallback(async (reviewId: string, detail: ReviewDetail | null) => {\n    if (detail) {\n      updateRow(reviewId, (row) => mapDetailToRow(row, detail))\n      return detail\n    }\n    return syncRowFromServer(reviewId)\n  }, [syncRowFromServer, updateRow])\n\n  const resolveTerminalFailureMessage = React.useCallback((params: {\n    status: \"FAILED\" | \"CANCELLED\"\n    fallbackMessage: string\n    lastError: string | null\n  }) => {\n    const { status, fallbackMessage, lastError } = params\n    if (lastError === \"DRAFT_STALE\" || lastError?.includes('\"code\":\"DRAFT_STALE\"')) {\n      return \"Draft changed while posting. Publish again to send the latest draft.\"\n    }\n    if (lastError) return lastError\n    if (status === \"CANCELLED\") return \"This job was cancelled before completion.\"\n    return fallbackMessage\n  }, [])\n\n  const settleQueuedJob = React.useCallback(async (params: {\n    jobId: string\n    reviewId: string\n    operation: \"generate\" | \"verify\" | \"publish\"\n    queuedMessage: string\n    successMessage: string\n    failureMessage: string\n    onCompleted: (reviewSnapshot: ReviewDetail | null) => Promise<void>\n  }) => {\n    const { jobId, reviewId, operation, queuedMessage, successMessage, failureMessage, onCompleted } = params\n\n    const quickResult = await waitForJobCompletion(jobId, QUICK_JOB_WAIT_MS)\n    if (quickResult?.job.status === \"FAILED\" || quickResult?.job.status === \"CANCELLED\") {\n      throw new Error(\n        resolveTerminalFailureMessage({\n          status: quickResult.job.status,\n          fallbackMessage: failureMessage,\n          lastError: quickResult.job.lastError,\n        }),\n      )\n    }\n\n    if (quickResult?.job.status === \"COMPLETED\") {\n      await onCompleted(quickResult.review ?? null)\n      toast.success(successMessage)\n      return\n    }\n\n    toast.success(queuedMessage)\n    onQueuedJob?.({ jobId, reviewId, operation })\n    if (backgroundJobsRef.current.has(jobId)) return\n    backgroundJobsRef.current.add(jobId)\n\n    void (async () => {\n      try {\n        const final = await waitForJobCompletion(jobId, BACKGROUND_JOB_WAIT_MS)\n        if (!final) return\n\n        if (final.job.status === \"FAILED\" || final.job.status === \"CANCELLED\") {\n          toast.error(\n            resolveTerminalFailureMessage({\n              status: final.job.status,\n              fallbackMessage: failureMessage,\n              lastError: final.job.lastError,\n            }),\n          )\n          return\n        }\n\n        await onCompleted(final.review ?? null)\n        toast.success(successMessage)\n      } catch (error) {\n        toast.error(error instanceof Error ? error.message : failureMessage)\n      } finally {\n        backgroundJobsRef.current.delete(jobId)\n      }\n    })()\n  }, [onQueuedJob, resolveTerminalFailureMessage])\n\n  const generateDraft = React.useCallback(async (reviewId: string) => {\n    const previousDraftId = rows.find((row) => row.id === reviewId)?.currentDraft?.id ?? null\n    const result = await apiCall<ReviewMutationResponse>(`/api/reviews/${reviewId}/drafts/generate`, \"POST\")\n\n    if (applyDetailSnapshot(reviewId, result.review, updateRow)) {\n      toast.success(\"Draft regenerated\")\n      return\n    }\n\n    const jobId = getJobId(result)\n    if (jobId) {\n      await settleQueuedJob({\n        jobId,\n        reviewId,\n        operation: \"generate\",\n        queuedMessage: \"Draft generation queued\",\n        successMessage: \"Draft regenerated\",\n        failureMessage: \"Draft generation failed.\",\n        onCompleted: async (reviewSnapshot) => {\n          await syncRowFromSnapshotOrServer(reviewId, reviewSnapshot)\n        },\n      })\n      return\n    }\n\n    const changed = await waitForReviewState(\n      reviewId,\n      (detail) => {\n        const currentDraftId = detail.currentDraft?.id ?? null\n        return previousDraftId == null ? currentDraftId != null : currentDraftId !== previousDraftId\n      },\n      5000,\n    )\n\n    if (changed) {\n      updateRow(reviewId, (row) => mapDetailToRow(row, changed))\n      toast.success(\"Draft regenerated\")\n    } else {\n      toast.success(\"Draft generation queued\")\n    }\n  }, [getJobId, rows, settleQueuedJob, syncRowFromSnapshotOrServer, updateRow])\n\n  const saveDraft = React.useCallback(async (reviewId: string, text: string, options?: { silent?: boolean }) => {\n    const silent = options?.silent ?? false\n    const trimmed = text.trim()\n    if (!trimmed) throw new Error(\"Draft is empty.\")\n\n    const result = await apiCall<ReviewMutationResponse>(`/api/reviews/${reviewId}/drafts/edit`, \"POST\", { text: trimmed })\n    if (applyDetailSnapshot(reviewId, result.review, updateRow)) {\n      if (!silent) toast.success(\"Draft saved\")\n      return\n    }\n\n    const claimed = Number(result?.worker?.claimed ?? 0)\n    const changed = await waitForReviewState(\n      reviewId,\n      (detail) => (detail.currentDraft?.text.trim() ?? \"\") === trimmed,\n      claimed > 0 ? 5000 : 6500,\n    )\n\n    if (changed) {\n      updateRow(reviewId, (row) => mapDetailToRow(row, changed))\n      if (!silent) toast.success(\"Draft saved\")\n    }\n  }, [updateRow])\n\n  const verifyDraft = React.useCallback(async (reviewId: string) => {\n    const currentRow = rows.find((row) => row.id === reviewId)\n    if (currentRow?.currentDraft?.status === \"READY\") {\n      toast.success(\"Draft already verified\")\n      return\n    }\n\n    const result = await apiCall<ReviewMutationResponse>(`/api/reviews/${reviewId}/drafts/verify`, \"POST\")\n    if (applyDetailSnapshot(reviewId, result.review, updateRow)) {\n      if (result.review?.currentDraft?.status === \"BLOCKED_BY_VERIFIER\") {\n        throw new Error(getVerifierBlockedMessage(result.review))\n      }\n      toast.success(\"Draft verified\")\n      return\n    }\n\n    const jobId = getJobId(result)\n    if (jobId) {\n      await settleQueuedJob({\n        jobId,\n        reviewId,\n        operation: \"verify\",\n        queuedMessage: \"Draft verification queued\",\n        successMessage: \"Draft verified\",\n        failureMessage: \"Draft verification failed.\",\n        onCompleted: async (reviewSnapshot) => {\n          const detail = await syncRowFromSnapshotOrServer(reviewId, reviewSnapshot)\n          if (detail?.currentDraft?.status === \"BLOCKED_BY_VERIFIER\") {\n            throw new Error(getVerifierBlockedMessage(detail))\n          }\n        },\n      })\n      return\n    }\n\n    const claimed = Number(result?.worker?.claimed ?? 0)\n    const verified = await waitForReviewState(\n      reviewId,\n      (detail) => {\n        const status = detail.currentDraft?.status\n        return status === \"READY\" || status === \"BLOCKED_BY_VERIFIER\"\n      },\n      claimed > 0 ? 5000 : 7000,\n    )\n\n    if (!verified) throw new Error(\"Verification is still processing. Please retry.\")\n\n    updateRow(reviewId, (row) => mapDetailToRow(row, verified))\n    if (verified.currentDraft?.status === \"BLOCKED_BY_VERIFIER\") {\n      throw new Error(getVerifierBlockedMessage(verified))\n    }\n    toast.success(\"Draft verified\")\n  }, [getJobId, rows, settleQueuedJob, syncRowFromSnapshotOrServer, updateRow])\n\n  const publishReply = React.useCallback(async (reviewId: string, text: string, row: ReviewRow) => {\n    if (!text.trim()) throw new Error(\"Draft is empty.\")\n\n    const current = row.currentDraft?.text.trim() ?? \"\"\n    const incoming = text.trim()\n    let verified: ReviewDetail | null = null\n    const canSkipVerify = current === incoming && row.currentDraft?.status === \"READY\"\n\n    if (current !== incoming) {\n      const editResult = await apiCall<ReviewMutationResponse>(`/api/reviews/${reviewId}/drafts/edit`, \"POST\", { text: incoming })\n      if (applyDetailSnapshot(reviewId, editResult.review, updateRow)) {\n        verified = editResult.review ?? null\n      }\n\n      const editClaimed = Number(editResult?.worker?.claimed ?? 0)\n      if (!verified) {\n        const afterEdit = await waitForReviewState(\n          reviewId,\n          (detail) => {\n            const currentText = detail.currentDraft?.text.trim() ?? \"\"\n            const status = detail.currentDraft?.status\n            return currentText === incoming && (status === \"READY\" || status === \"BLOCKED_BY_VERIFIER\")\n          },\n          editClaimed > 0 ? 5000 : 6500,\n        )\n        if (afterEdit) {\n          updateRow(reviewId, (nextRow) => mapDetailToRow(nextRow, afterEdit))\n          verified = afterEdit\n        }\n      }\n    }\n\n    if (!verified && !canSkipVerify) {\n      const verifyResult = await apiCall<ReviewMutationResponse>(`/api/reviews/${reviewId}/drafts/verify`, \"POST\")\n      if (applyDetailSnapshot(reviewId, verifyResult.review, updateRow)) {\n        verified = verifyResult.review ?? null\n      }\n\n      const verifyJobId = getJobId(verifyResult)\n      if (!verified && verifyJobId) {\n        await settleQueuedJob({\n          jobId: verifyJobId,\n          reviewId,\n          operation: \"verify\",\n          queuedMessage: \"Draft verification queued\",\n          successMessage: \"Draft verified\",\n          failureMessage: \"Draft verification failed.\",\n          onCompleted: async (reviewSnapshot) => {\n            verified = await syncRowFromSnapshotOrServer(reviewId, reviewSnapshot)\n            if (verified?.currentDraft?.status === \"BLOCKED_BY_VERIFIER\") {\n              throw new Error(getVerifierBlockedMessage(verified))\n            }\n          },\n        })\n      }\n\n      const verifyClaimed = Number(verifyResult?.worker?.claimed ?? 0)\n      if (!verified) {\n        verified = await waitForReviewState(\n          reviewId,\n          (detail) => {\n            const status = detail.currentDraft?.status\n            return status === \"READY\" || status === \"BLOCKED_BY_VERIFIER\"\n          },\n          verifyClaimed > 0 ? 5000 : 7000,\n        )\n      }\n    }\n\n    const verifiedDetail = verified ?? (canSkipVerify ? await syncRowFromServer(reviewId) : null)\n    if (!verifiedDetail) throw new Error(\"Verification is still processing. Please try publishing again in a few seconds.\")\n\n    updateRow(reviewId, (nextRow) => mapDetailToRow(nextRow, verifiedDetail))\n    if (verifiedDetail.currentDraft?.status !== \"READY\") {\n      throw new Error(getVerifierBlockedMessage(verifiedDetail))\n    }\n\n    const postResult = await apiCall<ReviewMutationResponse>(`/api/reviews/${reviewId}/reply/post`, \"POST\")\n    if (applyDetailSnapshot(reviewId, postResult.review, updateRow) && postResult.review?.reply.comment) {\n      toast.success(\"Reply published\")\n      void refresh()\n      return\n    }\n\n    const postJobId = getJobId(postResult)\n    if (postJobId) {\n      await settleQueuedJob({\n        jobId: postJobId,\n        reviewId,\n        operation: \"publish\",\n        queuedMessage: \"Reply posting queued\",\n        successMessage: \"Reply published\",\n        failureMessage: \"Reply posting failed.\",\n        onCompleted: async (reviewSnapshot) => {\n          const posted = await syncRowFromSnapshotOrServer(reviewId, reviewSnapshot)\n          if (!posted?.reply.comment) {\n            await Promise.resolve(refresh())\n            return\n          }\n          await Promise.resolve(refresh())\n        },\n      })\n      return\n    }\n\n    const postClaimed = Number(postResult?.worker?.claimed ?? 0)\n    const posted = await waitForReviewState(\n      reviewId,\n      (detail) => detail.reply.comment != null,\n      postClaimed > 0 ? 4500 : 7000,\n    )\n\n    if (posted) {\n      updateRow(reviewId, (nextRow) => mapDetailToRow(nextRow, posted))\n      toast.success(\"Reply published\")\n    } else {\n      toast.success(\"Reply posting queued\")\n    }\n\n    void refresh()\n  }, [getJobId, refresh, settleQueuedJob, syncRowFromServer, syncRowFromSnapshotOrServer, updateRow])\n\n  return {\n    generateDraft,\n    saveDraft,\n    verifyDraft,\n    publishReply,\n  }\n}\n"
    },
    {
      "path": "app/(app)/inbox/InboxClient.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/InboxClient.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { useSearchParams } from \"next/navigation\"\nimport { toast } from \"sonner\"\n\nimport { ErrorBoundary, ErrorState } from \"@/components/ErrorStates\"\nimport { NotificationProvider, useNotifications } from \"@/components/NotificationCenter\"\nimport { usePaginatedReviews, type ReviewFilter, type ReviewRow } from \"@/lib/hooks\"\n\nimport { InboxFilterBar } from \"./components/InboxFilterBar\"\nimport { InboxHeader, type InboxTab } from \"./components/InboxHeader\"\nimport { InboxReviewList } from \"./components/InboxReviewList\"\nimport { useReviewMutations } from \"./hooks/useReviewMutations\"\nimport { canBulkApprove, parseFilter, resolveRemoteFilter } from \"./model\"\nimport { apiCall } from \"./network\"\n\nimport type { InboxBootstrap } from \"./types\"\n\ntype BulkApproveResponse = {\n  acceptedCount?: number\n  jobIds?: string[]\n}\n\ntype InboxClientProps = {\n  ssrBootstrap: InboxBootstrap | null\n}\n\nfunction useDebouncedValue<T>(value: T, delayMs: number): T {\n  const [debounced, setDebounced] = React.useState(value)\n\n  React.useEffect(() => {\n    const timeout = window.setTimeout(() => {\n      setDebounced(value)\n    }, delayMs)\n\n    return () => {\n      window.clearTimeout(timeout)\n    }\n  }, [delayMs, value])\n\n  return debounced\n}\n\nfunction parseInitialTab(input: string | null, fallback: InboxTab): InboxTab {\n  if (input === \"pending\" || input === \"replied\" || input === \"all\") return input\n  return fallback\n}\n\nfunction parseInitialRating(input: string | null): string {\n  if (!input) return \"all\"\n  const numeric = Number(input)\n  if (!Number.isFinite(numeric) || numeric < 1 || numeric > 5) return \"all\"\n  return String(Math.floor(numeric))\n}\n\nfunction InboxErrorFallback({ error, reset }: { error: Error; reset: () => void }) {\n  return (\n    <ErrorState\n      error={error}\n      title=\"Inbox failed to render\"\n      description=\"A runtime error occurred while loading this page.\"\n      onRetry={reset}\n    />\n  )\n}\n\nexport default function InboxClient({ ssrBootstrap }: InboxClientProps) {\n  return (\n    <ErrorBoundary fallback={InboxErrorFallback}>\n      <NotificationProvider>\n        <InboxClientBody ssrBootstrap={ssrBootstrap} />\n      </NotificationProvider>\n    </ErrorBoundary>\n  )\n}\n\nfunction InboxClientBody({ ssrBootstrap }: InboxClientProps) {\n  const searchParams = useSearchParams()\n  const { addNotification } = useNotifications()\n\n  const initialParams = React.useMemo(() => {\n    const filter = parseFilter(searchParams.get(\"filter\"))\n    const tabFallback: InboxTab = filter === \"all\" ? \"all\" : \"pending\"\n    const tab = parseInitialTab(searchParams.get(\"tab\"), tabFallback)\n\n    return {\n      filter,\n      tab,\n      mention: searchParams.get(\"mention\")?.trim().toLowerCase() ?? \"\",\n      locationId: searchParams.get(\"locationId\")?.trim() ?? \"\",\n      rating: parseInitialRating(searchParams.get(\"rating\")),\n    }\n  }, [searchParams])\n\n  const [bootstrap, setBootstrap] = React.useState<InboxBootstrap | null>(ssrBootstrap)\n  const [bootstrapLoading, setBootstrapLoading] = React.useState(ssrBootstrap === null)\n\n  const [baseFilter, setBaseFilter] = React.useState<ReviewFilter>(initialParams.filter)\n  const [activeTab, setActiveTab] = React.useState<InboxTab>(initialParams.tab)\n  const [mentionFilter, setMentionFilter] = React.useState(initialParams.mention)\n  const [locationFilter, setLocationFilter] = React.useState(initialParams.locationId || \"all\")\n  const [ratingFilter, setRatingFilter] = React.useState(initialParams.rating)\n  const [search, setSearch] = React.useState(\"\")\n  const [activeReviewId, setActiveReviewId] = React.useState<string | null>(null)\n  const [quickApproveLoadingId, setQuickApproveLoadingId] = React.useState<string | null>(null)\n  const [bulkApproveLoading, setBulkApproveLoading] = React.useState(false)\n\n  const debouncedSearch = useDebouncedValue(search, 300)\n\n  React.useEffect(() => {\n    if (ssrBootstrap !== null) return\n\n    setBootstrapLoading(true)\n\n    void (async () => {\n      try {\n        const params = new URLSearchParams({\n          filter: resolveRemoteFilter(initialParams.filter, initialParams.tab),\n          status: initialParams.tab,\n          includeCounts: \"1\",\n        })\n\n        if (initialParams.filter === \"mentions\" && initialParams.mention) {\n          params.set(\"mention\", initialParams.mention)\n        }\n        if (initialParams.locationId) {\n          params.set(\"locationId\", initialParams.locationId)\n        }\n        if (initialParams.rating !== \"all\") {\n          params.set(\"rating\", initialParams.rating)\n        }\n\n        const nextBootstrap = await apiCall<InboxBootstrap>(`/api/inbox/bootstrap?${params.toString()}`, \"GET\")\n        setBootstrap(nextBootstrap)\n      } catch (error) {\n        toast.error(error instanceof Error ? error.message : \"Failed to load inbox bootstrap\")\n      } finally {\n        setBootstrapLoading(false)\n      }\n    })()\n  }, [initialParams, ssrBootstrap])\n\n  const mentionKeywords = React.useMemo(() => {\n    return Array.from(\n      new Set(\n        (bootstrap?.mentionKeywords ?? [])\n          .map((keyword) => keyword.trim().toLowerCase())\n          .filter(Boolean),\n      ),\n    )\n  }, [bootstrap?.mentionKeywords])\n\n  React.useEffect(() => {\n    if (mentionFilter.trim() || mentionKeywords.length === 0) return\n    setMentionFilter(mentionKeywords[0])\n  }, [mentionFilter, mentionKeywords])\n\n  React.useEffect(() => {\n    if (baseFilter !== \"mentions\") return\n    if (mentionKeywords.length > 0) return\n    setBaseFilter(\"unanswered\")\n  }, [baseFilter, mentionKeywords.length])\n\n  const normalizedMention = mentionFilter.trim().toLowerCase()\n  const effectiveFilter = baseFilter === \"mentions\" && normalizedMention.length === 0 ? \"all\" : baseFilter\n  const remoteFilter = resolveRemoteFilter(effectiveFilter, activeTab)\n  const remoteStatus = activeTab\n\n  const queryMention = effectiveFilter === \"mentions\" ? normalizedMention || undefined : undefined\n  const querySearch = debouncedSearch.trim() || undefined\n  const queryLocation = locationFilter === \"all\" ? undefined : locationFilter\n  const queryRating = ratingFilter === \"all\" ? undefined : Number(ratingFilter)\n\n  const { rows, counts, loading, loadingMore, error, hasMore, loadMore, refresh, updateRow } = usePaginatedReviews({\n    filter: remoteFilter,\n    status: remoteStatus,\n    mention: queryMention,\n    search: querySearch,\n    locationId: queryLocation,\n    rating: Number.isFinite(queryRating) ? queryRating : undefined,\n    enabled: !bootstrapLoading,\n    initialPage: bootstrap?.initialPage ?? null,\n  })\n\n  const handleQueuedJob = React.useCallback(\n    (event: { jobId: string; reviewId: string; operation: \"generate\" | \"verify\" | \"publish\" }) => {\n      const title =\n        event.operation === \"generate\"\n          ? \"Draft generation queued\"\n          : event.operation === \"verify\"\n            ? \"Verification queued\"\n            : \"Reply publish queued\"\n\n      addNotification({\n        type: \"loading\",\n        title,\n        message: \"Tracking background job in real time.\",\n        jobId: event.jobId,\n        action: {\n          label: \"Open review\",\n          onClick: () => {\n            setActiveReviewId(event.reviewId)\n          },\n        },\n      })\n    },\n    [addNotification],\n  )\n\n  const { generateDraft, saveDraft, verifyDraft, publishReply } = useReviewMutations({\n    rows,\n    updateRow,\n    refresh,\n    onQueuedJob: handleQueuedJob,\n  })\n\n  const handleGenerate = React.useCallback(\n    async (reviewId: string) => {\n      await generateDraft(reviewId)\n    },\n    [generateDraft],\n  )\n\n  const handleSave = React.useCallback(\n    async (reviewId: string, text: string, options?: { silent?: boolean }) => {\n      await saveDraft(reviewId, text, options)\n    },\n    [saveDraft],\n  )\n\n  const handleVerify = React.useCallback(\n    async (reviewId: string) => {\n      await verifyDraft(reviewId)\n    },\n    [verifyDraft],\n  )\n\n  const handlePublish = React.useCallback(\n    async (reviewId: string, text: string, row: ReviewRow) => {\n      await publishReply(reviewId, text, row)\n    },\n    [publishReply],\n  )\n\n  React.useEffect(() => {\n    if (!error) return\n    if (error === \"mention is required when filter=mentions.\") {\n      toast.error(\"Pick a mention keyword before using the mentions queue.\")\n      return\n    }\n    toast.error(error === \"SESSION_EXPIRED\" ? \"Session expired. Please sign in again.\" : error)\n  }, [error])\n\n  const pendingCount = React.useMemo(\n    () => counts?.unanswered ?? rows.filter((row) => row.status === \"pending\").length,\n    [counts?.unanswered, rows],\n  )\n  const eligibleBulkRows = React.useMemo(() => rows.filter((row) => canBulkApprove(row)), [rows])\n\n  const activeFiltersCount =\n    Number(search.trim().length > 0) +\n    Number(baseFilter !== \"unanswered\") +\n    Number(locationFilter !== \"all\") +\n    Number(ratingFilter !== \"all\")\n\n  const clearFilters = React.useCallback(() => {\n    setSearch(\"\")\n    setBaseFilter(\"unanswered\")\n    setLocationFilter(\"all\")\n    setRatingFilter(\"all\")\n    if (mentionKeywords.length > 0) {\n      setMentionFilter(mentionKeywords[0])\n    }\n  }, [mentionKeywords])\n\n  const openReview = React.useCallback((reviewId: string) => {\n    setActiveReviewId((prev) => (prev === reviewId ? null : reviewId))\n  }, [])\n\n  const handleRefresh = React.useCallback(() => {\n    void refresh()\n  }, [refresh])\n\n  const handleQuickApprove = React.useCallback(\n    async (reviewId: string) => {\n      const row = rows.find((item) => item.id === reviewId)\n      if (!row?.currentDraft?.text?.trim()) {\n        toast.error(\"No verified draft to publish for this review.\")\n        return\n      }\n\n      setQuickApproveLoadingId(reviewId)\n      try {\n        await publishReply(reviewId, row.currentDraft.text, row)\n      } catch (error) {\n        toast.error(error instanceof Error ? error.message : \"Quick approve failed\")\n      } finally {\n        setQuickApproveLoadingId(null)\n      }\n    },\n    [publishReply, rows],\n  )\n\n  const handleBulkApprove = React.useCallback(async () => {\n    if (!bootstrap?.bulkApproveEnabled) {\n      toast.error(\"Bulk approve is disabled in organization settings.\")\n      return\n    }\n    if (eligibleBulkRows.length === 0) {\n      toast.error(\"No eligible 5-star, ready-draft reviews found on this page.\")\n      return\n    }\n\n    setBulkApproveLoading(true)\n    try {\n      const response = await apiCall<BulkApproveResponse>(\"/api/replies/bulk-approve\", \"POST\", {\n        reviewIds: eligibleBulkRows.slice(0, 50).map((row) => row.id),\n      })\n\n      const acceptedCount = response.acceptedCount ?? eligibleBulkRows.length\n      toast.success(`${acceptedCount} ${acceptedCount === 1 ? \"reply\" : \"replies\"} queued`)\n\n      if (response.jobIds?.[0]) {\n        addNotification({\n          type: \"loading\",\n          title: \"Bulk publishing queued\",\n          message: `${acceptedCount} replies are processing in the background.`,\n          jobId: response.jobIds[0],\n        })\n      }\n\n      void refresh()\n    } catch (error) {\n      toast.error(error instanceof Error ? error.message : \"Bulk approve failed\")\n    } finally {\n      setBulkApproveLoading(false)\n    }\n  }, [addNotification, bootstrap?.bulkApproveEnabled, eligibleBulkRows, refresh])\n\n  const handleFilterChange = React.useCallback(\n    (next: ReviewFilter) => {\n      if (next === \"mentions\" && mentionKeywords.length === 0) {\n        toast.error(\"No mention keywords configured yet.\")\n        return\n      }\n      if ((next === \"unanswered\" || next === \"urgent\") && activeTab === \"replied\") {\n        setActiveTab(\"pending\")\n      }\n      setBaseFilter(next)\n    },\n    [activeTab, mentionKeywords.length],\n  )\n\n  const isFeedLoading = loading || bootstrapLoading\n\n  return (\n    <div className=\"relative min-h-full bg-shell text-shell-foreground font-sans selection:bg-brand/30\">\n      {/* Background Orbs */}\n      <div className=\"fixed top-[-10%] left-[-10%] h-[40%] w-[40%] rounded-full bg-brand/10 blur-[120px] pointer-events-none\" />\n      <div className=\"fixed bottom-[-10%] right-[-10%] h-[40%] w-[40%] rounded-full bg-success/5 blur-[120px] pointer-events-none\" />\n\n      <main className=\"relative z-10 flex flex-col min-h-full max-w-4xl mx-auto w-full\">\n        <InboxHeader\n          pendingCount={pendingCount}\n          tab={activeTab}\n          onTabChange={setActiveTab}\n          refreshing={isFeedLoading}\n          onRefresh={handleRefresh}\n        />\n\n        <InboxFilterBar\n          filter={baseFilter}\n          onFilterChange={handleFilterChange}\n          mentionFilter={mentionFilter}\n          onMentionFilterChange={setMentionFilter}\n          mentionKeywords={mentionKeywords}\n          locationFilter={locationFilter}\n          onLocationFilterChange={setLocationFilter}\n          locations={bootstrap?.locations ?? []}\n          ratingFilter={ratingFilter}\n          onRatingFilterChange={setRatingFilter}\n          activeFiltersCount={activeFiltersCount}\n          onReset={clearFilters}\n          onBulkApprove={handleBulkApprove}\n          bulkApproveCount={eligibleBulkRows.length}\n          bulkApproveLoading={bulkApproveLoading}\n          bulkApproveEnabled={Boolean(bootstrap?.bulkApproveEnabled)}\n        />\n\n        <div className=\"flex-1 pb-24\">\n          <InboxReviewList\n            activeTab={activeTab}\n            rows={rows}\n            activeReviewId={activeReviewId}\n            loading={isFeedLoading}\n            error={error}\n            hasMore={hasMore}\n            loadingMore={loadingMore}\n            showQuickApprove\n            quickApproveLoadingId={quickApproveLoadingId}\n            onOpenReview={openReview}\n            onQuickApprove={handleQuickApprove}\n            onGenerateDraft={handleGenerate}\n            onSaveDraft={handleSave}\n            onVerifyDraft={handleVerify}\n            onPublishReply={handlePublish}\n            onLoadMore={loadMore}\n            onRetry={handleRefresh}\n          />\n        </div>\n      </main>\n    </div>\n  )\n}\n"
    },
    {
      "path": "app/(app)/inbox/model.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/model.ts",
      "content": "import type { ReviewDetail, ReviewFilter, ReviewRow } from \"@/lib/hooks\"\nimport { mapReviewDetailToRow } from \"@/lib/reviews/detail-to-row\"\nimport { getFirstVerifierIssueMessage } from \"@/lib/reviews/verifier-result\"\n\nexport function parseFilter(input: string | null): ReviewFilter {\n  const value = (input ?? \"\").toLowerCase()\n  if (value === \"unanswered\" || value === \"urgent\" || value === \"five_star\" || value === \"mentions\" || value === \"all\") {\n    return value\n  }\n  return \"unanswered\"\n}\n\nexport function resolveRemoteFilter(baseFilter: ReviewFilter, tab: \"all\" | \"pending\" | \"replied\"): ReviewFilter {\n  if (tab === \"replied\") {\n    return baseFilter === \"unanswered\" || baseFilter === \"urgent\" ? \"all\" : baseFilter\n  }\n  if (tab === \"all\") {\n    return baseFilter === \"unanswered\" ? \"all\" : baseFilter\n  }\n  return baseFilter\n}\n\nexport function canBulkApprove(row: ReviewRow) {\n  return row.status === \"pending\" && row.starRating === 5 && row.draftStatus === \"READY\"\n}\n\nexport function initials(name: string) {\n  const parts = name.trim().split(/\\s+/).filter(Boolean)\n  const first = parts[0]?.[0] ?? \"?\"\n  const last = parts.length > 1 ? parts[parts.length - 1]?.[0] : \"\"\n  return (first + last).toUpperCase()\n}\n\nexport function mapDetailToRow(existing: ReviewRow, detail: ReviewDetail): ReviewRow {\n  return mapReviewDetailToRow(detail, existing)\n}\n\nexport function applyDetailSnapshot(\n  reviewId: string,\n  detail: ReviewDetail | null | undefined,\n  updateRow: (id: string, updater: (row: ReviewRow) => ReviewRow) => void,\n) {\n  if (!detail) return false\n  updateRow(reviewId, (row) => mapDetailToRow(row, detail))\n  return true\n}\n\nexport function getVerifierBlockedMessage(detail: ReviewDetail | null) {\n  const firstMessage = getFirstVerifierIssueMessage(detail?.currentDraft?.verifierResultJson ?? null)\n  return firstMessage ?? \"Draft was blocked by verifier. Please adjust and retry.\"\n}\n"
    },
    {
      "path": "app/(app)/inbox/network.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/app/(app)/inbox/network.ts",
      "content": "import { withIdempotencyHeader } from \"@/lib/api/client-idempotency\"\nimport { extractClientErrorMessage } from \"@/lib/api/client-error\"\n\nimport type { ReviewDetail } from \"@/lib/hooks\"\n\nconst JOB_POLL_BASE_MS = 900\nconst JOB_POLL_MAX_MS = 2600\nconst JOB_SSE_MIN_BUDGET_MS = 900\nconst JOB_SSE_MAX_BUDGET_MS = 12_000\nconst JOB_SSE_CLOSE_GRACE_MS = 1_250\nconst JOB_TERMINAL_CACHE_TTL_MS = 15_000\nconst JOB_TERMINAL_CACHE_MAX_ENTRIES = 512\nconst REVIEW_POLL_INTERVAL_MS = 650\n\ntype JobStatus = \"PENDING\" | \"RUNNING\" | \"RETRYING\" | \"COMPLETED\" | \"FAILED\" | \"CANCELLED\"\n\ntype JobDetail = {\n  id: string\n  type: string\n  status: JobStatus\n  attempts: number\n  maxAttempts: number\n  runAtIso: string\n  lockedAtIso: string | null\n  completedAtIso: string | null\n  lastError: string | null\n  retryAfterSec?: number | null\n}\n\ntype JobStatusResponse = {\n  job: JobDetail\n}\n\ntype JobStreamEvent = {\n  kind: \"snapshot\" | \"transition\" | \"terminal\"\n  job: JobDetail\n  review?: ReviewDetail | null\n}\n\ntype JobStreamTimeoutEvent = {\n  kind: \"timeout\"\n  job: JobDetail | null\n}\n\ntype TerminalJobCacheEntry = {\n  job: JobDetail\n  expiresAt: number\n}\n\nexport type JobCompletionResult = {\n  job: JobDetail\n  review: ReviewDetail | null\n}\n\nconst terminalJobCache = new Map<string, TerminalJobCacheEntry>()\nconst inflightJobDetailRequests = new Map<string, Promise<JobDetail | null>>()\nconst JOB_STATUS_VALUES = new Set<JobStatus>([\"PENDING\", \"RUNNING\", \"RETRYING\", \"COMPLETED\", \"FAILED\", \"CANCELLED\"])\n\nfunction sleep(ms: number) {\n  return new Promise((resolve) => setTimeout(resolve, ms))\n}\n\nfunction isTerminalJobStatus(status: JobStatus) {\n  return status === \"COMPLETED\" || status === \"FAILED\" || status === \"CANCELLED\"\n}\n\nfunction trimExpiredTerminalCache(now: number) {\n  for (const [key, value] of terminalJobCache.entries()) {\n    if (value.expiresAt <= now) {\n      terminalJobCache.delete(key)\n    }\n  }\n}\n\nfunction getCachedTerminalJob(jobId: string): JobDetail | null {\n  const now = Date.now()\n  const cached = terminalJobCache.get(jobId)\n  if (!cached) return null\n  if (cached.expiresAt <= now) {\n    terminalJobCache.delete(jobId)\n    return null\n  }\n  return cached.job\n}\n\nfunction cacheTerminalJob(job: JobDetail) {\n  if (!isTerminalJobStatus(job.status)) return\n\n  const now = Date.now()\n  trimExpiredTerminalCache(now)\n  terminalJobCache.set(job.id, { job, expiresAt: now + JOB_TERMINAL_CACHE_TTL_MS })\n  while (terminalJobCache.size > JOB_TERMINAL_CACHE_MAX_ENTRIES) {\n    const oldest = terminalJobCache.keys().next()\n    if (oldest.done) break\n    terminalJobCache.delete(oldest.value)\n  }\n}\n\nfunction resolveJobPollDelayMs(params: {\n  job: JobDetail | null\n  attempts: number\n  remainingMs: number\n}) {\n  const { job, attempts, remainingMs } = params\n  if (remainingMs <= 0) return 0\n\n  const retryAfterMs = Number(job?.retryAfterSec ?? 0) * 1000\n  if (Number.isFinite(retryAfterMs) && retryAfterMs > 0) {\n    return Math.min(remainingMs, Math.max(JOB_POLL_BASE_MS, Math.min(4_000, retryAfterMs)))\n  }\n\n  const status = job?.status\n  const computedDelay =\n    status === \"PENDING\"\n      ? JOB_POLL_BASE_MS + attempts * 260\n      : status === \"RUNNING\"\n        ? JOB_POLL_BASE_MS + attempts * 210\n        : status === \"RETRYING\"\n          ? JOB_POLL_BASE_MS + 450 + attempts * 320\n          : JOB_POLL_BASE_MS + attempts * 240\n\n  return Math.min(remainingMs, Math.max(JOB_POLL_BASE_MS, Math.min(JOB_POLL_MAX_MS, computedDelay)))\n}\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return typeof value === \"object\" && value !== null\n}\n\nfunction parseJobDetail(value: unknown): JobDetail | null {\n  if (!isRecord(value)) return null\n  const status = value.status\n  if (\n    typeof value.id !== \"string\" ||\n    typeof value.type !== \"string\" ||\n    typeof status !== \"string\" ||\n    !JOB_STATUS_VALUES.has(status as JobStatus)\n  ) {\n    return null\n  }\n  return value as JobDetail\n}\n\nfunction parseJobStreamEvent(data: string): JobStreamEvent | JobStreamTimeoutEvent | null {\n  try {\n    const raw = JSON.parse(data) as unknown\n    if (!isRecord(raw) || typeof raw.kind !== \"string\") return null\n\n    if (raw.kind === \"timeout\") {\n      const job = parseJobDetail(raw.job)\n      return { kind: \"timeout\", job }\n    }\n\n    if (raw.kind !== \"snapshot\" && raw.kind !== \"transition\" && raw.kind !== \"terminal\") {\n      return null\n    }\n\n    const job = parseJobDetail(raw.job)\n    if (!job) return null\n    const review = raw.review as ReviewDetail | null | undefined\n    return { kind: raw.kind, job, review }\n  } catch {\n    return null\n  }\n}\n\nfunction resolveSseBudgetMs(timeoutMs: number) {\n  if (timeoutMs <= 0) return 0\n  if (timeoutMs <= JOB_SSE_MIN_BUDGET_MS) return timeoutMs\n\n  const proportional = Math.floor(timeoutMs * 0.6)\n  return Math.min(timeoutMs, Math.max(JOB_SSE_MIN_BUDGET_MS, Math.min(JOB_SSE_MAX_BUDGET_MS, proportional)))\n}\n\nexport async function apiCall<T>(url: string, method: string, body?: unknown): Promise<T> {\n  const upper = method.toUpperCase()\n  const mutating = [\"POST\", \"PUT\", \"PATCH\", \"DELETE\"].includes(upper)\n  const baseHeaders = body ? { \"content-type\": \"application/json\" } : undefined\n  const headers = mutating ? withIdempotencyHeader(baseHeaders) : baseHeaders\n\n  const response = await fetch(url, {\n    method: upper,\n    headers,\n    body: body ? JSON.stringify(body) : undefined,\n  })\n\n  const data = await response.json().catch(() => null)\n  if (!response.ok) {\n    throw new Error(\n      extractClientErrorMessage({\n        body: data,\n        statusText: response.statusText,\n      }),\n    )\n  }\n\n  return data as T\n}\n\nexport async function fetchReviewDetail(reviewId: string): Promise<ReviewDetail | null> {\n  const response = await fetch(`/api/reviews/${reviewId}`)\n  if (!response.ok) return null\n  return (await response.json().catch(() => null)) as ReviewDetail | null\n}\n\nexport async function fetchJobDetail(jobId: string): Promise<JobDetail | null> {\n  const cached = getCachedTerminalJob(jobId)\n  if (cached) return cached\n\n  const inflight = inflightJobDetailRequests.get(jobId)\n  if (inflight) {\n    return inflight\n  }\n\n  const request = (async () => {\n    const response = await fetch(`/api/jobs/${jobId}`)\n    if (!response.ok) return null\n    const data = (await response.json().catch(() => null)) as JobStatusResponse | null\n    const job = data?.job ?? null\n    if (job) {\n      cacheTerminalJob(job)\n    }\n    return job\n  })()\n\n  inflightJobDetailRequests.set(jobId, request)\n  try {\n    return await request\n  } finally {\n    if (inflightJobDetailRequests.get(jobId) === request) {\n      inflightJobDetailRequests.delete(jobId)\n    }\n  }\n}\n\nasync function waitForJobCompletionViaSse(jobId: string, timeoutMs: number): Promise<JobCompletionResult | null> {\n  if (timeoutMs <= 0) return null\n  if (typeof window === \"undefined\" || typeof EventSource === \"undefined\") return null\n\n  const streamUrl = `/api/jobs/${encodeURIComponent(jobId)}/events?timeoutMs=${Math.floor(timeoutMs)}`\n\n  return new Promise<JobCompletionResult | null>((resolve) => {\n    const source = new EventSource(streamUrl)\n    let settled = false\n    let guardTimer: ReturnType<typeof globalThis.setTimeout> | null = null\n\n    const finish = (value: JobCompletionResult | null) => {\n      if (settled) return\n      settled = true\n      if (guardTimer != null) {\n        globalThis.clearTimeout(guardTimer)\n      }\n      source.close()\n      resolve(value)\n    }\n\n    const handleMessage = (data: string) => {\n      const parsed = parseJobStreamEvent(data)\n      if (!parsed) return\n\n      if (parsed.kind === \"timeout\") {\n        finish(null)\n        return\n      }\n\n      if (!isTerminalJobStatus(parsed.job.status)) {\n        return\n      }\n\n      cacheTerminalJob(parsed.job)\n      finish({\n        job: parsed.job,\n        review: parsed.review ?? null,\n      })\n    }\n\n    const onJob = (event: Event) => {\n      const message = event as MessageEvent<string>\n      handleMessage(message.data)\n    }\n\n    const onTimeout = (event: Event) => {\n      const message = event as MessageEvent<string>\n      const parsed = parseJobStreamEvent(message.data)\n      if (parsed?.kind === \"timeout\") {\n        if (parsed.job) {\n          cacheTerminalJob(parsed.job)\n        }\n        finish(null)\n        return\n      }\n      finish(null)\n    }\n\n    source.onmessage = onJob as (event: MessageEvent<string>) => void\n    source.addEventListener(\"job\", onJob)\n    source.addEventListener(\"timeout\", onTimeout)\n    source.onerror = () => {\n      finish(null)\n    }\n\n    guardTimer = globalThis.setTimeout(() => {\n      finish(null)\n    }, timeoutMs + JOB_SSE_CLOSE_GRACE_MS)\n  })\n}\n\nasync function waitForJobCompletionByPolling(jobId: string, timeoutMs: number): Promise<JobCompletionResult | null> {\n  if (timeoutMs <= 0) return null\n\n  const cached = getCachedTerminalJob(jobId)\n  if (cached) {\n    return { job: cached, review: null }\n  }\n\n  const startedAt = Date.now()\n  let attempts = 0\n\n  while (Date.now() - startedAt < timeoutMs) {\n    const job = await fetchJobDetail(jobId)\n    if (job && (job.status === \"COMPLETED\" || job.status === \"FAILED\" || job.status === \"CANCELLED\")) {\n      return { job, review: null }\n    }\n\n    const elapsedMs = Date.now() - startedAt\n    const remainingMs = timeoutMs - elapsedMs\n    const delayMs = resolveJobPollDelayMs({ job, attempts, remainingMs })\n    if (delayMs <= 0) break\n    await sleep(delayMs)\n    attempts += 1\n  }\n\n  return null\n}\n\nexport async function waitForJobCompletion(jobId: string, timeoutMs: number): Promise<JobCompletionResult | null> {\n  if (timeoutMs <= 0) return null\n\n  const cached = getCachedTerminalJob(jobId)\n  if (cached) {\n    return { job: cached, review: null }\n  }\n\n  const startedAt = Date.now()\n  const sseBudgetMs = resolveSseBudgetMs(timeoutMs)\n  if (sseBudgetMs > 0) {\n    const streamed = await waitForJobCompletionViaSse(jobId, sseBudgetMs)\n    if (streamed) {\n      return streamed\n    }\n  }\n\n  const elapsedMs = Date.now() - startedAt\n  const remainingMs = timeoutMs - elapsedMs\n  if (remainingMs <= 0) return null\n\n  return waitForJobCompletionByPolling(jobId, remainingMs)\n}\n\nexport async function waitForReviewState(\n  reviewId: string,\n  predicate: (detail: ReviewDetail) => boolean,\n  timeoutMs: number,\n) {\n  const startedAt = Date.now()\n\n  while (Date.now() - startedAt < timeoutMs) {\n    const detail = await fetchReviewDetail(reviewId)\n    if (detail && predicate(detail)) {\n      return detail\n    }\n    await sleep(REVIEW_POLL_INTERVAL_MS)\n  }\n\n  return null\n}\n"
    },
    {
      "path": "components/ErrorStates.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ErrorStates.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { motion } from \"framer-motion\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { AlertTriangle, ArrowLeft, RefreshCw, X } from \"@/components/icons\"\n\ntype ErrorBoundaryProps = {\n  children: React.ReactNode\n  fallback?: React.ComponentType<{ error: Error; reset: () => void }>\n  onError?: (error: Error, errorInfo: React.ErrorInfo) => void\n}\n\ntype ErrorBoundaryState = {\n  hasError: boolean\n  error: Error | null\n}\n\nexport class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props)\n    this.state = { hasError: false, error: null }\n  }\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { hasError: true, error }\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    console.error(\"ErrorBoundary caught:\", error, errorInfo)\n    this.props.onError?.(error, errorInfo)\n  }\n\n  reset = () => {\n    this.setState({ hasError: false, error: null })\n  }\n\n  render() {\n    if (this.state.hasError && this.state.error) {\n      const Fallback = this.props.fallback\n      if (Fallback) {\n        return <Fallback error={this.state.error} reset={this.reset} />\n      }\n      return <DefaultErrorFallback error={this.state.error} reset={this.reset} />\n    }\n\n    return this.props.children\n  }\n}\n\nfunction DefaultErrorFallback({ error, reset }: { error: Error; reset: () => void }) {\n  return (\n    <div className=\"flex min-h-[360px] items-center justify-center p-8\">\n      <motion.div\n        initial={{ opacity: 0, y: 16 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"max-w-md text-center\"\n      >\n        <div className=\"mb-6 flex justify-center\">\n          <div className=\"grid h-20 w-20 place-items-center rounded-full border border-destructive/20 bg-destructive/10\">\n            <X className=\"h-10 w-10 text-destructive\" />\n          </div>\n        </div>\n        <h2 className=\"mb-2 text-2xl font-black tracking-tight text-shell-foreground/90\">Something went wrong</h2>\n        <p className=\"mb-6 text-sm text-shell-foreground/50\">{error.message || \"An unexpected error occurred.\"}</p>\n        <div className=\"flex justify-center gap-3\">\n            <Button onClick={reset} variant=\"outline\" className=\"rounded-xl bg-shell-foreground/[0.05] border border-shell-foreground/[0.08] text-shell-foreground/70 hover:bg-shell-foreground/[0.08]\">\n              <RefreshCw className=\"mr-2 h-4 w-4\" />\n              Try Again\n            </Button>\n            <Button onClick={() => window.location.reload()} className=\"rounded-xl bg-brand text-brand-foreground hover:bg-brand-soft shadow-lg shadow-brand/20\">Reload</Button>\n          </div>\n        </motion.div>\n      </div>\n  )\n}\n\nexport function ErrorState({\n  error,\n  title = \"Something went wrong\",\n  description,\n  onRetry,\n  showBackButton = false,\n  className,\n}: {\n  error: string | Error\n  title?: string\n  description?: string\n  onRetry?: () => void\n  showBackButton?: boolean\n  className?: string\n}) {\n  const message = typeof error === \"string\" ? error : error.message\n  const normalized = message.toLowerCase()\n  const isSessionExpired = message === \"SESSION_EXPIRED\"\n  const isNotFound = normalized.includes(\"404\") || normalized.includes(\"not found\")\n  const isForbidden = normalized.includes(\"403\") || normalized.includes(\"forbidden\")\n\n  if (isSessionExpired) {\n    return <SessionExpiredError />\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 14 }}\n      animate={{ opacity: 1, y: 0 }}\n      className={cn(\"flex min-h-[280px] items-center justify-center p-8\", className)}\n    >\n      <div className=\"max-w-md text-center\">\n          <div className=\"mb-5 flex justify-center\">\n            <div className=\"grid h-16 w-16 place-items-center rounded-full border border-destructive/20 bg-destructive/10\">\n              <AlertTriangle className=\"h-8 w-8 text-destructive\" />\n            </div>\n          </div>\n        <h3 className=\"mb-2 text-xl font-black tracking-tight text-shell-foreground/90\">{title}</h3>\n        <p className=\"mb-1 text-sm text-shell-foreground/50\">{description || message}</p>\n        {isNotFound ? (\n          <p className=\"mt-2 text-xs text-shell-foreground/30\">The review could not be found in this organization.</p>\n        ) : null}\n        {isForbidden ? (\n          <p className=\"mt-2 text-xs text-shell-foreground/30\">You do not have permission for this action.</p>\n        ) : null}\n        <div className=\"mt-6 flex justify-center gap-3\">\n          {showBackButton ? (\n            <Button variant=\"outline\" onClick={() => window.history.back()} className=\"rounded-xl bg-shell-foreground/[0.05] border border-shell-foreground/[0.08] text-shell-foreground/70 hover:bg-shell-foreground/[0.08]\">\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\n              Go Back\n            </Button>\n          ) : null}\n          {onRetry ? (\n            <Button onClick={onRetry} className=\"rounded-xl bg-brand text-brand-foreground hover:bg-brand-soft shadow-lg shadow-brand/20\">\n              <RefreshCw className=\"mr-2 h-4 w-4\" />\n              Retry\n            </Button>\n          ) : null}\n        </div>\n      </div>\n    </motion.div>\n  )\n}\n\nfunction SessionExpiredError() {\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.97 }}\n      animate={{ opacity: 1, scale: 1 }}\n      className=\"flex min-h-[300px] items-center justify-center p-8\"\n    >\n      <div className=\"max-w-md text-center\">\n          <div className=\"mb-5 flex justify-center\">\n            <div className=\"grid h-16 w-16 place-items-center rounded-full border border-warning/20 bg-warning/10\">\n              <AlertTriangle className=\"h-8 w-8 text-warning-soft\" />\n            </div>\n          </div>\n        <h3 className=\"mb-2 text-xl font-black tracking-tight text-shell-foreground/90\">Session expired</h3>\n        <p className=\"mb-6 text-sm text-shell-foreground/50\">Please sign in again to continue.</p>\n        <Button\n          onClick={() => {\n            window.location.href = \"/signin\"\n          }}\n          className=\"rounded-xl bg-brand text-brand-foreground hover:bg-brand-soft shadow-lg shadow-brand/20\"\n        >\n          Sign In\n        </Button>\n      </div>\n    </motion.div>\n  )\n}\n\nexport function EmptyState({\n  icon: Icon = AlertTriangle,\n  title,\n  description,\n  action,\n  className,\n}: {\n  icon?: React.ComponentType<{ className?: string }>\n  title: string\n  description: string\n  action?: {\n    label: string\n    onClick: () => void\n  }\n  className?: string\n}) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 8 }}\n      animate={{ opacity: 1, y: 0 }}\n      className={cn(\"flex min-h-[280px] items-center justify-center p-8 text-center\", className)}\n    >\n      <div className=\"max-w-md\">\n          <div className=\"mb-5 flex justify-center\">\n            <div className=\"grid h-16 w-16 place-items-center rounded-full bg-shell-foreground/[0.05] border border-shell-foreground/[0.08]\">\n              <Icon className=\"h-8 w-8 text-shell-foreground/30\" />\n            </div>\n          </div>\n        <h3 className=\"mb-2 text-xl font-black tracking-tight text-shell-foreground/90\">{title}</h3>\n        <p className=\"mb-6 text-sm leading-relaxed text-shell-foreground/50\">{description}</p>\n        {action ? <Button onClick={action.onClick} className=\"rounded-xl bg-brand text-brand-foreground hover:bg-brand-soft shadow-lg shadow-brand/20\">{action.label}</Button> : null}\n      </div>\n    </motion.div>\n  )\n}\n\nexport function LoadingState({\n  message = \"Loading...\",\n  description,\n  className,\n}: {\n  message?: string\n  description?: string\n  className?: string\n}) {\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      className={cn(\"flex min-h-[260px] items-center justify-center p-8\", className)}\n    >\n      <div className=\"text-center\">\n        <motion.div\n          animate={{ rotate: 360 }}\n          transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}\n          className=\"mb-4 flex justify-center\"\n        >\n          <RefreshCw className=\"h-8 w-8 text-primary\" />\n        </motion.div>\n        <p className=\"text-sm font-semibold text-shell-foreground/80\">{message}</p>\n        {description ? <p className=\"mt-1 text-xs text-shell-foreground/40\">{description}</p> : null}\n      </div>\n    </motion.div>\n  )\n}\n\nexport function InlineError({\n  error,\n  className,\n}: {\n  error: string\n  className?: string\n}) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, height: 0 }}\n      animate={{ opacity: 1, height: \"auto\" }}\n      exit={{ opacity: 0, height: 0 }}\n      className={cn(\"flex items-center gap-2 text-sm text-destructive\", className)}\n    >\n      <AlertTriangle className=\"h-4 w-4\" />\n      <span>{error}</span>\n    </motion.div>\n  )\n}\n\nexport function NetworkError({ onRetry }: { onRetry: () => void }) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 14 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"flex min-h-[280px] items-center justify-center p-8\"\n    >\n      <div className=\"max-w-md text-center\">\n          <div className=\"mb-5 flex justify-center\">\n            <div className=\"grid h-16 w-16 place-items-center rounded-full border border-warning/20 bg-warning/10\">\n              <AlertTriangle className=\"h-8 w-8 text-warning-soft\" />\n            </div>\n          </div>\n        <h3 className=\"mb-2 text-xl font-black tracking-tight text-shell-foreground/90\">Connection problem</h3>\n        <p className=\"mb-6 text-sm text-shell-foreground/50\">We could not reach the server. Check your network and retry.</p>\n        <Button onClick={onRetry} className=\"rounded-xl bg-brand text-brand-foreground hover:bg-brand-soft shadow-lg shadow-brand/20\">\n          <RefreshCw className=\"mr-2 h-4 w-4\" />\n          Retry Connection\n        </Button>\n      </div>\n    </motion.div>\n  )\n}\n"
    },
    {
      "path": "components/icons.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/icons.ts",
      "content": "// Single source of truth for the app's icon library.\n// Preset: Remix icons (Radix Maia / Neutral / Amber / LTR).\n//\n// All app code should import icons from here, never directly from icon packages,\n// so we can swap libraries without touching the whole codebase.\n\nimport {\n  RiAddLine,\n  RiArrowDownLine,\n  RiArrowDownSLine,\n  RiArrowLeftLine,\n  RiArrowLeftSLine,\n  RiArrowRightLine,\n  RiArrowRightSLine,\n  RiArrowRightUpLine,\n  RiArrowUpLine,\n  RiArrowUpSLine,\n  RiBarChartLine,\n  RiBellLine,\n  RiCheckboxBlankCircleLine,\n  RiCheckboxCircleLine,\n  RiCheckLine,\n  RiCloseLine,\n  RiComputerLine,\n  RiDashboardLine,\n  RiDeleteBinLine,\n  RiEditLine,\n  RiErrorWarningLine,\n  RiExternalLinkLine,\n  RiEyeLine,\n  RiFileCopyLine,\n  RiFilter3Line,\n  RiFlashlightLine,\n  RiGlobalLine,\n  RiHistoryLine,\n  RiInboxLine,\n  RiLineChartLine,\n  RiLoader4Line,\n  RiLogoutBoxRLine,\n  RiMailLine,\n  RiMailOpenLine,\n  RiMapPinLine,\n  RiMenuLine,\n  RiMessage2Line,\n  RiMoonLine,\n  RiMoreLine,\n  RiPencilLine,\n  RiQuestionLine,\n  RiRefreshLine,\n  RiSaveLine,\n  RiSearchLine,\n  RiSendPlaneLine,\n  RiSettings3Line,\n  RiShieldCheckLine,\n  RiSparklingLine,\n  RiStarFill,\n  RiStarLine,\n  RiSunLine,\n  RiTeamLine,\n  RiThumbDownLine,\n  RiThumbUpLine,\n  RiTimeLine,\n  RiUserLine,\n} from \"@remixicon/react\"\n\nexport {\n  RiArrowLeftLine as ArrowLeft,\n  RiExternalLinkLine as ExternalLink,\n  RiRefreshLine as RefreshCw,\n  RiBellLine as Bell,\n  RiArrowDownSLine as ChevronDown,\n  RiArrowRightSLine as ChevronRight,\n  RiArrowUpSLine as ChevronUp,\n  RiCheckLine as Check,\n  RiCheckboxCircleLine as CheckCircle2,\n  RiCheckboxBlankCircleLine as Circle,\n  RiLoader4Line as Loader2,\n  RiTimeLine as Clock,\n  RiFileCopyLine as Copy,\n  RiMailLine as Mail,\n  RiSaveLine as Save,\n  RiSettings3Line as Settings,\n  RiComputerLine as Laptop,\n  RiFlashlightLine as Zap,\n  RiMenuLine as Menu,\n  RiSearchLine as Search,\n  RiMapPinLine as MapPin,\n  RiMessage2Line as MessageSquare,\n  RiMoonLine as Moon,\n  RiAddLine as Plus,\n  RiQuestionLine as CircleHelp,\n  RiQuestionLine as HelpCircle,\n  RiShieldCheckLine as ShieldCheck,\n  RiLogoutBoxRLine as LogOut,\n  RiSparklingLine as Sparkles,\n  RiStarFill as StarFilled,\n  RiStarLine as Star,\n  RiSunLine as Sun,\n  RiLineChartLine as TrendingUp,\n  RiUserLine as User,\n  RiTeamLine as Users,\n  RiErrorWarningLine as AlertTriangle,\n  RiCloseLine as X,\n  RiDeleteBinLine as Trash2,\n  RiArrowRightUpLine as ArrowUpRight,\n  RiThumbUpLine as ThumbsUp,\n  RiThumbDownLine as ThumbsDown,\n  RiHistoryLine as History,\n  RiBarChartLine as BarChart,\n  RiEyeLine as Eye,\n  RiPencilLine as Pencil,\n  RiFilter3Line as Filter,\n  RiArrowRightLine as ArrowRight,\n  RiArrowLeftSLine as ChevronLeft,\n  RiMoreLine as MoreHorizontal,\n  RiDashboardLine as LayoutDashboard,\n  RiMailOpenLine as Envelope,\n  RiEditLine as Edit,\n  RiSendPlaneLine as Send,\n  RiGlobalLine as Globe,\n  RiArrowUpLine as ArrowUp,\n  RiArrowDownLine as ArrowDown,\n  RiInboxLine as InboxIcon,\n}\n"
    },
    {
      "path": "components/JobTracker.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/JobTracker.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { AnimatePresence, motion } from \"framer-motion\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Progress } from \"@/components/ui/progress\"\nimport {\n  AlertTriangle,\n  CheckCircle2,\n  Clock,\n  RefreshCw,\n  X,\n} from \"@/components/icons\"\n\ntype JobStatus = \"PENDING\" | \"RUNNING\" | \"RETRYING\" | \"COMPLETED\" | \"FAILED\" | \"CANCELLED\"\n\ntype JobDetail = {\n  id: string\n  type: string\n  status: JobStatus\n  attempts: number\n  maxAttempts: number\n  lastError: string | null\n  retryAfterSec?: number | null\n}\n\ntype JobTrackerProps = {\n  jobId: string\n  onComplete?: (success: boolean) => void\n  onError?: (error: string) => void\n  showProgress?: boolean\n  inline?: boolean\n  autoClose?: boolean\n  autoCloseDelay?: number\n}\n\ntype StreamEvent =\n  | {\n      kind: \"snapshot\" | \"transition\" | \"terminal\"\n      job: JobDetail\n    }\n  | {\n      kind: \"timeout\"\n      job: JobDetail | null\n    }\n\nconst TERMINAL_STATES = new Set<JobStatus>([\"COMPLETED\", \"FAILED\", \"CANCELLED\"])\n\nfunction parseStreamEvent(raw: string): StreamEvent | null {\n  try {\n    const parsed = JSON.parse(raw) as unknown\n    if (!parsed || typeof parsed !== \"object\") return null\n    const payload = parsed as Record<string, unknown>\n    if (payload.kind === \"timeout\") {\n      const job = payload.job as JobDetail | null\n      return { kind: \"timeout\", job: job ?? null }\n    }\n    if (payload.kind === \"snapshot\" || payload.kind === \"transition\" || payload.kind === \"terminal\") {\n      return {\n        kind: payload.kind,\n        job: payload.job as JobDetail,\n      }\n    }\n    return null\n  } catch {\n    return null\n  }\n}\n\nfunction progressFromStatus(status: JobStatus) {\n  if (status === \"PENDING\") return 20\n  if (status === \"RUNNING\") return 55\n  if (status === \"RETRYING\") return 75\n  if (status === \"COMPLETED\") return 100\n  return 100\n}\n\nfunction progressVariant(status: JobStatus): \"default\" | \"success\" | \"warning\" | \"error\" {\n  if (status === \"COMPLETED\") return \"success\"\n  if (status === \"RETRYING\") return \"warning\"\n  if (status === \"FAILED\" || status === \"CANCELLED\") return \"error\"\n  return \"default\"\n}\n\nfunction statusText(status: JobStatus) {\n  if (status === \"PENDING\") return \"Queued\"\n  if (status === \"RUNNING\") return \"Processing\"\n  if (status === \"RETRYING\") return \"Retrying\"\n  if (status === \"COMPLETED\") return \"Completed\"\n  if (status === \"FAILED\") return \"Failed\"\n  return \"Cancelled\"\n}\n\nfunction formatJobType(type: string) {\n  return type\n    .split(\"_\")\n    .map((value) => value.slice(0, 1) + value.slice(1).toLowerCase())\n    .join(\" \")\n}\n\nfunction StatusIcon({ status, className }: { status: JobStatus; className?: string }) {\n  if (status === \"COMPLETED\") return <CheckCircle2 className={cn(\"text-success\", className)} />\n  if (status === \"FAILED\" || status === \"CANCELLED\") return <X className={cn(\"text-destructive\", className)} />\n  if (status === \"RETRYING\") return <AlertTriangle className={cn(\"text-warning\", className)} />\n  if (status === \"RUNNING\") {\n    return (\n      <motion.div animate={{ rotate: 360 }} transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}>\n        <RefreshCw className={cn(\"text-primary\", className)} />\n      </motion.div>\n    )\n  }\n  return <Clock className={cn(\"text-muted-foreground\", className)} />\n}\n\nexport function JobTracker({\n  jobId,\n  onComplete,\n  onError,\n  showProgress = true,\n  inline = false,\n  autoClose = true,\n  autoCloseDelay = 2400,\n}: JobTrackerProps) {\n  const [job, setJob] = React.useState<JobDetail | null>(null)\n  const [visible, setVisible] = React.useState(true)\n\n  React.useEffect(() => {\n    if (!jobId) return\n\n    let mounted = true\n    const source = new EventSource(`/api/jobs/${encodeURIComponent(jobId)}/events?timeoutMs=25000`)\n\n    const handleTerminal = (next: JobDetail) => {\n      const isSuccess = next.status === \"COMPLETED\"\n      if (isSuccess) {\n        onComplete?.(true)\n        if (autoClose) {\n          window.setTimeout(() => {\n            if (mounted) setVisible(false)\n          }, autoCloseDelay)\n        }\n      } else {\n        const errorMessage = next.lastError || \"Job failed\"\n        onError?.(errorMessage)\n        onComplete?.(false)\n      }\n    }\n\n    const onJobEvent = (event: Event) => {\n      const message = event as MessageEvent<string>\n      const parsed = parseStreamEvent(message.data)\n      if (!parsed || parsed.kind === \"timeout\") return\n      if (!mounted) return\n      setJob(parsed.job)\n      if (TERMINAL_STATES.has(parsed.job.status)) {\n        handleTerminal(parsed.job)\n      }\n    }\n\n    const onTimeoutEvent = (event: Event) => {\n      const message = event as MessageEvent<string>\n      const parsed = parseStreamEvent(message.data)\n      if (!mounted) return\n      if (parsed?.kind === \"timeout\" && parsed.job) {\n        setJob(parsed.job)\n      }\n      void pollJobUntilTerminal({\n        jobId,\n        setJob: (next) => mounted && setJob(next),\n        onComplete,\n        onError,\n      })\n    }\n\n    source.addEventListener(\"job\", onJobEvent)\n    source.addEventListener(\"timeout\", onTimeoutEvent)\n    source.onerror = () => {\n      source.close()\n      void pollJobUntilTerminal({\n        jobId,\n        setJob: (next) => mounted && setJob(next),\n        onComplete,\n        onError,\n      })\n    }\n\n    return () => {\n      mounted = false\n      source.close()\n    }\n  }, [autoClose, autoCloseDelay, jobId, onComplete, onError])\n\n  if (!visible) return null\n\n  const status = job?.status ?? \"PENDING\"\n  if (inline) {\n    return (\n      <span className=\"inline-flex items-center gap-1.5 text-xs text-muted-foreground\">\n        <StatusIcon status={status} className=\"h-3.5 w-3.5\" />\n        {statusText(status)}\n      </span>\n    )\n  }\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0, y: 8 }}\n        animate={{ opacity: 1, y: 0 }}\n        exit={{ opacity: 0, y: -8 }}\n        className=\"app-pane-card rounded-xl border-shell-foreground/10 bg-shell-foreground/10 p-3\"\n      >\n        <div className=\"flex items-start gap-2.5\">\n          <StatusIcon status={status} className=\"mt-0.5 h-4 w-4\" />\n          <div className=\"min-w-0 flex-1\">\n            <div className=\"flex items-center justify-between gap-2\">\n              <p className=\"truncate text-sm font-black tracking-tight text-foreground\">{statusText(status)}</p>\n              <Badge variant=\"outline\" className=\"rounded-md border-shell-foreground/10 bg-muted/30 px-1.5 text-[10px] font-black uppercase\">\n                {status}\n              </Badge>\n            </div>\n            {job?.type ? <p className=\"mt-0.5 text-xs text-muted-foreground\">{formatJobType(job.type)}</p> : null}\n            {showProgress ? (\n              <div className=\"mt-2\">\n                <Progress value={progressFromStatus(status)} variant={progressVariant(status)} />\n              </div>\n            ) : null}\n            {job?.lastError && (status === \"FAILED\" || status === \"CANCELLED\") ? (\n              <p className=\"mt-2 text-xs text-destructive\">{job.lastError}</p>\n            ) : null}\n            {job && job.attempts > 1 ? (\n              <p className=\"mt-1 text-xs text-muted-foreground\">\n                Attempt {job.attempts} of {job.maxAttempts}\n              </p>\n            ) : null}\n          </div>\n        </div>\n      </motion.div>\n    </AnimatePresence>\n  )\n}\n\nasync function pollJobUntilTerminal(input: {\n  jobId: string\n  setJob: (job: JobDetail) => void\n  onComplete?: (success: boolean) => void\n  onError?: (error: string) => void\n}) {\n  const { jobId, setJob, onComplete, onError } = input\n  let attempt = 0\n  const maxAttempts = 18\n\n  while (attempt < maxAttempts) {\n    const response = await fetch(`/api/jobs/${encodeURIComponent(jobId)}`)\n    if (!response.ok) return\n    const payload = (await response.json().catch(() => null)) as { job?: JobDetail } | null\n    const job = payload?.job\n    if (!job) return\n\n    setJob(job)\n    if (TERMINAL_STATES.has(job.status)) {\n      if (job.status === \"COMPLETED\") {\n        onComplete?.(true)\n      } else {\n        const errorMessage = job.lastError || \"Job failed\"\n        onError?.(errorMessage)\n        onComplete?.(false)\n      }\n      return\n    }\n\n    const delayMs = Math.max(900, Math.min(3200, Number(job.retryAfterSec ?? 0) * 1000 || 1400))\n    await new Promise((resolve) => setTimeout(resolve, delayMs))\n    attempt += 1\n  }\n}\n"
    },
    {
      "path": "components/NotificationCenter.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/NotificationCenter.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { AnimatePresence, motion } from \"framer-motion\"\n\nimport { cn } from \"@/lib/utils\"\nimport { JobTracker } from \"@/components/JobTracker\"\nimport { Button } from \"@/components/ui/button\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { Sheet, SheetContent, SheetTitle } from \"@/components/ui/sheet\"\nimport {\n  AlertTriangle,\n  Bell,\n  CheckCircle2,\n  CircleHelp,\n  RefreshCw,\n  X,\n} from \"@/components/icons\"\n\ntype NotificationType = \"success\" | \"error\" | \"warning\" | \"info\" | \"loading\"\n\ntype Notification = {\n  id: string\n  type: NotificationType\n  title: string\n  message?: string\n  timestamp: Date\n  jobId?: string\n  action?: {\n    label: string\n    onClick: () => void\n  }\n  dismissible?: boolean\n  autoClose?: boolean\n  duration?: number\n}\n\ntype NotificationContextValue = {\n  notifications: Notification[]\n  unreadCount: number\n  addNotification: (notification: Omit<Notification, \"id\" | \"timestamp\">) => string\n  removeNotification: (id: string) => void\n  clearAll: () => void\n}\n\nconst NotificationContext = React.createContext<NotificationContextValue | null>(null)\n\nexport function NotificationProvider({ children }: { children: React.ReactNode }) {\n  const [notifications, setNotifications] = React.useState<Notification[]>([])\n  const unreadCount = notifications.length\n\n  const removeNotification = React.useCallback((id: string) => {\n    setNotifications((previous) => previous.filter((item) => item.id !== id))\n  }, [])\n\n  const addNotification = React.useCallback((notification: Omit<Notification, \"id\" | \"timestamp\">) => {\n    const id = `notification-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`\n    const next: Notification = {\n      id,\n      timestamp: new Date(),\n      dismissible: true,\n      autoClose: notification.type === \"success\" || notification.type === \"info\",\n      duration: 4500,\n      ...notification,\n    }\n\n    setNotifications((previous) => [next, ...previous])\n\n    if (next.autoClose) {\n      window.setTimeout(() => {\n        removeNotification(id)\n      }, next.duration)\n    }\n\n    return id\n  }, [removeNotification])\n\n  const clearAll = React.useCallback(() => {\n    setNotifications([])\n  }, [])\n\n  return (\n    <NotificationContext.Provider\n      value={{\n        notifications,\n        unreadCount,\n        addNotification,\n        removeNotification,\n        clearAll,\n      }}\n    >\n      {children}\n    </NotificationContext.Provider>\n  )\n}\n\nexport function useNotifications() {\n  const context = React.useContext(NotificationContext)\n  if (!context) {\n    throw new Error(\"useNotifications must be used within NotificationProvider\")\n  }\n  return context\n}\n\nexport function NotificationCenter({ className }: { className?: string }) {\n  const [open, setOpen] = React.useState(false)\n  const { notifications, unreadCount, clearAll, removeNotification } = useNotifications()\n\n  React.useEffect(() => {\n    if (open && unreadCount > 0) {\n      // mark-as-read behavior: keep simple for now\n    }\n  }, [open, unreadCount])\n\n  return (\n    <>\n      <Button\n        variant=\"outline\"\n        size=\"icon\"\n        className={cn(\"app-action-secondary relative h-10 w-10 rounded-xl border-shell-foreground/10 bg-background/70\", className)}\n        onClick={() => setOpen(true)}\n        aria-label=\"Open notifications\"\n      >\n        <Bell className=\"h-4 w-4\" />\n        <AnimatePresence>\n          {unreadCount > 0 ? (\n            <motion.span\n              initial={{ scale: 0 }}\n              animate={{ scale: 1 }}\n              exit={{ scale: 0 }}\n              className=\"absolute -right-1 -top-1 grid h-5 min-w-5 place-items-center rounded-full bg-primary px-1 text-[10px] font-black text-primary-foreground\"\n            >\n              {unreadCount > 9 ? \"9+\" : unreadCount}\n            </motion.span>\n          ) : null}\n        </AnimatePresence>\n      </Button>\n\n      <Sheet open={open} onOpenChange={setOpen}>\n        <SheetContent side=\"right\" className=\"w-full border-shell-foreground/10 bg-shell-foreground/10 p-0 sm:max-w-md\">\n          <SheetTitle className=\"sr-only\">Notifications</SheetTitle>\n          <div className=\"flex h-full flex-col\">\n            <div className=\"flex items-center justify-between border-b border-shell-foreground/10 bg-muted/25 p-5\">\n              <div>\n                <h2 className=\"text-lg font-black tracking-tight\">Notifications</h2>\n                <p className=\"app-kicker mt-1\">\n                  {notifications.length} {notifications.length === 1 ? \"item\" : \"items\"}\n                </p>\n              </div>\n              {notifications.length > 0 ? (\n                <Button size=\"sm\" variant=\"ghost\" onClick={clearAll}>\n                  Clear all\n                </Button>\n              ) : null}\n            </div>\n\n            <ScrollArea className=\"flex-1\">\n              {notifications.length === 0 ? (\n                <div className=\"flex h-full flex-col items-center justify-center p-8 text-center\">\n                  <div className=\"mb-3 grid h-14 w-14 place-items-center rounded-full bg-muted/50\">\n                    <Bell className=\"h-6 w-6 text-muted-foreground/45\" />\n                  </div>\n                  <p className=\"text-sm font-semibold text-foreground\">No notifications yet</p>\n                  <p className=\"text-xs text-muted-foreground\">Background jobs and updates will appear here.</p>\n                </div>\n              ) : (\n                <div className=\"divide-y divide-border/60 p-1\">\n                  {notifications.map((notification) => (\n                    <NotificationItem\n                      key={notification.id}\n                      notification={notification}\n                      onDismiss={() => removeNotification(notification.id)}\n                    />\n                  ))}\n                </div>\n              )}\n            </ScrollArea>\n          </div>\n        </SheetContent>\n      </Sheet>\n    </>\n  )\n}\n\nfunction NotificationItem({\n  notification,\n  onDismiss,\n}: {\n  notification: Notification\n  onDismiss: () => void\n}) {\n  const color = colorForType(notification.type)\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, x: 14 }}\n      animate={{ opacity: 1, x: 0 }}\n      className=\"app-pane-card rounded-2xl border-shell-foreground/10 bg-shell-foreground/10 p-4\"\n    >\n      <div className=\"flex gap-3\">\n        <div className={cn(\"grid h-9 w-9 shrink-0 place-items-center rounded-2xl\", color.bg)}>\n          {notification.type === \"loading\" ? (\n            <motion.div animate={{ rotate: 360 }} transition={{ duration: 1, repeat: Infinity, ease: \"linear\" }}>\n              {renderNotificationIcon(notification.type, cn(\"h-4 w-4\", color.icon))}\n            </motion.div>\n          ) : (\n            renderNotificationIcon(notification.type, cn(\"h-4 w-4\", color.icon))\n          )}\n        </div>\n\n        <div className=\"min-w-0 flex-1\">\n          <div className=\"flex items-start justify-between gap-2\">\n              <p className=\"text-sm font-black tracking-tight text-foreground\">{notification.title}</p>\n              {notification.dismissible ? (\n                <Button variant=\"ghost\" size=\"icon\" className=\"app-action-secondary h-6 w-6 rounded-lg\" onClick={onDismiss}>\n                  <X className=\"h-3.5 w-3.5\" />\n                </Button>\n              ) : null}\n            </div>\n\n          {notification.message ? <p className=\"mt-0.5 text-xs text-muted-foreground\">{notification.message}</p> : null}\n\n          {notification.jobId ? (\n            <div className=\"mt-2\">\n              <JobTracker\n                jobId={notification.jobId}\n                inline\n                onComplete={(success) => {\n                  if (success) {\n                    onDismiss()\n                  }\n                }}\n              />\n            </div>\n          ) : null}\n\n            {notification.action ? (\n              <Button variant=\"outline\" size=\"sm\" className=\"app-action-secondary mt-2 h-7 rounded-lg border-shell-foreground/10 text-xs\" onClick={notification.action.onClick}>\n                {notification.action.label}\n              </Button>\n            ) : null}\n\n          <p className=\"mt-2 text-[10px] text-muted-foreground\">{formatTimestamp(notification.timestamp)}</p>\n        </div>\n      </div>\n    </motion.div>\n  )\n}\n\nfunction renderNotificationIcon(type: NotificationType, className: string) {\n  if (type === \"success\") return <CheckCircle2 className={className} />\n  if (type === \"error\") return <X className={className} />\n  if (type === \"warning\") return <AlertTriangle className={className} />\n  if (type === \"loading\") return <RefreshCw className={className} />\n  return <CircleHelp className={className} />\n}\n\nfunction colorForType(type: NotificationType) {\n  if (type === \"success\") return { bg: \"bg-success/10\", icon: \"text-success\" }\n  if (type === \"error\") return { bg: \"bg-destructive/10\", icon: \"text-destructive\" }\n  if (type === \"warning\") return { bg: \"bg-warning/10\", icon: \"text-warning\" }\n  if (type === \"loading\") return { bg: \"bg-primary/10\", icon: \"text-primary\" }\n  return { bg: \"bg-muted\", icon: \"text-muted-foreground\" }\n}\n\nfunction formatTimestamp(date: Date) {\n  const now = Date.now()\n  const diffMs = now - date.getTime()\n  const minutes = Math.floor(diffMs / 60_000)\n  if (minutes < 1) return \"Just now\"\n  if (minutes < 60) return `${minutes}m ago`\n  const hours = Math.floor(minutes / 60)\n  if (hours < 24) return `${hours}h ago`\n  const days = Math.floor(hours / 24)\n  return `${days}d ago`\n}\n"
    },
    {
      "path": "components/ReviewCard.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ReviewCard.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport {\n  CheckCircle2,\n  CornerDownRight,\n  Loader2,\n  MapPin,\n  MessageSquare,\n  MoreHorizontal,\n  RefreshCw,\n  Send,\n  ShieldCheck,\n  Sparkles,\n  Star,\n  ThumbsUp,\n  X,\n} from \"lucide-react\"\nimport { toast } from \"sonner\"\n\nimport { Badge } from \"@/components/ui/badge\"\nimport { Button } from \"@/components/ui/button\"\nimport { Checkbox } from \"@/components/ui/checkbox\"\nimport { Textarea } from \"@/components/ui/textarea\"\nimport { formatAge, type ReviewRow } from \"@/lib/hooks\"\nimport { cn } from \"@/lib/utils\"\n\ntype ReviewBadgeVariant = \"default\" | \"ai\" | \"success\" | \"warning\"\nconst REVIEW_BADGE_CLASSNAMES: Record<ReviewBadgeVariant, string> = {\n  default: \"border-shell-foreground/10 bg-shell-foreground/5 text-shell-foreground/40\",\n  ai: \"border-brand/20 bg-brand/10 text-brand-muted\",\n  success: \"border-success/20 bg-success/10 text-success-soft\",\n  warning: \"border-warning/20 bg-warning/10 text-warning-soft\",\n}\n\nfunction draftStatusLabel(status: ReviewRow[\"draftStatus\"] | null) {\n  if (status === \"READY\") return \"AI Draft Ready\"\n  if (status === \"NEEDS_APPROVAL\") return \"Review Required\"\n  if (status === \"BLOCKED_BY_VERIFIER\") return \"Needs Edits\"\n  if (status === \"POSTED\") return \"Posted\"\n  if (status === \"POST_FAILED\") return \"Post Failed\"\n  return \"Not Started\"\n}\n\nfunction draftStatusVariant(status: ReviewRow[\"draftStatus\"] | null): ReviewBadgeVariant {\n  if (status === \"READY\" || status === \"NEEDS_APPROVAL\") return \"ai\"\n  if (status === \"POSTED\") return \"success\"\n  if (status === \"BLOCKED_BY_VERIFIER\" || status === \"POST_FAILED\") return \"warning\"\n  return \"default\"\n}\n\nfunction reviewBadgeClass(variant: ReviewBadgeVariant) {\n  return cn(\n    \"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-[10px] font-bold uppercase tracking-wider\",\n    REVIEW_BADGE_CLASSNAMES[variant],\n  )\n}\n\nfunction StarRating({ rating }: { rating: number }) {\n  return (\n    <div className=\"flex gap-0.5\" role=\"img\" aria-label={`${rating} out of 5 stars`}>\n      {Array.from({ length: 5 }, (_, index) => (\n        <Star\n          key={`${rating}-${String(index)}`}\n          className={cn(\n            \"h-3.5 w-3.5 transition-colors\",\n            index < rating ? \"fill-warning-soft text-warning-soft\" : \"fill-shell-foreground/5 text-shell-foreground/10\",\n          )}\n        />\n      ))}\n    </div>\n  )\n}\n\ntype ReviewCardProps = {\n  reviewId: string\n  row: ReviewRow\n  showCheckbox: boolean\n  checked: boolean\n  onCheckedChange: (reviewId: string, val: boolean) => void\n  onOpen: (reviewId: string) => void\n  selected: boolean\n  showQuickApprove?: boolean\n  onQuickApprove?: (reviewId: string) => void\n  quickApproveLoading?: boolean\n  onGenerateDraft?: (reviewId: string) => Promise<void>\n  onSaveDraft?: (reviewId: string, text: string, options?: { silent?: boolean }) => Promise<void>\n  onVerifyDraft?: (reviewId: string) => Promise<void>\n  onPublishReply?: (reviewId: string, text: string, row: ReviewRow) => Promise<void>\n}\n\nexport const ReviewCard = React.memo(function ReviewCard({\n  reviewId,\n  row,\n  showCheckbox,\n  checked,\n  onCheckedChange,\n  onOpen,\n  selected,\n  showQuickApprove,\n  onQuickApprove,\n  quickApproveLoading,\n  onGenerateDraft,\n  onSaveDraft,\n  onVerifyDraft,\n  onPublishReply,\n}: ReviewCardProps) {\n  const reviewText = row.comment.trim() || row.snippet.trim()\n  const createdAge = formatAge(row.createTimeIso)\n  const draftStatus = row.currentDraft?.status ?? row.draftStatus\n  const hasReply = Boolean(row.reply.comment?.trim())\n  const canQuickApprove = row.status === \"pending\" && row.draftStatus === \"READY\"\n  const showDraftCta = draftStatus === \"READY\"\n\n  const [isReplying, setIsReplying] = React.useState(false)\n  const [draftInput, setDraftInput] = React.useState(row.currentDraft?.text ?? \"\")\n  const [busy, setBusy] = React.useState<\"generate\" | \"verify\" | \"publish\" | null>(null)\n  const [saveState, setSaveState] = React.useState<\"idle\" | \"saving\" | \"saved\">(\"idle\")\n  const saveTimerRef = React.useRef<ReturnType<typeof setTimeout> | null>(null)\n  const saveFeedbackTimerRef = React.useRef<ReturnType<typeof setTimeout> | null>(null)\n  const lastPersistedRef = React.useRef(row.currentDraft?.text ?? \"\")\n\n  React.useEffect(() => {\n    const nextDraft = row.currentDraft?.text ?? \"\"\n    setDraftInput(nextDraft)\n    lastPersistedRef.current = nextDraft\n    setSaveState(\"idle\")\n  }, [row.id, row.currentDraft?.text])\n\n  React.useEffect(() => {\n    if (!isReplying || !onSaveDraft) return\n    if (busy !== null) return\n\n    const trimmed = draftInput.trim()\n    const lastPersisted = lastPersistedRef.current.trim()\n    if (!trimmed || trimmed === lastPersisted) return\n\n    if (saveTimerRef.current) clearTimeout(saveTimerRef.current)\n    saveTimerRef.current = setTimeout(() => {\n      setSaveState(\"saving\")\n      void onSaveDraft(reviewId, draftInput, { silent: true })\n        .then(() => {\n          lastPersistedRef.current = draftInput\n          setSaveState(\"saved\")\n          if (saveFeedbackTimerRef.current) clearTimeout(saveFeedbackTimerRef.current)\n          saveFeedbackTimerRef.current = setTimeout(() => {\n            setSaveState(\"idle\")\n          }, 1400)\n        })\n        .catch(() => {\n          setSaveState(\"idle\")\n        })\n    }, 900)\n\n    return () => {\n      if (saveTimerRef.current) {\n        clearTimeout(saveTimerRef.current)\n        saveTimerRef.current = null\n      }\n    }\n  }, [busy, draftInput, isReplying, onSaveDraft, reviewId])\n\n  React.useEffect(() => {\n    return () => {\n      if (saveTimerRef.current) clearTimeout(saveTimerRef.current)\n      if (saveFeedbackTimerRef.current) clearTimeout(saveFeedbackTimerRef.current)\n    }\n  }, [])\n\n  const runAction = React.useCallback(async (action: \"generate\" | \"verify\" | \"publish\", work: () => Promise<void>) => {\n    setBusy(action)\n    try {\n      await work()\n    } catch (error) {\n      toast.error(error instanceof Error ? error.message : \"Action failed\")\n    } finally {\n      setBusy(null)\n    }\n  }, [])\n\n  const openReplyEditor = React.useCallback(() => {\n    setIsReplying(true)\n    onOpen(reviewId)\n  }, [onOpen, reviewId])\n\n  const handleQuickAction = React.useCallback(() => {\n    if (canQuickApprove) {\n      onQuickApprove?.(reviewId)\n      return\n    }\n    onOpen(reviewId)\n  }, [canQuickApprove, onOpen, onQuickApprove, reviewId])\n\n  const hasDraftInput = draftInput.trim().length > 0\n\n  const initials = (row.reviewer.displayName ?? \"A\")\n    .split(\" \")\n    .map((word) => word[0])\n    .slice(0, 2)\n    .join(\"\")\n    .toUpperCase()\n\n  return (\n    <article\n      className={cn(\n        \"group relative flex flex-col gap-4 rounded-3xl border p-4 transition-all duration-300 sm:p-5\",\n        \"border-shell-foreground/5 bg-shell-foreground/5 backdrop-blur-md\",\n        \"hover:border-shell-foreground/10 hover:bg-shell-foreground/5\",\n        selected ? \"border-brand/30 bg-shell-foreground/10 ring-2 ring-brand/50\" : \"shadow-xl shadow-shell/20\",\n      )}\n    >\n      <div className=\"flex items-start justify-between gap-3 sm:gap-4\">\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          onClick={() => onOpen(reviewId)}\n          className=\"h-auto min-w-0 flex-1 justify-start gap-3 rounded-none p-0 text-left hover:bg-transparent\"\n          aria-label={`Open review by ${row.reviewer.displayName ?? \"Anonymous\"}`}\n        >\n          <div className=\"flex h-10 w-10 shrink-0 items-center justify-center rounded-2xl border border-shell-foreground/5 bg-gradient-to-br from-muted to-card text-sm font-bold text-shell-foreground/80 shadow-inner transition-transform group-hover:scale-105 sm:h-11 sm:w-11\">\n            {initials}\n          </div>\n          <div className=\"min-w-0\">\n            <div className=\"flex items-center gap-2\">\n              <h3 className=\"truncate text-sm font-semibold text-shell-foreground/90\">{row.reviewer.displayName ?? \"Anonymous User\"}</h3>\n              {row.reviewer.isAnonymous ? <Badge className={reviewBadgeClass(\"default\")}>Anon</Badge> : null}\n            </div>\n            <div className=\"mt-0.5 flex flex-wrap items-center gap-2 text-[11px] text-shell-foreground/30\">\n              <span>{createdAge} ago</span>\n              <span className=\"h-0.5 w-0.5 rounded-full bg-shell-foreground/20\" />\n              <span className=\"flex min-w-0 items-center gap-1\">\n                <MapPin className=\"h-2.5 w-2.5\" />\n                <span className=\"truncate\">{row.location.displayName}</span>\n              </span>\n            </div>\n          </div>\n        </Button>\n\n        <div className=\"flex shrink-0 items-center gap-1\">\n          {showCheckbox ? (\n            <Checkbox\n              checked={checked}\n              onCheckedChange={(value) => onCheckedChange(reviewId, Boolean(value))}\n              className=\"h-4 w-4 border-shell-foreground/20\"\n            />\n          ) : null}\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => onOpen(reviewId)}\n            className=\"h-8 w-8 rounded-lg text-shell-foreground/30 transition-all hover:bg-shell-foreground/5 hover:text-shell-foreground\"\n            aria-label={`More actions for ${row.reviewer.displayName ?? \"anonymous reviewer\"}`}\n          >\n            <MoreHorizontal className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"space-y-3\">\n        <StarRating rating={row.starRating} />\n        <p className=\"text-[13px] font-medium leading-relaxed text-shell-foreground/70 sm:text-[14px]\">\n          {reviewText ? (\n            reviewText\n          ) : (\n            <span className=\"text-xs font-normal italic text-shell-foreground/20\">No written content provided</span>\n          )}\n        </p>\n      </div>\n\n      {!isReplying && !hasReply ? (\n        <div className=\"flex flex-wrap items-center justify-between gap-3 pt-1\">\n          <div className=\"flex flex-wrap items-center gap-2\">\n            <Button\n              type=\"button\"\n              size=\"sm\"\n              onClick={openReplyEditor}\n              className=\"group/btn h-auto gap-2 rounded-xl bg-brand px-4 py-2 text-xs font-bold text-brand-foreground shadow-lg shadow-brand/20 transition-all hover:bg-brand-soft active:scale-95\"\n            >\n              <MessageSquare className=\"h-3.5 w-3.5 transition-transform group-hover/btn:-translate-y-0.5\" />\n              Reply\n            </Button>\n\n            {showDraftCta ? (\n              <Button\n                type=\"button\"\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={openReplyEditor}\n                className=\"h-auto rounded-xl border-brand/20 bg-brand/10 px-4 py-2 text-xs font-bold text-brand-muted transition-all hover:bg-brand/20\"\n              >\n                <Sparkles className=\"h-3.5 w-3.5 text-brand-muted\" />\n                Review AI Draft\n              </Button>\n            ) : draftStatus ? (\n              <Badge className={reviewBadgeClass(draftStatusVariant(draftStatus))}>\n                <Sparkles className=\"h-3 w-3\" />\n                {draftStatusLabel(draftStatus)}\n              </Badge>\n            ) : null}\n          </div>\n\n          {showQuickApprove ? (\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"icon\"\n              disabled={quickApproveLoading}\n              onClick={handleQuickAction}\n              className={cn(\n                \"h-9 w-9 rounded-xl border bg-shell-foreground/5 transition-all\",\n                canQuickApprove\n                  ? \"border-brand/25 text-brand-muted hover:bg-brand/20 hover:text-brand/80\"\n                  : \"border-shell-foreground/5 text-shell-foreground/20 hover:bg-shell-foreground/10 hover:text-shell-foreground/60\",\n                quickApproveLoading && \"opacity-60\",\n              )}\n              aria-label={canQuickApprove ? \"Quick approve review reply\" : \"Open review details\"}\n            >\n              {quickApproveLoading ? <RefreshCw className=\"h-3.5 w-3.5 animate-spin\" /> : <ThumbsUp className=\"h-3.5 w-3.5\" />}\n            </Button>\n          ) : null}\n        </div>\n      ) : null}\n\n      {hasReply && row.reply.comment ? (\n        <div className=\"relative mt-1 overflow-hidden rounded-2xl border border-shell-foreground/5 bg-shell-foreground/5 p-4\">\n          <div className=\"mb-2 flex items-center gap-2\">\n            <div className=\"flex h-5 w-5 items-center justify-center rounded-md bg-brand/20 text-brand-muted\">\n              <CornerDownRight className=\"h-3 w-3\" />\n            </div>\n            <span className=\"text-[10px] font-bold uppercase tracking-widest text-shell-foreground/40\">Our Response</span>\n            <div className=\"ml-auto\">\n              <Badge className={reviewBadgeClass(\"success\")}>\n                <CheckCircle2 className=\"h-3 w-3\" />\n                Posted\n              </Badge>\n            </div>\n          </div>\n          <p className=\"text-[13px] italic leading-relaxed text-shell-foreground/50\">&ldquo;{row.reply.comment}&rdquo;</p>\n        </div>\n      ) : null}\n\n      {isReplying ? (\n        <div className=\"mt-1 space-y-3 animate-in fade-in slide-in-from-top-2 duration-300\">\n          <div className=\"group/textarea relative overflow-hidden rounded-2xl border border-shell-foreground/10 bg-shell/40 shadow-inner transition-colors focus-within:border-brand/50\">\n            <Textarea\n              autoFocus\n              value={draftInput}\n              onChange={(event) => setDraftInput(event.target.value)}\n              placeholder=\"Write your public reply...\"\n              className=\"min-h-[140px] w-full resize-none border-0 bg-transparent p-4 text-sm text-shell-foreground placeholder:text-shell-foreground/20 shadow-none focus-visible:ring-0\"\n            />\n\n            <div className=\"flex flex-wrap items-center justify-between gap-2 border-t border-shell-foreground/5 bg-shell-foreground/[0.02] px-3 py-2\">\n              <div className=\"flex flex-wrap gap-1.5\">\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => {\n                    if (!onGenerateDraft) return\n                    void runAction(\"generate\", async () => {\n                      await onGenerateDraft(reviewId)\n                    })\n                  }}\n                  disabled={busy === \"generate\" || !onGenerateDraft}\n                  className=\"h-auto gap-1.5 rounded-lg px-2 py-1.5 text-[11px] font-bold text-shell-foreground/40 transition-all hover:bg-shell-foreground/5 hover:text-shell-foreground/80 disabled:opacity-50\"\n                >\n                  {busy === \"generate\" ? <RefreshCw className=\"h-3 w-3 animate-spin\" /> : <Sparkles className=\"h-3 w-3 text-brand-muted\" />}\n                  Regenerate\n                </Button>\n\n                <Button\n                  type=\"button\"\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={() => {\n                    if (!onVerifyDraft) return\n                    void runAction(\"verify\", async () => {\n                      await onVerifyDraft(reviewId)\n                    })\n                  }}\n                  disabled={busy === \"verify\" || !hasDraftInput || !onVerifyDraft}\n                  className=\"h-auto gap-1.5 rounded-lg px-2 py-1.5 text-[11px] font-bold text-shell-foreground/40 transition-all hover:bg-shell-foreground/5 hover:text-shell-foreground/80 disabled:opacity-50\"\n                >\n                  {busy === \"verify\" ? <Loader2 className=\"h-3 w-3 animate-spin\" /> : <ShieldCheck className=\"h-3 w-3\" />}\n                  Verify Quality\n                </Button>\n              </div>\n\n              <div className=\"text-[10px] italic text-shell-foreground/20\">\n                {saveState === \"saving\" ? \"Syncing...\" : \"Changes saved locally\"}\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex flex-wrap items-center gap-2 sm:gap-3\">\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setIsReplying(false)}\n              className=\"h-auto gap-2 rounded-xl px-4 py-2.5 text-xs font-bold text-shell-foreground/40 transition-all hover:bg-shell-foreground/5 hover:text-shell-foreground/80\"\n            >\n              <X className=\"h-3.5 w-3.5\" />\n              Cancel\n            </Button>\n\n            <div className=\"ml-auto w-full sm:w-auto\">\n              <Button\n                type=\"button\"\n                onClick={() => {\n                  if (!onPublishReply) return\n                  void runAction(\"publish\", async () => {\n                    await onPublishReply(reviewId, draftInput, row)\n                  })\n                }}\n                disabled={busy === \"publish\" || !hasDraftInput || !onPublishReply}\n                className=\"flex h-10 w-full items-center justify-center gap-2 rounded-xl bg-foreground px-5 py-2.5 text-xs font-bold text-background shadow-lg shadow-shell-foreground/5 transition-all hover:bg-foreground/90 active:scale-95 disabled:opacity-50 sm:w-auto\"\n              >\n                {busy === \"publish\" ? <Loader2 className=\"h-3.5 w-3.5 animate-spin\" /> : <Send className=\"h-3.5 w-3.5\" />}\n                Publish Reply\n              </Button>\n            </div>\n          </div>\n        </div>\n      ) : null}\n    </article>\n  )\n})\n\nReviewCard.displayName = \"ReviewCard\"\n"
    },
    {
      "path": "components/ui/badge.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/badge.tsx",
      "content": "import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-[10px] font-bold uppercase tracking-widest transition-colors focus-ring\",\n  {\n    variants: {\n      variant: {\n        default: \"border-brand/35 bg-brand text-brand-foreground\",\n        secondary: \"border-shell-foreground/10 bg-shell-foreground/5 text-shell-foreground/70\",\n        destructive: \"border-destructive/35 bg-destructive text-destructive-foreground\",\n        outline: \"border-shell-foreground/10 text-shell-foreground/85\",\n        success:\n          \"border-state-ready-border bg-state-ready-bg text-state-ready-fg\",\n        warning:\n          \"border-state-pending-border bg-state-pending-bg text-state-pending-fg\",\n        info:\n          \"border-state-posted-border bg-state-posted-bg text-state-posted-fg\",\n        pending:\n          \"border-state-needs-edit-border bg-state-needs-edit-bg text-state-needs-edit-fg\",\n        error:\n          \"border-state-error-border bg-state-error-bg text-state-error-fg\",\n        blocked:\n          \"border-state-blocked-border bg-state-blocked-bg text-state-blocked-fg\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport type BadgeProps = React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof badgeVariants>\n\nexport function Badge({ className, variant, ...props }: BadgeProps) {\n  return <div className={cn(badgeVariants({ variant }), className)} {...props} />\n}\n\nexport { badgeVariants }\n"
    },
    {
      "path": "components/ui/button.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/button.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-bold transition-all duration-300 ease-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/30 focus-visible:ring-offset-2 ring-offset-shell disabled:pointer-events-none disabled:opacity-50 active:scale-95\",\n  {\n    variants: {\n      variant: {\n        default: \"border border-brand/35 bg-brand text-brand-foreground shadow-glow-primary hover:bg-brand-soft\",\n        secondary: \"border border-shell-foreground/10 bg-shell-foreground/5 text-shell-foreground/85 hover:bg-shell-foreground/10\",\n        destructive: \"border border-destructive/35 bg-destructive text-destructive-foreground shadow-lg shadow-destructive/20 hover:bg-destructive/90\",\n        outline: \"border border-shell-foreground/10 bg-shell/40 text-shell-foreground/85 shadow-inner hover:bg-shell-foreground/10\",\n        ghost: \"text-shell-foreground/75 hover:bg-shell-foreground/10 hover:text-shell-foreground/90\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 px-3\",\n        lg: \"h-11 px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport type ButtonProps = React.ButtonHTMLAttributes<HTMLButtonElement> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }\n\nexport const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size }), className)}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { buttonVariants }\n"
    },
    {
      "path": "components/ui/checkbox.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/checkbox.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"@/components/icons\"\nimport { cn } from \"@/lib/utils\"\n\nexport const Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator className=\"flex items-center justify-center text-current\">\n      <Check className=\"h-3.5 w-3.5\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = \"Checkbox\"\n"
    },
    {
      "path": "components/ui/progress.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/progress.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { motion } from \"framer-motion\"\n\nimport { cn } from \"@/lib/utils\"\n\ntype ProgressVariant = \"default\" | \"success\" | \"warning\" | \"error\"\n\nconst BAR_VARIANT_CLASS: Record<ProgressVariant, string> = {\n  default: \"bg-primary\",\n  success: \"bg-success\",\n  warning: \"bg-warning\",\n  error: \"bg-destructive\",\n}\n\nexport function Progress({\n  value = 0,\n  className,\n  indicatorClassName,\n  animated = true,\n  variant = \"default\",\n  ...props\n}: React.HTMLAttributes<HTMLDivElement> & {\n  value?: number\n  indicatorClassName?: string\n  animated?: boolean\n  variant?: ProgressVariant\n}) {\n  const clamped = Number.isFinite(value) ? Math.max(0, Math.min(100, value)) : 0\n\n  return (\n    <div\n      role=\"progressbar\"\n      aria-valuenow={Math.round(clamped)}\n      aria-valuemin={0}\n      aria-valuemax={100}\n      className={cn(\"relative h-2 w-full overflow-hidden rounded-full bg-shell-foreground/10\", className)}\n      {...props}\n    >\n      <div\n        className={cn(\n          \"h-full transition-[width]\",\n          BAR_VARIANT_CLASS[variant],\n          animated ? \"duration-300 ease-out\" : \"duration-0\",\n          indicatorClassName,\n        )}\n        style={{ width: `${clamped}%` }}\n      />\n    </div>\n  )\n}\n\nexport function CircularProgress({\n  value = 0,\n  size = 96,\n  strokeWidth = 8,\n  className,\n  showValue = true,\n}: {\n  value?: number\n  size?: number\n  strokeWidth?: number\n  className?: string\n  showValue?: boolean\n}) {\n  const clamped = Number.isFinite(value) ? Math.max(0, Math.min(100, value)) : 0\n  const radius = (size - strokeWidth) / 2\n  const circumference = radius * 2 * Math.PI\n  const offset = circumference - (clamped / 100) * circumference\n\n  return (\n    <div className={cn(\"relative\", className)} style={{ width: size, height: size }}>\n      <svg className=\"-rotate-90 transform\" width={size} height={size}>\n        <circle\n          className=\"text-muted\"\n          strokeWidth={strokeWidth}\n          stroke=\"currentColor\"\n          fill=\"transparent\"\n          r={radius}\n          cx={size / 2}\n          cy={size / 2}\n        />\n        <motion.circle\n          className=\"text-primary\"\n          strokeWidth={strokeWidth}\n          strokeDasharray={circumference}\n          strokeDashoffset={offset}\n          strokeLinecap=\"round\"\n          stroke=\"currentColor\"\n          fill=\"transparent\"\n          r={radius}\n          cx={size / 2}\n          cy={size / 2}\n          initial={{ strokeDashoffset: circumference }}\n          animate={{ strokeDashoffset: offset }}\n          transition={{ duration: 0.35, ease: \"easeOut\" }}\n        />\n      </svg>\n      {showValue ? (\n        <div className=\"absolute inset-0 grid place-items-center\">\n          <span className=\"text-xl font-black tabular-nums\">{Math.round(clamped)}%</span>\n        </div>\n      ) : null}\n    </div>\n  )\n}\n\nexport function IndeterminateProgress({ className }: { className?: string }) {\n  return (\n    <div className={cn(\"relative h-2 w-full overflow-hidden rounded-full bg-shell-foreground/10\", className)}>\n      <motion.div\n        className=\"absolute h-full w-1/3 bg-primary\"\n        animate={{ x: [\"-100%\", \"400%\"] }}\n        transition={{ duration: 1.4, repeat: Infinity, ease: \"linear\" }}\n      />\n    </div>\n  )\n}\n\nexport function Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return <div className={cn(\"animate-pulse rounded-md bg-shell-foreground/10\", className)} {...props} />\n}\n\nexport function SkeletonCard() {\n  return (\n    <div className=\"app-pane-card space-y-3 rounded-2xl border-shell-foreground/10 p-4\">\n      <div className=\"flex items-center gap-3\">\n        <Skeleton className=\"h-10 w-10 rounded-full\" />\n        <div className=\"flex-1 space-y-2\">\n          <Skeleton className=\"h-4 w-32\" />\n          <Skeleton className=\"h-3 w-20\" />\n        </div>\n      </div>\n      <Skeleton className=\"h-16 w-full\" />\n      <div className=\"flex gap-2\">\n        <Skeleton className=\"h-6 w-16\" />\n        <Skeleton className=\"h-6 w-20\" />\n      </div>\n    </div>\n  )\n}\n\nexport function SkeletonList({ count = 4 }: { count?: number }) {\n  return (\n    <div className=\"space-y-3\">\n      {Array.from({ length: count }, (_, index) => (\n        <SkeletonCard key={index} />\n      ))}\n    </div>\n  )\n}\n"
    },
    {
      "path": "components/ui/scroll-area.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/scroll-area.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\nimport { cn } from \"@/lib/utils\"\n\nexport const ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root ref={ref} className={cn(\"relative overflow-hidden\", className)} {...props}>\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = \"ScrollArea\"\n\nexport const ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Scrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Scrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.Scrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" && \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" && \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Thumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.Scrollbar>\n))\nScrollBar.displayName = \"ScrollBar\"\n"
    },
    {
      "path": "components/ui/select.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/select.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"@/components/icons\"\nimport { cn } from \"@/lib/utils\"\n\nexport const Select = SelectPrimitive.Root\nexport const SelectGroup = SelectPrimitive.Group\nexport const SelectValue = SelectPrimitive.Value\n\nexport const SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"app-input-surface flex h-10 w-full items-center justify-between rounded-xl px-3 py-2 text-sm font-medium ring-offset-shell focus:outline-none focus:ring-2 focus:ring-brand/30 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = \"SelectTrigger\"\n\nexport const SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\"flex cursor-default items-center justify-center py-1\", className)}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = \"SelectScrollUpButton\"\n\nexport const SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\"flex cursor-default items-center justify-center py-1\", className)}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName = \"SelectScrollDownButton\"\n\nexport const SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      position={position}\n      className={cn(\n        \"app-surface-shell relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-2xl p-1 text-shell-foreground/85 shadow-floating\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n        \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n        \"data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className,\n      )}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\",\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = \"SelectContent\"\n\nexport const SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label ref={ref} className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)} {...props} />\n))\nSelectLabel.displayName = \"SelectLabel\"\n\nexport const SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-lg py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-shell-foreground/10 focus:text-shell-foreground/90 data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = \"SelectItem\"\n\nexport const SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator ref={ref} className={cn(\"-mx-1 my-1 h-px bg-shell-foreground/10\", className)} {...props} />\n))\nSelectSeparator.displayName = \"SelectSeparator\"\n"
    },
    {
      "path": "components/ui/separator.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/separator.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\nimport { cn } from \"@/lib/utils\"\n\nexport const Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(({ className, orientation = \"horizontal\", decorative = true, ...props }, ref) => (\n  <SeparatorPrimitive.Root\n    ref={ref}\n    decorative={decorative}\n    orientation={orientation}\n    className={cn(\n      \"shrink-0 bg-border\",\n      orientation === \"horizontal\" ? \"h-px w-full\" : \"h-full w-px\",\n      className\n    )}\n    {...props}\n  />\n))\nSeparator.displayName = \"Separator\"\n"
    },
    {
      "path": "components/ui/sheet.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/sheet.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"@/components/icons\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"@/lib/utils\"\n\nexport const Sheet = DialogPrimitive.Root\nexport const SheetTrigger = DialogPrimitive.Trigger\nexport const SheetClose = DialogPrimitive.Close\nexport const SheetPortal = DialogPrimitive.Portal\n\nexport const SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-shell/40 backdrop-blur-sm\",\n      \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n      \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className,\n    )}\n    {...props}\n  />\n))\nSheetOverlay.displayName = \"SheetOverlay\"\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-google-lg transition ease-in-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left:\n          \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  },\n)\n\nexport interface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nexport const SheetContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        sheetVariants({ side }),\n        \"data-[state=open]:duration-500 data-[state=closed]:duration-300\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out\",\n        \"data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n        side === \"bottom\" ? \"rounded-t-2xl\" : \"rounded-none\",\n        className,\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = \"SheetContent\"\n\nexport function SheetHeader({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {\n  return <div className={cn(\"flex flex-col space-y-2 text-center sm:text-left\", className)} {...props} />\n}\n\nexport function SheetFooter({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {\n  return <div className={cn(\"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\", className)} {...props} />\n}\n\nexport const SheetTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title ref={ref} className={cn(\"text-lg font-semibold leading-none tracking-tight\", className)} {...props} />\n))\nSheetTitle.displayName = \"SheetTitle\"\n\nexport const SheetDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description ref={ref} className={cn(\"text-sm text-muted-foreground\", className)} {...props} />\n))\nSheetDescription.displayName = \"SheetDescription\"\n"
    },
    {
      "path": "components/ui/tabs.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/tabs.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\nimport { cn } from \"@/lib/utils\"\n\nexport const Tabs = TabsPrimitive.Root\n\nexport const TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-xl border border-shell-foreground/10 bg-shell-foreground/5 p-1 text-shell-foreground/70\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = \"TabsList\"\n\nexport const TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-lg px-3 py-1.5 text-sm font-semibold ring-offset-shell transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/30 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:border data-[state=active]:border-shell-foreground/10 data-[state=active]:bg-shell-foreground/10 data-[state=active]:text-shell-foreground/90 data-[state=active]:shadow-google-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = \"TabsTrigger\"\n\nexport const TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      \"data-[state=active]:animate-in data-[state=active]:fade-in-0 data-[state=active]:slide-in-from-bottom-1\",\n      className,\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = \"TabsContent\"\n"
    },
    {
      "path": "components/ui/textarea.tsx",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/components/ui/textarea.tsx",
      "content": "import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nexport type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>\n\nexport const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"app-input-surface flex min-h-[80px] w-full rounded-2xl px-3 py-2 text-sm font-medium ring-offset-shell focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/30 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n"
    },
    {
      "path": "lib/ai/draft.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/ai/draft.ts",
      "content": "import { z } from \"zod\"\n\nexport const evidenceSnapshotSchema = z.object({\n  starRating: z.number().int().min(1).max(5),\n  comment: z.string().nullable(),\n  reviewerDisplayName: z.string().nullable(),\n  reviewerIsAnonymous: z.boolean(),\n  locationDisplayName: z.string(),\n  createTime: z.string(),\n  highlights: z.array(\n    z.object({\n      start: z.number().int().min(0),\n      end: z.number().int().min(0),\n      label: z.string(),\n    }),\n  ),\n  mentionKeywords: z.array(z.string()),\n  seoProfile: z.object({\n    primaryKeywords: z.array(z.string()),\n    secondaryKeywords: z.array(z.string()),\n    geoTerms: z.array(z.string()),\n  }),\n  tone: z.object({\n    preset: z.string(),\n    customInstructions: z.string().nullable(),\n  }),\n})\n\nexport type EvidenceSnapshot = z.infer<typeof evidenceSnapshotSchema>\n\nexport const verifierViolationSchema = z.object({\n  code: z.string().min(1),\n  message: z.string().min(1),\n  snippet: z.string().optional(),\n})\n\nexport type VerifierViolation = z.infer<typeof verifierViolationSchema>\n\nexport const llmVerifierResultSchema = z.object({\n  pass: z.boolean(),\n  violations: z.array(verifierViolationSchema),\n  suggestedRewrite: z.union([z.string(), z.null()]).optional(),\n})\n\nexport type LlmVerifierResult = {\n  pass: boolean\n  violations: VerifierViolation[]\n  suggestedRewrite?: string\n}\n\nexport function normalizeLlmVerifierResult(\n  input: z.infer<typeof llmVerifierResultSchema>,\n): LlmVerifierResult {\n  return {\n    pass: input.pass,\n    violations: input.violations,\n    suggestedRewrite: input.suggestedRewrite ?? undefined,\n  }\n}\n\nexport function areDraftTextsEquivalent(previousDraftText: string, nextDraftText: string) {\n  return normalizeDraftForComparison(previousDraftText) === normalizeDraftForComparison(nextDraftText)\n}\n\nfunction normalizeDraftForComparison(text: string) {\n  return text\n    .toLowerCase()\n    .replace(/[^a-z0-9\\s]/g, \"\")\n    .replace(/\\s+/g, \" \")\n    .trim()\n}\n"
    },
    {
      "path": "lib/api/client-error.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/api/client-error.ts",
      "content": "type ClientErrorPayload = {\n  message?: unknown\n  error?: unknown\n}\n\nfunction toRecord(value: unknown): Record<string, unknown> | null {\n  if (typeof value !== \"object\" || value === null) return null\n  return value as Record<string, unknown>\n}\n\nfunction toNonEmptyString(value: unknown): string | null {\n  if (typeof value !== \"string\") return null\n  const trimmed = value.trim()\n  return trimmed.length > 0 ? trimmed : null\n}\n\nexport function extractClientErrorMessage(params: {\n  body: unknown\n  statusText: string\n  fallback?: string\n}) {\n  const { body, statusText, fallback = \"Request failed\" } = params\n  const payload = toRecord(body) as ClientErrorPayload | null\n\n  const message = toNonEmptyString(payload?.message)\n  if (message) return message\n\n  const error = toNonEmptyString(payload?.error)\n  if (error) return error\n\n  return toNonEmptyString(statusText) ?? fallback\n}\n"
    },
    {
      "path": "lib/api/client-idempotency.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/api/client-idempotency.ts",
      "content": "const UUID_V4_REGEX =\n  /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i\n\nfunction bytesToUuid(bytes: Uint8Array): string {\n  const hex = Array.from(bytes, (b) => b.toString(16).padStart(2, \"0\")).join(\"\")\n  return `${hex.slice(0, 8)}-${hex.slice(8, 12)}-${hex.slice(12, 16)}-${hex.slice(16, 20)}-${hex.slice(20, 32)}`\n}\n\nfunction randomBytes(): Uint8Array {\n  const bytes = new Uint8Array(16)\n  const cryptoApi = globalThis.crypto\n\n  if (cryptoApi?.getRandomValues) {\n    cryptoApi.getRandomValues(bytes)\n    return bytes\n  }\n\n  for (let i = 0; i < bytes.length; i += 1) {\n    bytes[i] = Math.floor(Math.random() * 256)\n  }\n  return bytes\n}\n\nfunction normalizeUuidV4(bytes: Uint8Array): Uint8Array {\n  const out = new Uint8Array(bytes)\n  // RFC 4122 version field\n  out[6] = (out[6] & 0x0f) | 0x40\n  // RFC 4122 variant field\n  out[8] = (out[8] & 0x3f) | 0x80\n  return out\n}\n\nexport function createIdempotencyKey(): string {\n  const candidate = globalThis.crypto?.randomUUID?.()\n  if (candidate && UUID_V4_REGEX.test(candidate)) {\n    return candidate\n  }\n  return bytesToUuid(normalizeUuidV4(randomBytes()))\n}\n\nexport function withIdempotencyHeader(headers?: HeadersInit): Headers {\n  const next = new Headers(headers)\n  if (!next.has(\"Idempotency-Key\")) {\n    next.set(\"Idempotency-Key\", createIdempotencyKey())\n  }\n  return next\n}\n"
    },
    {
      "path": "lib/design-system/inbox-theme.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/design-system/inbox-theme.ts",
      "content": "/**\n * inbox-theme.ts — Inbox-specific class recipe layer.\n *\n * This module extends the shared PAGE_THEME with inbox-specific contracts.\n * Import PAGE_THEME for shared patterns, INBOX_THEME_CLASSES for inbox-only.\n *\n * Re-exports PAGE_THEME and helpers for convenience so inbox pages\n * can import everything from one place.\n */\n\nexport { PAGE_THEME, filterPillClass, statusClass } from \"./page-theme\"\nexport type { StatusVariant } from \"./page-theme\"\n\nexport const INBOX_THEME_CLASSES = {\n  frame:\n    \"relative flex h-full min-h-0 overflow-hidden bg-shell text-shell-foreground font-sans selection:bg-brand/30\",\n  workspace:\n    \"relative flex min-h-0 flex-1 overflow-hidden\",\n\n  feedPane:\n    \"min-h-0 flex-1 flex flex-col overflow-hidden\",\n  feedListSection: \"relative flex h-full min-h-0 flex-col\",\n  feedListInner: \"space-y-4 px-4 py-4 sm:space-y-6 sm:px-6 sm:py-6 lg:px-12 lg:py-8\",\n  detailPane:\n    \"min-h-0 flex-1 border-l border-shell-foreground/10 bg-shell-foreground/5 backdrop-blur-xl\",\n\n  headerSection:\n    \"relative px-6 py-6 lg:px-12 lg:pt-12 lg:pb-8\",\n  headerAccentRail:\n    \"hidden\",\n  headerPendingPill:\n    \"inline-flex min-w-6 items-center justify-center rounded-full border border-shell-foreground/10 bg-shell-foreground/5 px-2.5 py-0.5 type-kicker tabular-nums text-shell-foreground/70\",\n  iconButton:\n    \"h-10 w-10 rounded-xl border border-shell-foreground/10 bg-shell-foreground/5 text-shell-foreground/70 motion-all motion-slow hover:bg-shell-foreground/10 hover:text-shell-foreground/90 active:scale-95\",\n  searchInput:\n    \"h-11 rounded-2xl border-shell-foreground/10 bg-shell-foreground/5 pl-10 type-body text-shell-foreground/90 placeholder:text-shell-foreground/40 motion-all motion-slow focus-visible:border-brand/40 focus-visible:ring-2 focus-visible:ring-brand/20\",\n  segmented: \"flex items-center gap-2 overflow-x-auto pb-2\",\n  segmentedButton: \"whitespace-nowrap rounded-full border px-5 py-2 type-kicker transition-all\",\n  segmentedButtonActive:\n    \"border-shell-foreground/15 bg-shell-foreground/10 text-shell-foreground/90\",\n  segmentedButtonIdle: \"border-shell-foreground/10 bg-shell-foreground/5 text-shell-foreground/70 hover:bg-shell-foreground/10\",\n\n  statusPending:\n    \"rounded-full border border-warning/30 bg-warning/15 px-2.5 py-0.5 type-kicker text-warning-soft\",\n  statusReplied:\n    \"rounded-full border border-success/30 bg-success/15 px-2.5 py-0.5 type-kicker text-success-soft\",\n  draftBadge:\n    \"inline-flex items-center gap-1 rounded-full border border-brand/30 bg-brand/15 px-2.5 py-0.5 type-kicker text-brand-muted\",\n  quickApproveEnabled:\n    \"border-brand/35 bg-brand text-brand-foreground shadow-lg shadow-brand/20 hover:bg-brand-soft\",\n  quickApproveIdle:\n    \"border-shell-foreground/10 bg-shell-foreground/5 text-shell-foreground/70 hover:bg-shell-foreground/10\",\n\n  detailLocationChip:\n    \"inline-flex items-center gap-1.5 rounded-full border border-shell-foreground/10 bg-shell-foreground/5 px-3 py-1 type-kicker text-shell-foreground/70\",\n  detailBackButton:\n    \"mb-4 h-9 rounded-full border border-shell-foreground/10 bg-shell-foreground/5 px-3 text-shell-foreground/70 motion-all motion-slow hover:bg-shell-foreground/10 hover:text-shell-foreground/90\",\n\n  actionIslandWrap:\n    \"pointer-events-none absolute inset-x-3 bottom-4 z-30 pb-[calc(env(safe-area-inset-bottom)+2px)] md:inset-x-8\",\n  actionIsland:\n    \"pointer-events-auto rounded-[24px] border border-shell-foreground/10 bg-shell-foreground/5 p-4 text-shell-foreground/90 shadow-2xl backdrop-blur-xl\",\n  islandSecondary:\n    \"h-10 rounded-xl border border-shell-foreground/10 bg-shell-foreground/5 px-3 type-kicker tracking-wider text-shell-foreground/80 motion-all motion-slow hover:bg-shell-foreground/10 active:scale-95\",\n  islandPrimary:\n    \"h-11 rounded-2xl bg-brand px-5 text-[13px] font-bold text-brand-foreground shadow-lg shadow-brand/20 motion-all motion-slow hover:bg-brand-soft active:scale-[0.97]\",\n  islandSuccess: \"flex items-center justify-center gap-2 text-success-soft\",\n\n  filterSection:\n    \"border-t border-shell-foreground/10 bg-transparent px-6 pb-4 pt-3 lg:px-12\",\n  filterToggle:\n    \"inline-flex h-8 items-center gap-1.5 rounded-full border px-3 type-kicker motion-all motion-slow active:scale-95\",\n  filterToggleActive:\n    \"border-brand/30 bg-brand/15 text-brand-muted\",\n  filterToggleIdle:\n    \"border-shell-foreground/10 bg-shell-foreground/5 text-shell-foreground/70 hover:bg-shell-foreground/10\",\n  filterActivePill:\n    \"inline-flex h-8 items-center gap-1 rounded-full border border-brand/30 bg-brand/15 px-2.5 type-kicker text-brand-muted\",\n  filterSelectTrigger:\n    \"h-9 min-w-[110px] rounded-full border-shell-foreground/10 bg-shell-foreground/5 px-3 text-[11px] font-medium text-shell-foreground/70\",\n  filterResetButton:\n    \"shrink-0 rounded-full border border-shell-foreground/10 bg-shell-foreground/5 px-3 py-1.5 type-kicker text-shell-foreground/70 motion-all motion-slow hover:bg-shell-foreground/10 hover:text-shell-foreground/90\",\n  bulkApproveActive:\n    \"h-9 rounded-full border border-brand/35 bg-brand px-4 type-kicker text-brand-foreground shadow-lg shadow-brand/20 motion-all motion-slow hover:bg-brand-soft\",\n  bulkApproveIdle:\n    \"h-9 rounded-full border border-shell-foreground/10 bg-shell-foreground/5 px-4 type-kicker text-shell-foreground/70 motion-all motion-slow hover:bg-shell-foreground/10\",\n\n  listLoadMoreButton:\n    \"h-10 w-full rounded-full border border-shell-foreground/10 bg-shell-foreground/5 type-kicker text-shell-foreground/70 motion-all motion-slow hover:bg-shell-foreground/10 hover:text-shell-foreground/90\",\n} as const\n\nexport const INBOX_PAGE_THEME_CLASSES = {\n  page: \"app-container space-y-8 py-4 sm:py-6 lg:py-10\",\n  hero: \"flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between\",\n  heroLead: \"flex items-center gap-5\",\n  heroIcon:\n    \"flex h-14 w-14 items-center justify-center rounded-2xl border border-shell-foreground/10 bg-shell-foreground/5 text-brand-muted shadow-floating\",\n  heroTitle:\n    \"bg-gradient-to-b from-shell-foreground to-shell-foreground/60 bg-clip-text text-2xl font-black tracking-tight text-transparent md:text-3xl\",\n  heroKicker: \"type-kicker text-shell-foreground/40\",\n  tabList:\n    \"inline-flex h-12 w-full items-center justify-start gap-1 overflow-x-auto rounded-2xl border border-shell-foreground/10 bg-shell-foreground/5 p-1.5 sm:w-auto\",\n  tabTrigger:\n    \"h-9 shrink-0 rounded-xl border border-transparent px-5 type-kicker tracking-[0.14em] font-black text-shell-foreground/70 motion-all motion-standard data-[state=active]:border-shell-foreground/10 data-[state=active]:bg-shell-foreground/10 data-[state=active]:text-shell-foreground/90 data-[state=active]:shadow-sm\",\n  toolbar:\n    \"app-surface-shell flex flex-col gap-3 rounded-2xl p-4 sm:flex-row sm:items-center sm:justify-between\",\n  metricCard: \"app-surface-shell rounded-[24px] p-6\",\n  metricLabel: \"type-kicker text-shell-foreground/40\",\n  metricValue: \"mt-2 text-4xl font-black tabular-nums text-shell-foreground/90\",\n} as const\n\nexport function inboxStatusClass(status: \"pending\" | \"replied\") {\n  return status === \"pending\" ? INBOX_THEME_CLASSES.statusPending : INBOX_THEME_CLASSES.statusReplied\n}\n\nexport function inboxSegmentedClass(active: boolean) {\n  return active\n    ? `${INBOX_THEME_CLASSES.segmentedButton} ${INBOX_THEME_CLASSES.segmentedButtonActive}`\n    : `${INBOX_THEME_CLASSES.segmentedButton} ${INBOX_THEME_CLASSES.segmentedButtonIdle}`\n}\n\nexport function inboxGoogleDotClass(index: number) {\n  const STATUS_DOT_CLASSES = [\"bg-brand\", \"bg-destructive\", \"bg-warning\", \"bg-success\"] as const\n  const normalized = ((index % STATUS_DOT_CLASSES.length) + STATUS_DOT_CLASSES.length) % STATUS_DOT_CLASSES.length\n  return STATUS_DOT_CLASSES[normalized]\n}\n\nexport function inboxStarClass(filled: boolean) {\n  return filled ? \"fill-star text-star\" : \"fill-shell-foreground/10 text-shell-foreground/10\"\n}\n"
    },
    {
      "path": "lib/design-system/page-theme.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/design-system/page-theme.ts",
      "content": "/**\n * page-theme.ts — Generalized page-level class recipe system.\n *\n * This module provides composable, typed class contracts for page layouts.\n * It replaces the need for ad-hoc Tailwind class strings across page components\n * and ensures visual consistency across all app routes.\n *\n * Architecture:\n *   PAGE_THEME   — shared classes used by every page\n *   INBOX_THEME  — inbox-specific overrides (re-exported from inbox-theme.ts)\n *\n * Usage:\n *   import { PAGE_THEME } from \"@/lib/design-system/page-theme\"\n *   <div className={PAGE_THEME.page}>…</div>\n */\n\n/* ─────────────────────────────────────────────────────────\n   Shared page-level class contracts\n   ───────────────────────────────────────────────────────── */\nexport const PAGE_THEME = {\n    /* Page root */\n    page: \"app-container space-y-8 py-4 sm:py-6 lg:py-10\",\n\n    /* ── Hero / page header ── */\n    hero: \"flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between\",\n    heroLead: \"flex items-center gap-5\",\n    heroIcon:\n        \"flex h-14 w-14 items-center justify-center rounded-2xl border border-shell-foreground/10 bg-shell-foreground/5 text-brand-muted shadow-floating motion-all motion-standard\",\n    heroTitle:\n        \"bg-gradient-to-b from-shell-foreground to-shell-foreground/60 bg-clip-text text-2xl font-black tracking-tight text-transparent md:text-3xl\",\n    heroKicker: \"type-kicker text-shell-foreground/40\",\n    heroDescription: \"type-body text-shell-foreground/60 max-w-prose\",\n\n    /* ── Tabs (page-level nav) ── */\n    tabList:\n        \"inline-flex h-12 w-full items-center justify-start gap-1 overflow-x-auto rounded-2xl border border-shell-foreground/10 bg-shell-foreground/5 p-1.5 sm:w-auto\",\n    tabTrigger:\n        \"h-9 shrink-0 rounded-xl border border-transparent px-5 text-xs font-black uppercase tracking-[0.14em] text-shell-foreground/70 motion-all motion-standard data-[state=active]:border-shell-foreground/10 data-[state=active]:bg-shell-foreground/10 data-[state=active]:text-shell-foreground/90 data-[state=active]:shadow-sm\",\n\n    /* ── Toolbar (action bar below tabs) ── */\n    toolbar:\n        \"app-surface-shell flex flex-col gap-3 rounded-2xl p-4 sm:flex-row sm:items-center sm:justify-between\",\n    toolbarSection: \"flex items-center gap-2\",\n    toolbarDivider: \"hidden h-6 w-px bg-shell-foreground/10 sm:block\",\n\n    /* ── Metric cards ── */\n    metricCard: \"app-surface-shell rounded-[24px] p-6\",\n    metricLabel: \"type-kicker text-shell-foreground/40\",\n    metricValue: \"mt-2 text-4xl font-black tabular-nums text-shell-foreground/90\",\n    metricDelta: \"type-caption text-shell-foreground/50\",\n    metricGrid: \"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\",\n\n    /* ── Section containers ── */\n    section: \"space-y-4\",\n    sectionHeader: \"flex items-center justify-between\",\n    sectionTitle: \"type-section text-shell-foreground/85\",\n    sectionKicker: \"type-kicker text-shell-foreground/40\",\n    sectionDescription: \"type-body text-shell-foreground/55 max-w-prose\",\n    sectionCard: \"app-surface-shell rounded-2xl p-6 space-y-6\",\n\n    /* ── Data table container ── */\n    tableContainer: \"app-surface-shell overflow-hidden rounded-2xl\",\n    tableHeader: \"border-b border-shell-foreground/10 px-6 py-4 flex items-center justify-between\",\n    tableHeaderTitle: \"type-body font-bold text-shell-foreground/80\",\n\n    /* ── Filter / segmented controls ── */\n    filterRow: \"flex flex-wrap items-center gap-2\",\n    filterPill:\n        \"inline-flex h-8 items-center gap-1.5 rounded-full border px-3 type-kicker motion-all motion-fast active:scale-95\",\n    filterPillActive:\n        \"border-brand/30 bg-brand/15 text-brand-muted\",\n    filterPillIdle:\n        \"border-shell-foreground/10 bg-shell-foreground/5 text-shell-foreground/70 hover:bg-shell-foreground/10\",\n\n    /* ── Form fields ── */\n    fieldGroup: \"space-y-5\",\n    fieldLabel: \"type-kicker text-shell-foreground/50\",\n    fieldDescription: \"type-caption text-shell-foreground/45\",\n\n    /* ── Action footer (sticky bottom bar) ── */\n    actionFooter:\n        \"sticky bottom-0 z-20 border-t border-shell-foreground/10 bg-shell-elevated/80 backdrop-blur-xl px-6 py-4 flex items-center justify-end gap-3 rounded-b-2xl\",\n\n    /* ── Empty / error / loading states ── */\n    emptyContainer: \"py-16\",\n} as const\n\n/* ─────────────────────────────────────────────────────────\n   Helper: dynamically compose a filter pill class\n   ───────────────────────────────────────────────────────── */\nexport function filterPillClass(active: boolean) {\n    return active\n        ? `${PAGE_THEME.filterPill} ${PAGE_THEME.filterPillActive}`\n        : `${PAGE_THEME.filterPill} ${PAGE_THEME.filterPillIdle}`\n}\n\n/* ─────────────────────────────────────────────────────────\n   Helper: metric delta direction\n   ───────────────────────────────────────────────────────── */\nexport function metricDeltaClass(direction: \"up\" | \"down\" | \"neutral\") {\n    const base = PAGE_THEME.metricDelta\n    switch (direction) {\n        case \"up\":\n            return `${base} text-success`\n        case \"down\":\n            return `${base} text-destructive`\n        default:\n            return base\n    }\n}\n\n/* ─────────────────────────────────────────────────────────\n   Status class helper (shared across pages)\n   ───────────────────────────────────────────────────────── */\nexport type StatusVariant =\n    | \"pending\"\n    | \"success\"\n    | \"warning\"\n    | \"error\"\n    | \"info\"\n    | \"blocked\"\n    | \"ready\"\n\nconst STATUS_MAP: Record<StatusVariant, string> = {\n    pending: \"border-state-pending-border bg-state-pending-bg text-state-pending-fg\",\n    success: \"border-state-ready-border bg-state-ready-bg text-state-ready-fg\",\n    ready: \"border-state-ready-border bg-state-ready-bg text-state-ready-fg\",\n    warning: \"border-state-needs-edit-border bg-state-needs-edit-bg text-state-needs-edit-fg\",\n    error: \"border-state-error-border bg-state-error-bg text-state-error-fg\",\n    info: \"border-state-posted-border bg-state-posted-bg text-state-posted-fg\",\n    blocked: \"border-state-blocked-border bg-state-blocked-bg text-state-blocked-fg\",\n}\n\nexport function statusClass(variant: StatusVariant) {\n    return `rounded-full border px-2.5 py-0.5 type-kicker ${STATUS_MAP[variant]}`\n}\n"
    },
    {
      "path": "lib/hooks.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks.ts",
      "content": "\"use client\"\n\nexport { formatAge } from \"./hooks/formatAge\"\nexport { useJobSummaryPolling } from \"./hooks/jobs/useJobSummaryPolling\"\nexport { usePaginatedReviews } from \"./hooks/reviews/usePaginatedReviews\"\nexport { useReviewDetail } from \"./hooks/reviews/useReviewDetail\"\n\nexport type { JobSummary } from \"./hooks/jobs/useJobSummaryPolling\"\nexport type {\n  ReviewCounts,\n  ReviewDetail,\n  ReviewFilter,\n  ReviewRow,\n  ReviewStatusFilter,\n} from \"./hooks/reviews/types\"\n"
    },
    {
      "path": "lib/hooks/formatAge.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks/formatAge.ts",
      "content": "export function formatAge(iso: string): string {\n  const now = Date.now()\n  const then = new Date(iso).getTime()\n  const diffMs = now - then\n  const minutes = Math.floor(diffMs / 60_000)\n\n  if (minutes < 60) return `${Math.max(minutes, 0)}m`\n\n  const hours = Math.floor(minutes / 60)\n  if (hours < 24) return `${hours}h`\n\n  const days = Math.floor(hours / 24)\n  if (days < 7) return `${days}d`\n\n  const weeks = Math.floor(days / 7)\n  return `${weeks}w`\n}\n"
    },
    {
      "path": "lib/hooks/jobs/useJobSummaryPolling.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks/jobs/useJobSummaryPolling.ts",
      "content": "\"use client\"\n\nimport * as React from \"react\"\n\nexport type JobSummary = {\n  byType: Record<\n    string,\n    { pending: number; running: number; retrying: number; failed_24h: number }\n  >\n  recentFailures: Array<{\n    id: string\n    type: string\n    completedAtIso: string | null\n    lastError: string | null\n  }>\n  aiQuality24h?: {\n    runs: number\n    blocked: number\n    stuffingRisk: number\n    avgKeywordCoverage: number\n    blockedRate: number\n    stuffingRiskRate: number\n    requiredKeywordUsageRate: number\n    topProgramVersion: string | null\n    programVersions: Array<{\n      version: string\n      runs: number\n      blockedRate: number\n      avgKeywordCoverage: number\n      requiredKeywordUsageRate: number\n    }>\n    modeDistribution: Array<{\n      mode: \"AUTO\" | \"MANUAL_REGENERATE\" | \"VERIFY_EXISTING_DRAFT\"\n      runs: number\n      ratio: number\n    }>\n  }\n}\n\ntype UseJobSummaryResult = {\n  summary: JobSummary | null\n  backlog: number\n  failed24h: number\n  error: string | null\n}\n\nexport function useJobSummaryPolling(pollMs: number = 60_000): UseJobSummaryResult {\n  const [summary, setSummary] = React.useState<JobSummary | null>(null)\n  const [error, setError] = React.useState<string | null>(null)\n\n  React.useEffect(() => {\n    let mounted = true\n    let visible = typeof document === \"undefined\" ? true : document.visibilityState === \"visible\"\n    let timer: ReturnType<typeof setTimeout> | null = null\n    let controller: AbortController | null = null\n\n    const schedule = (ms: number) => {\n      if (!mounted) return\n      if (timer) clearTimeout(timer)\n      timer = setTimeout(() => {\n        void run()\n      }, ms)\n    }\n\n    const run = async () => {\n      if (!mounted || !visible) return\n      controller?.abort()\n      controller = new AbortController()\n\n      try {\n        const res = await fetch(\"/api/jobs/summary\", { signal: controller.signal })\n        if (!mounted) return\n        if (!res.ok) {\n          setError(res.statusText)\n          schedule(pollMs)\n          return\n        }\n        const data = await res.json()\n        setSummary(data.summary)\n        setError(null)\n      } catch (err: unknown) {\n        if (err instanceof DOMException && err.name === \"AbortError\") return\n        if (!mounted) return\n        setError(err instanceof Error ? err.message : \"Unknown error\")\n      } finally {\n        schedule(pollMs)\n      }\n    }\n\n    const onVisibilityChange = () => {\n      visible = document.visibilityState === \"visible\"\n      if (visible) {\n        // Catch up immediately when tab becomes active again.\n        schedule(0)\n      }\n    }\n\n    if (typeof document !== \"undefined\") {\n      document.addEventListener(\"visibilitychange\", onVisibilityChange)\n    }\n\n    // Defer initial fetch to avoid competing with route navigation / hydration.\n    type RequestIdleCallback = (cb: () => void, opts?: { timeout?: number }) => number\n    const requestIdleCallback = (globalThis as unknown as { requestIdleCallback?: RequestIdleCallback }).requestIdleCallback\n    if (typeof requestIdleCallback === \"function\") {\n      requestIdleCallback(() => schedule(0), { timeout: 1200 })\n    } else {\n      schedule(250)\n    }\n\n    return () => {\n      mounted = false\n      controller?.abort()\n      if (timer) clearTimeout(timer)\n      if (typeof document !== \"undefined\") {\n        document.removeEventListener(\"visibilitychange\", onVisibilityChange)\n      }\n    }\n  }, [pollMs])\n\n  const backlog = React.useMemo(() => {\n    if (!summary) return 0\n    return Object.values(summary.byType).reduce(\n      (sum, item) => sum + item.pending + item.running + item.retrying,\n      0,\n    )\n  }, [summary])\n\n  const failed24h = React.useMemo(() => {\n    if (!summary) return 0\n    return Object.values(summary.byType).reduce((sum, item) => sum + item.failed_24h, 0)\n  }, [summary])\n\n  return { summary, backlog, failed24h, error }\n}\n"
    },
    {
      "path": "lib/hooks/reviews/usePaginatedReviews.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks/reviews/usePaginatedReviews.ts",
      "content": "\"use client\"\n\nimport * as React from \"react\"\n\nimport { REVIEWS_PAGE_SIZE } from \"@/lib/reviews/constants\"\nimport { emitUnansweredCount } from \"@/lib/reviews/count-events\"\nimport type { ReviewListPage } from \"@/lib/reviews/types\"\n\nimport type { ReviewCounts, ReviewFilter, ReviewRow, ReviewStatusFilter } from \"./types\"\n\nexport type ReviewInitialPage = ReviewListPage & {\n  filter: ReviewFilter\n  status?: ReviewStatusFilter\n  mention?: string | null\n}\n\ntype UsePaginatedReviewsResult = {\n  rows: ReviewRow[]\n  counts: ReviewCounts | null\n  loading: boolean\n  loadingMore: boolean\n  error: string | null\n  hasMore: boolean\n  loadMore: () => void\n  refresh: () => void\n  updateRow: (id: string, updater: (row: ReviewRow) => ReviewRow) => void\n}\n\nfunction initialPageMatchesFilters(input: {\n  initialPage: ReviewInitialPage | null | undefined\n  filter: ReviewFilter\n  mention?: string\n  status: ReviewStatusFilter\n  locationId?: string\n  rating?: number\n  search?: string\n}) {\n  const { initialPage, filter, mention, status, locationId, rating, search } = input\n  return (\n    !!initialPage &&\n    !locationId &&\n    rating == null &&\n    !search &&\n    initialPage.filter === filter &&\n    (initialPage.mention ?? null) === (mention ?? null) &&\n    (initialPage.status == null || initialPage.status === status)\n  )\n}\n\nexport function usePaginatedReviews(opts: {\n  filter: ReviewFilter\n  mention?: string\n  status?: ReviewStatusFilter\n  locationId?: string\n  rating?: number\n  search?: string\n  enabled?: boolean\n  initialPage?: ReviewInitialPage | null\n}): UsePaginatedReviewsResult {\n  const { filter, mention, status = \"all\", locationId, rating, search, enabled = true, initialPage } = opts\n  const initialMatches = initialPageMatchesFilters({\n    initialPage,\n    filter,\n    mention,\n    status,\n    locationId,\n    rating,\n    search,\n  })\n  const seededInitialPage = initialMatches ? initialPage : null\n  const initialConsumedRef = React.useRef(false)\n\n  const [rows, setRows] = React.useState<ReviewRow[]>(seededInitialPage?.rows ?? [])\n  const [counts, setCounts] = React.useState<ReviewCounts | null>(seededInitialPage?.counts ?? null)\n  const [loading, setLoading] = React.useState(enabled && !initialMatches)\n  const [loadingMore, setLoadingMore] = React.useState(false)\n  const [error, setError] = React.useState<string | null>(null)\n  const [hasMore, setHasMore] = React.useState(Boolean(seededInitialPage?.nextCursor))\n\n  const cursorRef = React.useRef<string | null>(seededInitialPage?.nextCursor ?? null)\n  const abortRef = React.useRef<AbortController | null>(null)\n  const countsAbortRef = React.useRef<AbortController | null>(null)\n  const countsLoadingRef = React.useRef(false)\n  const hasLoadedCountsRef = React.useRef(initialMatches && seededInitialPage?.counts !== undefined)\n\n  const setCountsWithBroadcast = React.useCallback((nextCounts: ReviewCounts) => {\n    setCounts(nextCounts)\n    emitUnansweredCount(nextCounts.unanswered)\n  }, [])\n\n  const fetchPage = React.useCallback(\n    async (cursor: string | null, append: boolean, includeCounts: boolean) => {\n      abortRef.current?.abort()\n      const controller = new AbortController()\n      abortRef.current = controller\n\n      if (append) {\n        setLoadingMore(true)\n      } else {\n        setLoading(true)\n      }\n      setError(null)\n\n      const params = new URLSearchParams({ filter, limit: String(REVIEWS_PAGE_SIZE) })\n      if (mention) params.set(\"mention\", mention)\n      params.set(\"status\", status)\n      if (locationId) params.set(\"locationId\", locationId)\n      if (rating != null) params.set(\"rating\", String(rating))\n      if (search) params.set(\"search\", search)\n      if (cursor) params.set(\"cursor\", cursor)\n      params.set(\"includeCounts\", !cursor && includeCounts ? \"1\" : \"0\")\n\n      try {\n        const res = await fetch(`/api/reviews?${params.toString()}`, {\n          signal: controller.signal,\n        })\n\n        if (controller.signal.aborted) return\n\n        if (res.status === 401) {\n          setError(\"SESSION_EXPIRED\")\n          return\n        }\n\n        if (!res.ok) {\n          let msg = res.statusText\n          try {\n            const body = await res.json()\n            if (body.error === \"BAD_CURSOR\") {\n              cursorRef.current = null\n              fetchPage(null, false, includeCounts)\n              return\n            }\n            msg = body.error || msg\n          } catch {\n            // use statusText\n          }\n          setError(msg)\n          return\n        }\n\n        const data = await res.json()\n\n        if (append) {\n          setRows((prev) => [...prev, ...data.rows])\n        } else {\n          setRows(data.rows)\n        }\n\n        if (data.counts !== undefined) {\n          setCountsWithBroadcast(data.counts)\n        }\n\n        if (!append && !cursor && includeCounts) {\n          hasLoadedCountsRef.current = true\n        }\n\n        cursorRef.current = data.nextCursor ?? null\n        setHasMore(!!data.nextCursor)\n      } catch (err: unknown) {\n        if (err instanceof DOMException && err.name === \"AbortError\") return\n        setError(err instanceof Error ? err.message : \"Unknown error\")\n      } finally {\n        if (!controller.signal.aborted) {\n          setLoading(false)\n          setLoadingMore(false)\n        }\n      }\n    },\n    [filter, mention, status, locationId, rating, search, setCountsWithBroadcast],\n  )\n\n  const fetchCounts = React.useCallback(async () => {\n    if (hasLoadedCountsRef.current || countsLoadingRef.current) return\n\n    countsAbortRef.current?.abort()\n    const controller = new AbortController()\n    countsAbortRef.current = controller\n    countsLoadingRef.current = true\n\n    try {\n      const res = await fetch(\"/api/reviews/counts\", { signal: controller.signal })\n      if (controller.signal.aborted) return\n\n      if (res.status === 401) {\n        setError(\"SESSION_EXPIRED\")\n        return\n      }\n\n      if (!res.ok) {\n        return\n      }\n\n      const data = await res.json()\n      if (data.counts !== undefined) {\n        setCountsWithBroadcast(data.counts)\n        hasLoadedCountsRef.current = true\n      }\n    } catch (err: unknown) {\n      if (err instanceof DOMException && err.name === \"AbortError\") return\n      // Ignore background count refresh failures to avoid interrupting list UX.\n    } finally {\n      countsLoadingRef.current = false\n      if (countsAbortRef.current === controller) {\n        countsAbortRef.current = null\n      }\n    }\n  }, [setCountsWithBroadcast])\n\n  React.useEffect(() => {\n    cursorRef.current = null\n    setHasMore(false)\n\n    const canUseInitialPage =\n      !initialConsumedRef.current &&\n      initialPageMatchesFilters({\n        initialPage,\n        filter,\n        mention,\n        status,\n        locationId,\n        rating,\n        search,\n      })\n\n    const matchedInitialPage = canUseInitialPage ? initialPage : null\n    if (matchedInitialPage) {\n      initialConsumedRef.current = true\n      hasLoadedCountsRef.current = matchedInitialPage.counts !== undefined\n      setRows(matchedInitialPage.rows)\n      if (matchedInitialPage.counts) {\n        setCountsWithBroadcast(matchedInitialPage.counts)\n      } else {\n        setCounts(null)\n      }\n      cursorRef.current = matchedInitialPage.nextCursor\n      setHasMore(Boolean(matchedInitialPage.nextCursor))\n      setLoading(false)\n      setLoadingMore(false)\n      setError(null)\n      return () => {\n        abortRef.current?.abort()\n        countsAbortRef.current?.abort()\n      }\n    }\n\n    if (!enabled) {\n      setLoading(false)\n      setLoadingMore(false)\n      return () => {\n        abortRef.current?.abort()\n        countsAbortRef.current?.abort()\n      }\n    }\n\n    fetchPage(null, false, false)\n\n    return () => {\n      abortRef.current?.abort()\n      countsAbortRef.current?.abort()\n    }\n  }, [enabled, fetchPage, filter, initialPage, locationId, mention, rating, search, setCountsWithBroadcast, status])\n\n  React.useEffect(() => {\n    if (!enabled) return\n    if (loading || hasLoadedCountsRef.current) return\n    if (typeof window === \"undefined\") return\n\n    const idleWindow = window as Window & {\n      requestIdleCallback?: (cb: () => void, options?: { timeout?: number }) => number\n      cancelIdleCallback?: (handle: number) => void\n    }\n\n    const run = () => {\n      void fetchCounts()\n    }\n\n    if (typeof idleWindow.requestIdleCallback === \"function\") {\n      const handle = idleWindow.requestIdleCallback(run, { timeout: 1200 })\n      return () => {\n        idleWindow.cancelIdleCallback?.(handle)\n      }\n    }\n\n    const timeout = window.setTimeout(run, 0)\n    return () => {\n      window.clearTimeout(timeout)\n    }\n  }, [enabled, loading, fetchCounts])\n\n  const loadMore = React.useCallback(() => {\n    if (!enabled || !hasMore || loadingMore || loading) return\n    fetchPage(cursorRef.current, true, false)\n  }, [enabled, fetchPage, hasMore, loading, loadingMore])\n\n  const refresh = React.useCallback(() => {\n    if (!enabled) return\n    cursorRef.current = null\n    setHasMore(false)\n    fetchPage(null, false, true)\n  }, [enabled, fetchPage])\n\n  const updateRow = React.useCallback((id: string, updater: (row: ReviewRow) => ReviewRow) => {\n    setRows((prev) => prev.map((row) => (row.id === id ? updater(row) : row)))\n  }, [])\n\n  return { rows, counts, loading, loadingMore, error, hasMore, loadMore, refresh, updateRow }\n}\n"
    },
    {
      "path": "lib/hooks/reviews/useReviewDetail.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks/reviews/useReviewDetail.ts",
      "content": "\"use client\"\n\nimport * as React from \"react\"\n\nimport { extractClientErrorMessage } from \"@/lib/api/client-error\"\n\nimport type { ReviewDetail } from \"./types\"\n\ntype UseReviewDetailResult = {\n  review: ReviewDetail | null\n  loading: boolean\n  error: string | null\n  refresh: () => void\n}\n\nexport function useReviewDetail(reviewId: string | null): UseReviewDetailResult {\n  const [review, setReview] = React.useState<ReviewDetail | null>(null)\n  const [loading, setLoading] = React.useState(false)\n  const [error, setError] = React.useState<string | null>(null)\n  const abortRef = React.useRef<AbortController | null>(null)\n\n  const fetchReview = React.useCallback(async (id: string) => {\n    abortRef.current?.abort()\n    const controller = new AbortController()\n    abortRef.current = controller\n\n    setLoading(true)\n    setError(null)\n\n    try {\n      const res = await fetch(`/api/reviews/${id}`, {\n        signal: controller.signal,\n      })\n\n      if (controller.signal.aborted) return\n\n      if (res.status === 401) {\n        setError(\"SESSION_EXPIRED\")\n        return\n      }\n\n      if (res.status === 404) {\n        const body = await res.json().catch(() => null)\n        setError(\n          extractClientErrorMessage({\n            body,\n            statusText: res.statusText,\n            fallback: \"Review not found or not accessible\",\n          }),\n        )\n        return\n      }\n\n      if (!res.ok) {\n        const body = await res.json().catch(() => null)\n        setError(\n          extractClientErrorMessage({\n            body,\n            statusText: res.statusText,\n          }),\n        )\n        return\n      }\n\n      const data = await res.json()\n      setReview(data)\n    } catch (err: unknown) {\n      if (err instanceof DOMException && err.name === \"AbortError\") return\n      setError(err instanceof Error ? err.message : \"Unknown error\")\n    } finally {\n      if (!controller.signal.aborted) {\n        setLoading(false)\n      }\n    }\n  }, [])\n\n  React.useEffect(() => {\n    if (!reviewId) {\n      setReview(null)\n      setLoading(false)\n      setError(null)\n      return\n    }\n\n    void fetchReview(reviewId)\n\n    return () => {\n      abortRef.current?.abort()\n    }\n  }, [reviewId, fetchReview])\n\n  const refresh = React.useCallback(() => {\n    if (reviewId) {\n      void fetchReview(reviewId)\n    }\n  }, [reviewId, fetchReview])\n\n  return { review, loading, error, refresh }\n}\n"
    },
    {
      "path": "lib/hooks/useSmoothLoading.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/hooks/useSmoothLoading.ts",
      "content": "\"use client\"\n\nimport * as React from \"react\"\n\ntype UseSmoothLoadingOptions = {\n  delayMs?: number\n  minDurationMs?: number\n}\n\n/**\n * Returns a debounced loading signal that avoids flicker by waiting `delayMs`\n * before showing, then holding for at least `minDurationMs` once visible.\n */\nexport function useSmoothLoading(active: boolean, options?: UseSmoothLoadingOptions) {\n  const delayMs = Math.max(0, options?.delayMs ?? 150)\n  const minDurationMs = Math.max(0, options?.minDurationMs ?? 450)\n\n  const [visible, setVisible] = React.useState(active)\n  const visibleSinceRef = React.useRef<number | null>(null)\n\n  React.useEffect(() => {\n    let delayTimer: ReturnType<typeof setTimeout> | null = null\n    let hideTimer: ReturnType<typeof setTimeout> | null = null\n\n    const clearAll = () => {\n      if (delayTimer) clearTimeout(delayTimer)\n      if (hideTimer) clearTimeout(hideTimer)\n    }\n\n    if (active) {\n      if (visible && visibleSinceRef.current == null) {\n        visibleSinceRef.current = Date.now()\n      }\n      // Already visible: just keep it.\n      if (visible) return () => clearAll()\n\n      delayTimer = setTimeout(() => {\n        visibleSinceRef.current = Date.now()\n        setVisible(true)\n      }, delayMs)\n      return () => clearAll()\n    }\n\n    // Not active: if never shown, hide immediately.\n    if (!visible) return () => clearAll()\n\n    const since = visibleSinceRef.current\n    const elapsed = since ? Date.now() - since : minDurationMs\n    const remaining = Math.max(0, minDurationMs - elapsed)\n\n    hideTimer = setTimeout(() => {\n      visibleSinceRef.current = null\n      setVisible(false)\n    }, remaining)\n\n    return () => clearAll()\n  }, [active, delayMs, minDurationMs, visible])\n\n  return visible\n}\n"
    },
    {
      "path": "lib/reviews/constants.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/reviews/constants.ts",
      "content": "export const REVIEWS_PAGE_SIZE = 10\n"
    },
    {
      "path": "lib/reviews/count-events.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/reviews/count-events.ts",
      "content": "export const REPLYAI_UNANSWERED_COUNT_EVENT = \"replyai:unanswered-count\"\n\ntype UnansweredCountEventDetail = {\n  count: number\n}\n\nexport function emitUnansweredCount(count: number): void {\n  if (typeof window === \"undefined\") return\n  window.dispatchEvent(\n    new CustomEvent<UnansweredCountEventDetail>(REPLYAI_UNANSWERED_COUNT_EVENT, {\n      detail: { count },\n    }),\n  )\n}\n"
    },
    {
      "path": "lib/reviews/detail-to-row.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/reviews/detail-to-row.ts",
      "content": "import type { ReviewDetail, ReviewRow } from \"@/lib/hooks/reviews/types\"\nimport type { DraftStatus } from \"@/lib/reviews/types\"\n\nconst DRAFT_STATUS_VALUES: DraftStatus[] = [\n  \"NEEDS_APPROVAL\",\n  \"BLOCKED_BY_VERIFIER\",\n  \"READY\",\n  \"POSTED\",\n  \"POST_FAILED\",\n]\n\nfunction normalizeDraftStatus(status: string): DraftStatus {\n  if (DRAFT_STATUS_VALUES.includes(status as DraftStatus)) {\n    return status as DraftStatus\n  }\n  return \"NEEDS_APPROVAL\"\n}\n\nexport function mapReviewDetailToRow(detail: ReviewDetail, existing?: ReviewRow): ReviewRow {\n  const draftStatus = detail.currentDraft ? normalizeDraftStatus(detail.currentDraft.status) : null\n  const draftUpdatedAt =\n    detail.currentDraft == null\n      ? null\n      : typeof detail.currentDraft.updatedAt === \"string\" && detail.currentDraft.updatedAt.length > 0\n        ? detail.currentDraft.updatedAt\n        : existing?.currentDraft?.updatedAtIso ?? detail.updateTime\n\n  return {\n    id: detail.id,\n    starRating: detail.starRating,\n    snippet: (detail.comment ?? \"\").slice(0, 120),\n    comment: detail.comment ?? \"\",\n    reviewer: {\n      displayName: detail.reviewer.displayName,\n      isAnonymous: detail.reviewer.isAnonymous,\n    },\n    location: {\n      id: detail.location.id,\n      displayName: detail.location.name,\n    },\n    createTimeIso: detail.createTime,\n    unanswered: detail.reply.comment == null,\n    status: detail.reply.comment == null ? \"pending\" : \"replied\",\n    reply: {\n      comment: detail.reply.comment,\n      updateTimeIso: detail.reply.updateTime,\n    },\n    currentDraft: detail.currentDraft\n      ? {\n          id: detail.currentDraft.id,\n          text: detail.currentDraft.text,\n          status: draftStatus ?? \"NEEDS_APPROVAL\",\n          version: detail.currentDraft.version,\n          updatedAtIso: draftUpdatedAt ?? detail.updateTime,\n          verifierResultJson: detail.currentDraft.verifierResultJson,\n        }\n      : null,\n    draftStatus,\n    mentions: detail.mentions,\n  }\n}\n"
    },
    {
      "path": "lib/reviews/verifier-envelope.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/reviews/verifier-envelope.ts",
      "content": "import { verifierViolationSchema } from \"@/lib/ai/draft\"\nimport { z } from \"zod\"\n\nexport const VERIFIER_RESULT_SCHEMA_VERSION = 1 as const\n\nconst verifierDecisionSourceSchema = z.enum([\"DSPY_VERIFIER\", \"LOCAL_DETERMINISTIC_POLICY\"])\nconst freshnessHashSchema = z.string().regex(/^[a-f0-9]{64}$/)\nconst verifierPayloadBodySchema = z\n  .object({\n    issues: z.array(z.string()).optional(),\n    dspy: z\n      .object({\n        decision: z.enum([\"READY\", \"BLOCKED_BY_VERIFIER\"]).optional(),\n        verifier: z\n          .object({\n            pass: z.boolean().optional(),\n            violations: z.array(verifierViolationSchema).optional(),\n            suggestedRewrite: z.string().nullable().optional(),\n          })\n          .strict()\n          .optional(),\n        seoQuality: z.unknown().optional(),\n        generation: z.unknown().optional(),\n        models: z.unknown().optional(),\n        trace: z.unknown().optional(),\n        latencyMs: z.number().int().nonnegative().optional(),\n      })\n      .strict()\n      .optional(),\n    policy: z\n      .object({\n        localViolations: z.array(verifierViolationSchema).optional(),\n      })\n      .strict()\n      .optional(),\n  })\n  .strict()\nconst verifierResultEnvelopeSchema = z\n  .object({\n    schemaVersion: z.literal(VERIFIER_RESULT_SCHEMA_VERSION),\n    decisionSource: verifierDecisionSourceSchema,\n    freshnessHash: freshnessHashSchema.optional(),\n    payload: verifierPayloadBodySchema,\n  })\n  .strict()\n\nexport type VerifierDecisionSource = z.infer<typeof verifierDecisionSourceSchema>\nexport type VerifierPayloadBody = z.infer<typeof verifierPayloadBodySchema>\nexport type VerifierResultEnvelope = z.infer<typeof verifierResultEnvelopeSchema>\n\nexport function parseVerifierResultEnvelope(value: unknown): VerifierResultEnvelope | null {\n  const parsed = verifierResultEnvelopeSchema.safeParse(value)\n  return parsed.success ? parsed.data : null\n}\n\nexport function parseVerifierPayloadBody(value: unknown): VerifierPayloadBody | null {\n  const parsed = verifierPayloadBodySchema.safeParse(value)\n  return parsed.success ? parsed.data : null\n}\n\nexport function buildVerifierResultEnvelope(input: {\n  decisionSource: VerifierDecisionSource\n  freshnessHash?: string\n  payload: VerifierPayloadBody\n}): VerifierResultEnvelope {\n  return verifierResultEnvelopeSchema.parse({\n    schemaVersion: VERIFIER_RESULT_SCHEMA_VERSION,\n    decisionSource: input.decisionSource,\n    freshnessHash: input.freshnessHash,\n    payload: input.payload,\n  })\n}\n\nexport function unwrapVerifierResultPayload(payload: unknown): VerifierPayloadBody | null {\n  return parseVerifierResultEnvelope(payload)?.payload ?? null\n}\n\nexport function readVerifierFreshnessHash(payload: unknown): string | null {\n  return parseVerifierResultEnvelope(payload)?.freshnessHash ?? null\n}\n"
    },
    {
      "path": "lib/reviews/verifier-result.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/reviews/verifier-result.ts",
      "content": "import {\n  parseVerifierPayloadBody,\n  parseVerifierResultEnvelope,\n  unwrapVerifierResultPayload,\n} from \"@/lib/reviews/verifier-envelope\"\n\ntype VerifierLikePayload = {\n  issues?: unknown\n  dspy?: {\n    verifier?: {\n      violations?: Array<{ message?: unknown }> | unknown\n    }\n  }\n  policy?: {\n    localViolations?: Array<{ message?: unknown }> | unknown\n  }\n}\n\nexport function extractVerifierIssueMessages(payload: unknown): string[] {\n  const parsedEnvelope = parseVerifierResultEnvelope(payload)\n  if (parsedEnvelope) {\n    return dedupeMessages(collectIssueMessages(parsedEnvelope.payload))\n  }\n\n  const parsedPayload = parseVerifierPayloadBody(payload)\n  if (parsedPayload) {\n    return dedupeMessages(collectIssueMessages(parsedPayload))\n  }\n\n  const source = unwrapVerifierResultPayload(payload)\n  if (source) {\n    return dedupeMessages(collectIssueMessages(source))\n  }\n\n  const candidates = getLoosePayloadCandidates(payload)\n  if (candidates.length === 0) return []\n  return dedupeMessages(candidates.flatMap((candidate) => collectIssueMessages(candidate)))\n}\n\nexport function getFirstVerifierIssueMessage(payload: unknown): string | null {\n  return extractVerifierIssueMessages(payload)[0] ?? null\n}\n\nfunction getLoosePayloadCandidates(payload: unknown): VerifierLikePayload[] {\n  if (!payload || typeof payload !== \"object\" || Array.isArray(payload)) return []\n  const root = payload as Record<string, unknown>\n  const nested = root.payload\n  const list: VerifierLikePayload[] = [root as VerifierLikePayload]\n  if (nested && typeof nested === \"object\" && !Array.isArray(nested)) {\n    list.push(nested as VerifierLikePayload)\n  }\n  return list\n}\n\nfunction collectIssueMessages(value: VerifierLikePayload): string[] {\n  if (!value || typeof value !== \"object\") return []\n\n  const fromIssues = toStringArray(value.issues)\n  const fromDspy = toViolationMessages(value.dspy?.verifier?.violations)\n  const fromPolicy = toViolationMessages(value.policy?.localViolations)\n\n  return [...fromIssues, ...fromDspy, ...fromPolicy]\n}\n\nfunction dedupeMessages(messages: string[]): string[] {\n  const seen = new Set<string>()\n  const deduped: string[] = []\n  for (const message of messages) {\n    const normalized = message.trim()\n    if (!normalized) continue\n    const key = normalized.toLowerCase()\n    if (seen.has(key)) continue\n    seen.add(key)\n    deduped.push(normalized)\n  }\n\n  return deduped\n}\n\nfunction toStringArray(value: unknown): string[] {\n  if (!Array.isArray(value)) return []\n  return value.filter((item): item is string => typeof item === \"string\")\n}\n\nfunction toViolationMessages(value: unknown): string[] {\n  if (!Array.isArray(value)) return []\n  return value\n    .map((item) => (item && typeof item === \"object\" ? (item as { message?: unknown }).message : null))\n    .filter((message): message is string => typeof message === \"string\")\n}\n"
    },
    {
      "path": "lib/utils.ts",
      "absolutePath": "/Users/amankumarshrestha/LapenInns Project/googlereview/lib/utils.ts",
      "content": "import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"
    }
  ]
}
